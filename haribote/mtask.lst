     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_hlt
     7 00000000                                 	EXTERN	_memman_alloc_4k
     8 00000000                                 	EXTERN	_set_segmdesc
     9 00000000                                 	EXTERN	_load_tr
    10 00000000                                 	EXTERN	_timer_alloc
    11 00000000                                 	EXTERN	_timer_settime
    12 00000000                                 	EXTERN	_farjmp
    13 00000000                                 	EXTERN	_io_cli
    14 00000000                                 	EXTERN	_clts
    15 00000000                                 	EXTERN	_frstor
    16 00000000                                 	EXTERN	_io_sti
    17 00000000                                 	EXTERN	_fnsave
    18 00000000                                 	EXTERN	_boxfill8
    19 00000000                                 	EXTERN	_putfonts8_asc
    20 00000000                                 [FILE "mtask.c"]
    21                                          [SECTION .text]
    22 00000000                                 	GLOBAL	_pid2task
    23 00000000                                 _pid2task:
    24 00000000 55                              	PUSH	EBP
    25 00000001 89 E5                           	MOV	EBP,ESP
    26 00000003 8B 15 00000F0A                  	MOV	EDX,DWORD [3850]
    27 00000009 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    28 0000000C 5D                              	POP	EBP
    29 0000000D 8B 44 C2 04                     	MOV	EAX,DWORD [4+EDX+EAX*8]
    30 00000011 C3                              	RET
    31 00000012                                 	GLOBAL	_init_pid
    32 00000012                                 _init_pid:
    33 00000012 55                              	PUSH	EBP
    34 00000013 31 C0                           	XOR	EAX,EAX
    35 00000015 89 E5                           	MOV	EBP,ESP
    36 00000017 C7 82 00013878 00000000         	MOV	DWORD [79992+EDX],0
    37 00000021 C7 82 00001F40 00000000         	MOV	DWORD [8000+EDX],0
    38 0000002B                                 L7:
    39 0000002B 89 04 C2                        	MOV	DWORD [EDX+EAX*8],EAX
    40 0000002E 40                              	INC	EAX
    41 0000002F 3D 0000270F                     	CMP	EAX,9999
    42 00000034 7E F5                           	JLE	L7
    43 00000036 31 C0                           	XOR	EAX,EAX
    44 00000038                                 L12:
    45 00000038 89 04 C2                        	MOV	DWORD [EDX+EAX*8],EAX
    46 0000003B 40                              	INC	EAX
    47 0000003C 3D 000003E8                     	CMP	EAX,1000
    48 00000041 7E F5                           	JLE	L12
    49 00000043 89 15 00000F0A                  	MOV	DWORD [3850],EDX
    50 00000049 89 15 00000F0F                  	MOV	DWORD [3855],EDX
    51 0000004F 5D                              	POP	EBP
    52 00000050 C3                              	RET
    53 00000051                                 	GLOBAL	_task_now
    54 00000051                                 _task_now:
    55 00000051 A1 [00000034]                   	MOV	EAX,DWORD [_taskctl]
    56 00000056 55                              	PUSH	EBP
    57 00000057 89 E5                           	MOV	EBP,ESP
    58 00000059 5D                              	POP	EBP
    59 0000005A 8B 10                           	MOV	EDX,DWORD [EAX]
    60 0000005C 69 D2 00000198                  	IMUL	EDX,EDX,408
    61 00000062 8D 44 02 0C                     	LEA	EAX,DWORD [12+EDX+EAX*1]
    62 00000066 8B 50 04                        	MOV	EDX,DWORD [4+EAX]
    63 00000069 8B 44 90 08                     	MOV	EAX,DWORD [8+EAX+EDX*4]
    64 0000006D C3                              	RET
    65 0000006E                                 	GLOBAL	_task_add
    66 0000006E                                 _task_add:
    67 0000006E 55                              	PUSH	EBP
    68 0000006F 89 E5                           	MOV	EBP,ESP
    69 00000071 8B 4D 08                        	MOV	ECX,DWORD [8+EBP]
    70 00000074 8B 51 08                        	MOV	EDX,DWORD [8+ECX]
    71 00000077 69 D2 00000198                  	IMUL	EDX,EDX,408
    72 0000007D 03 15 [00000034]                	ADD	EDX,DWORD [_taskctl]
    73 00000083 8B 42 0C                        	MOV	EAX,DWORD [12+EDX]
    74 00000086 89 4C 82 14                     	MOV	DWORD [20+EDX+EAX*4],ECX
    75 0000008A 40                              	INC	EAX
    76 0000008B 89 42 0C                        	MOV	DWORD [12+EDX],EAX
    77 0000008E C7 41 04 00000002               	MOV	DWORD [4+ECX],2
    78 00000095 5D                              	POP	EBP
    79 00000096 C3                              	RET
    80 00000097                                 	GLOBAL	_task_remove
    81 00000097                                 _task_remove:
    82 00000097 55                              	PUSH	EBP
    83 00000098 31 C9                           	XOR	ECX,ECX
    84 0000009A 89 E5                           	MOV	EBP,ESP
    85 0000009C 57                              	PUSH	EDI
    86 0000009D 56                              	PUSH	ESI
    87 0000009E 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
    88 000000A1 53                              	PUSH	EBX
    89 000000A2 8B 3D 00000F0A                  	MOV	EDI,DWORD [3850]
    90 000000A8 8B 46 08                        	MOV	EAX,DWORD [8+ESI]
    91 000000AB 69 C0 00000198                  	IMUL	EAX,EAX,408
    92 000000B1 03 05 [00000034]                	ADD	EAX,DWORD [_taskctl]
    93 000000B7 8D 50 0C                        	LEA	EDX,DWORD [12+EAX]
    94 000000BA 3B 48 0C                        	CMP	ECX,DWORD [12+EAX]
    95 000000BD 7D 0B                           	JGE	L21
    96 000000BF                                 L25:
    97 000000BF 39 74 8A 08                     	CMP	DWORD [8+EDX+ECX*4],ESI
    98 000000C3 74 05                           	JE	L21
    99 000000C5 41                              	INC	ECX
   100 000000C6 3B 0A                           	CMP	ECX,DWORD [EDX]
   101 000000C8 7C F5                           	JL	L25
   102 000000CA                                 L21:
   103 000000CA 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   104 000000CD FF 0A                           	DEC	DWORD [EDX]
   105 000000CF 39 C1                           	CMP	ECX,EAX
   106 000000D1 7D 04                           	JGE	L26
   107 000000D3 48                              	DEC	EAX
   108 000000D4 89 42 04                        	MOV	DWORD [4+EDX],EAX
   109 000000D7                                 L26:
   110 000000D7 8B 02                           	MOV	EAX,DWORD [EDX]
   111 000000D9 39 42 04                        	CMP	DWORD [4+EDX],EAX
   112 000000DC 7C 07                           	JL	L27
   113 000000DE C7 42 04 00000000               	MOV	DWORD [4+EDX],0
   114 000000E5                                 L27:
   115 000000E5 C7 46 04 00000001               	MOV	DWORD [4+ESI],1
   116 000000EC 8B 1A                           	MOV	EBX,DWORD [EDX]
   117 000000EE 39 D9                           	CMP	ECX,EBX
   118 000000F0 7D 0D                           	JGE	L35
   119 000000F2                                 L32:
   120 000000F2 8B 44 8A 0C                     	MOV	EAX,DWORD [12+EDX+ECX*4]
   121 000000F6 89 44 8A 08                     	MOV	DWORD [8+EDX+ECX*4],EAX
   122 000000FA 41                              	INC	ECX
   123 000000FB 39 D9                           	CMP	ECX,EBX
   124 000000FD 7C F3                           	JL	L32
   125 000000FF                                 L35:
   126 000000FF 8B 86 0000012C                  	MOV	EAX,DWORD [300+ESI]
   127 00000105 8B 54 C7 04                     	MOV	EDX,DWORD [4+EDI+EAX*8]
   128 00000109 8B 46 04                        	MOV	EAX,DWORD [4+ESI]
   129 0000010C 89 42 04                        	MOV	DWORD [4+EDX],EAX
   130 0000010F 5B                              	POP	EBX
   131 00000110 5E                              	POP	ESI
   132 00000111 5F                              	POP	EDI
   133 00000112 5D                              	POP	EBP
   134 00000113 C3                              	RET
   135 00000114                                 	GLOBAL	_task_switchsub
   136 00000114                                 _task_switchsub:
   137 00000114 55                              	PUSH	EBP
   138 00000115 31 C9                           	XOR	ECX,ECX
   139 00000117 89 E5                           	MOV	EBP,ESP
   140 00000119 A1 [00000034]                   	MOV	EAX,DWORD [_taskctl]
   141 0000011E 31 D2                           	XOR	EDX,EDX
   142 00000120                                 L42:
   143 00000120 83 7C 10 0C 00                  	CMP	DWORD [12+EAX+EDX*1],0
   144 00000125 7F 0C                           	JG	L38
   145 00000127 41                              	INC	ECX
   146 00000128 81 C2 00000198                  	ADD	EDX,408
   147 0000012E 83 F9 09                        	CMP	ECX,9
   148 00000131 7E ED                           	JLE	L42
   149 00000133                                 L38:
   150 00000133 89 08                           	MOV	DWORD [EAX],ECX
   151 00000135 C6 40 08 00                     	MOV	BYTE [8+EAX],0
   152 00000139 5D                              	POP	EBP
   153 0000013A C3                              	RET
   154 0000013B                                 	GLOBAL	_task_idle
   155 0000013B                                 _task_idle:
   156 0000013B 55                              	PUSH	EBP
   157 0000013C 89 E5                           	MOV	EBP,ESP
   158 0000013E                                 L45:
   159 0000013E E8 [00000000]                   	CALL	_io_hlt
   160 00000143 EB F9                           	JMP	L45
   161 00000145                                 	GLOBAL	_task_init
   162 00000145                                 _task_init:
   163 00000145 55                              	PUSH	EBP
   164 00000146 89 E5                           	MOV	EBP,ESP
   165 00000148 57                              	PUSH	EDI
   166 00000149 56                              	PUSH	ESI
   167 0000014A 31 FF                           	XOR	EDI,EDI
   168 0000014C 53                              	PUSH	EBX
   169 0000014D 31 F6                           	XOR	ESI,ESI
   170 0000014F BB 000003E7                     	MOV	EBX,999
   171 00000154 E8 FFFFFEB9                     	CALL	_init_pid
   172 00000159 68 0004D2BC                     	PUSH	316092
   173 0000015E FF 75 08                        	PUSH	DWORD [8+EBP]
   174 00000161 E8 [00000000]                   	CALL	_memman_alloc_4k
   175 00000166 A3 [00000034]                   	MOV	DWORD [_taskctl],EAX
   176 0000016B 58                              	POP	EAX
   177 0000016C 5A                              	POP	EDX
   178 0000016D                                 L53:
   179 0000016D 89 FA                           	MOV	EDX,EDI
   180 0000016F 8D 46 18                        	LEA	EAX,DWORD [24+ESI]
   181 00000172 03 15 [00000034]                	ADD	EDX,DWORD [_taskctl]
   182 00000178 89 82 00000FFC                  	MOV	DWORD [4092+EDX],EAX
   183 0000017E 8D 86 00001F58                  	LEA	EAX,DWORD [8024+ESI]
   184 00000184 89 82 00001088                  	MOV	DWORD [4232+EDX],EAX
   185 0000018A 8D 86 00270018                  	LEA	EAX,DWORD [2555928+ESI]
   186 00000190 C7 82 00001000 00000000         	MOV	DWORD [4096+EDX],0
   187 0000019A 68 00000089                     	PUSH	137
   188 0000019F 81 C2 00001028                  	ADD	EDX,4136
   189 000001A5 52                              	PUSH	EDX
   190 000001A6 6A 67                           	PUSH	103
   191 000001A8 50                              	PUSH	EAX
   192 000001A9 E8 [00000000]                   	CALL	_set_segmdesc
   193 000001AE A1 [00000034]                   	MOV	EAX,DWORD [_taskctl]
   194 000001B3 01 F8                           	ADD	EAX,EDI
   195 000001B5 68 00000082                     	PUSH	130
   196 000001BA 05 000010FC                     	ADD	EAX,4348
   197 000001BF 81 C7 00000138                  	ADD	EDI,312
   198 000001C5 50                              	PUSH	EAX
   199 000001C6 8D 86 00271F58                  	LEA	EAX,DWORD [2563928+ESI]
   200 000001CC 6A 0F                           	PUSH	15
   201 000001CE 83 C6 08                        	ADD	ESI,8
   202 000001D1 50                              	PUSH	EAX
   203 000001D2 E8 [00000000]                   	CALL	_set_segmdesc
   204 000001D7 83 C4 20                        	ADD	ESP,32
   205 000001DA 4B                              	DEC	EBX
   206 000001DB 79 90                           	JNS	L53
   207 000001DD 8B 0D [00000034]                	MOV	ECX,DWORD [_taskctl]
   208 000001E3 31 D2                           	XOR	EDX,EDX
   209 000001E5 BB 00000009                     	MOV	EBX,9
   210 000001EA                                 L58:
   211 000001EA 8D 04 11                        	LEA	EAX,DWORD [ECX+EDX*1]
   212 000001ED 81 C2 00000198                  	ADD	EDX,408
   213 000001F3 4B                              	DEC	EBX
   214 000001F4 C7 40 0C 00000000               	MOV	DWORD [12+EAX],0
   215 000001FB C7 40 10 00000000               	MOV	DWORD [16+EAX],0
   216 00000202 79 E6                           	JNS	L58
   217 00000204 E8 000000B2                     	CALL	_task_alloc
   218 00000209 89 C6                           	MOV	ESI,EAX
   219 0000020B C7 40 04 00000002               	MOV	DWORD [4+EAX],2
   220 00000212 C7 40 0C 00000002               	MOV	DWORD [12+EAX],2
   221 00000219 C7 40 08 00000000               	MOV	DWORD [8+EAX],0
   222 00000220 50                              	PUSH	EAX
   223 00000221 E8 FFFFFE48                     	CALL	_task_add
   224 00000226 E8 FFFFFEE9                     	CALL	_task_switchsub
   225 0000022B FF 36                           	PUSH	DWORD [ESI]
   226 0000022D E8 [00000000]                   	CALL	_load_tr
   227 00000232 E8 [00000000]                   	CALL	_timer_alloc
   228 00000237 FF 76 0C                        	PUSH	DWORD [12+ESI]
   229 0000023A 50                              	PUSH	EAX
   230 0000023B A3 [00000038]                   	MOV	DWORD [_task_timer],EAX
   231 00000240 E8 [00000000]                   	CALL	_timer_settime
   232 00000245 E8 00000071                     	CALL	_task_alloc
   233 0000024A 68 00010000                     	PUSH	65536
   234 0000024F FF 75 08                        	PUSH	DWORD [8+EBP]
   235 00000252 89 C3                           	MOV	EBX,EAX
   236 00000254 E8 [00000000]                   	CALL	_memman_alloc_4k
   237 00000259 05 00010000                     	ADD	EAX,65536
   238 0000025E 89 43 64                        	MOV	DWORD [100+EBX],EAX
   239 00000261 C7 43 4C [0000013B]             	MOV	DWORD [76+EBX],_task_idle
   240 00000268 C7 43 74 00000008               	MOV	DWORD [116+EBX],8
   241 0000026F C7 43 78 00000010               	MOV	DWORD [120+EBX],16
   242 00000276 C7 43 7C 00000008               	MOV	DWORD [124+EBX],8
   243 0000027D C7 83 00000080 00000008         	MOV	DWORD [128+EBX],8
   244 00000287 C7 83 00000084 00000008         	MOV	DWORD [132+EBX],8
   245 00000291 C7 83 00000088 00000008         	MOV	DWORD [136+EBX],8
   246 0000029B 6A 01                           	PUSH	1
   247 0000029D 6A 09                           	PUSH	9
   248 0000029F 53                              	PUSH	EBX
   249 000002A0 E8 000000F6                     	CALL	_task_run
   250 000002A5 A1 [00000034]                   	MOV	EAX,DWORD [_taskctl]
   251 000002AA C7 40 04 00000000               	MOV	DWORD [4+EAX],0
   252 000002B1 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   253 000002B4 89 F0                           	MOV	EAX,ESI
   254 000002B6 5B                              	POP	EBX
   255 000002B7 5E                              	POP	ESI
   256 000002B8 5F                              	POP	EDI
   257 000002B9 5D                              	POP	EBP
   258 000002BA C3                              	RET
   259 000002BB                                 	GLOBAL	_task_alloc
   260 000002BB                                 _task_alloc:
   261 000002BB 55                              	PUSH	EBP
   262 000002BC 31 C9                           	XOR	ECX,ECX
   263 000002BE 89 E5                           	MOV	EBP,ESP
   264 000002C0                                 L74:
   265 000002C0 89 C8                           	MOV	EAX,ECX
   266 000002C2 69 C0 00000138                  	IMUL	EAX,EAX,312
   267 000002C8 03 05 [00000034]                	ADD	EAX,DWORD [_taskctl]
   268 000002CE 83 B8 00001000 00               	CMP	DWORD [4096+EAX],0
   269 000002D5 74 0D                           	JE	L79
   270 000002D7 41                              	INC	ECX
   271 000002D8 81 F9 000003E7                  	CMP	ECX,999
   272 000002DE 7E E0                           	JLE	L74
   273 000002E0 31 C0                           	XOR	EAX,EAX
   274 000002E2                                 L63:
   275 000002E2 5D                              	POP	EBP
   276 000002E3 C3                              	RET
   277 000002E4                                 L79:
   278 000002E4 8D 90 00000FFC                  	LEA	EDX,DWORD [4092+EAX]
   279 000002EA B9 00000003                     	MOV	ECX,3
   280 000002EF C7 42 04 00000001               	MOV	DWORD [4+EDX],1
   281 000002F6 C7 42 50 00000202               	MOV	DWORD [80+EDX],514
   282 000002FD C7 42 54 00000000               	MOV	DWORD [84+EDX],0
   283 00000304 C7 42 58 00000000               	MOV	DWORD [88+EDX],0
   284 0000030B C7 42 5C 00000000               	MOV	DWORD [92+EDX],0
   285 00000312 C7 42 60 00000000               	MOV	DWORD [96+EDX],0
   286 00000319 C7 42 68 00000000               	MOV	DWORD [104+EDX],0
   287 00000320 C7 42 6C 00000000               	MOV	DWORD [108+EDX],0
   288 00000327 C7 42 70 00000000               	MOV	DWORD [112+EDX],0
   289 0000032E C7 42 74 00000000               	MOV	DWORD [116+EDX],0
   290 00000335 C7 82 00000080 00000000         	MOV	DWORD [128+EDX],0
   291 0000033F C7 82 00000084 00000000         	MOV	DWORD [132+EDX],0
   292 00000349 C7 82 00000088 00000000         	MOV	DWORD [136+EDX],0
   293 00000353 C7 82 00000090 40000000         	MOV	DWORD [144+EDX],1073741824
   294 0000035D C7 42 34 00000000               	MOV	DWORD [52+EDX],0
   295 00000364 C7 82 00000094 0000037F         	MOV	DWORD [148+EDX],895
   296 0000036E C7 82 00000098 00000000         	MOV	DWORD [152+EDX],0
   297 00000378 C7 82 0000009C 0000FFFF         	MOV	DWORD [156+EDX],65535
   298 00000382                                 L73:
   299 00000382 C7 84 8A 00000094 00000000      	MOV	DWORD [148+EDX+ECX*4],0
   300 0000038D 41                              	INC	ECX
   301 0000038E 89 D0                           	MOV	EAX,EDX
   302 00000390 83 F9 1A                        	CMP	ECX,26
   303 00000393 0F 8F FFFFFF49                  	JG	L63
   304 00000399 EB E7                           	JMP	L73
   305 0000039B                                 	GLOBAL	_task_run
   306 0000039B                                 _task_run:
   307 0000039B 55                              	PUSH	EBP
   308 0000039C 89 E5                           	MOV	EBP,ESP
   309 0000039E 57                              	PUSH	EDI
   310 0000039F 56                              	PUSH	ESI
   311 000003A0 53                              	PUSH	EBX
   312 000003A1 8B 7D 0C                        	MOV	EDI,DWORD [12+EBP]
   313 000003A4 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   314 000003A7 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   315 000003AA 8B 35 00000F0A                  	MOV	ESI,DWORD [3850]
   316 000003B0 85 FF                           	TEST	EDI,EDI
   317 000003B2 78 76                           	JS	L86
   318 000003B4                                 L81:
   319 000003B4 85 C0                           	TEST	EAX,EAX
   320 000003B6 7E 03                           	JLE	L82
   321 000003B8 89 43 0C                        	MOV	DWORD [12+EBX],EAX
   322 000003BB                                 L82:
   323 000003BB 83 7B 04 01                     	CMP	DWORD [4+EBX],1
   324 000003BF 74 4E                           	JE	L87
   325 000003C1                                 L83:
   326 000003C1 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   327 000003C5 74 3A                           	JE	L88
   328 000003C7                                 L84:
   329 000003C7 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   330 000003CB 74 23                           	JE	L85
   331 000003CD 8B 86 00013878                  	MOV	EAX,DWORD [79992+ESI]
   332 000003D3 8D 50 01                        	LEA	EDX,DWORD [1+EAX]
   333 000003D6 89 5C C6 04                     	MOV	DWORD [4+ESI+EAX*8],EBX
   334 000003DA 89 96 00013878                  	MOV	DWORD [79992+ESI],EDX
   335 000003E0 89 7B 08                        	MOV	DWORD [8+EBX],EDI
   336 000003E3 89 83 0000012C                  	MOV	DWORD [300+EBX],EAX
   337 000003E9 53                              	PUSH	EBX
   338 000003EA E8 FFFFFC7F                     	CALL	_task_add
   339 000003EF 59                              	POP	ECX
   340 000003F0                                 L85:
   341 000003F0 A1 [00000034]                   	MOV	EAX,DWORD [_taskctl]
   342 000003F5 C6 40 08 01                     	MOV	BYTE [8+EAX],1
   343 000003F9 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   344 000003FC 5B                              	POP	EBX
   345 000003FD 5E                              	POP	ESI
   346 000003FE 5F                              	POP	EDI
   347 000003FF 5D                              	POP	EBP
   348 00000400 C3                              	RET
   349 00000401                                 L88:
   350 00000401 39 7B 08                        	CMP	DWORD [8+EBX],EDI
   351 00000404 74 C1                           	JE	L84
   352 00000406 53                              	PUSH	EBX
   353 00000407 E8 FFFFFC8B                     	CALL	_task_remove
   354 0000040C 58                              	POP	EAX
   355 0000040D EB B8                           	JMP	L84
   356 0000040F                                 L87:
   357 0000040F 8B 86 00013878                  	MOV	EAX,DWORD [79992+ESI]
   358 00000415 8D 50 01                        	LEA	EDX,DWORD [1+EAX]
   359 00000418 89 5C C6 04                     	MOV	DWORD [4+ESI+EAX*8],EBX
   360 0000041C 89 96 00013878                  	MOV	DWORD [79992+ESI],EDX
   361 00000422 89 83 0000012C                  	MOV	DWORD [300+EBX],EAX
   362 00000428 EB 97                           	JMP	L83
   363 0000042A                                 L86:
   364 0000042A 8B 7B 08                        	MOV	EDI,DWORD [8+EBX]
   365 0000042D EB 85                           	JMP	L81
   366 0000042F                                 	GLOBAL	_task_sleep
   367 0000042F                                 _task_sleep:
   368 0000042F 55                              	PUSH	EBP
   369 00000430 89 E5                           	MOV	EBP,ESP
   370 00000432 56                              	PUSH	ESI
   371 00000433 53                              	PUSH	EBX
   372 00000434 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   373 00000437 83 7E 04 02                     	CMP	DWORD [4+ESI],2
   374 0000043B 74 07                           	JE	L92
   375 0000043D                                 L89:
   376 0000043D 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   377 00000440 5B                              	POP	EBX
   378 00000441 5E                              	POP	ESI
   379 00000442 5D                              	POP	EBP
   380 00000443 C3                              	RET
   381 00000444                                 L92:
   382 00000444 E8 FFFFFC08                     	CALL	_task_now
   383 00000449 56                              	PUSH	ESI
   384 0000044A 89 C3                           	MOV	EBX,EAX
   385 0000044C E8 FFFFFC46                     	CALL	_task_remove
   386 00000451 59                              	POP	ECX
   387 00000452 39 DE                           	CMP	ESI,EBX
   388 00000454 75 E7                           	JNE	L89
   389 00000456 E8 FFFFFCB9                     	CALL	_task_switchsub
   390 0000045B E8 FFFFFBF1                     	CALL	_task_now
   391 00000460 FF 30                           	PUSH	DWORD [EAX]
   392 00000462 6A 00                           	PUSH	0
   393 00000464 E8 [00000000]                   	CALL	_farjmp
   394 00000469 58                              	POP	EAX
   395 0000046A 5A                              	POP	EDX
   396 0000046B EB D0                           	JMP	L89
   397 0000046D                                 	GLOBAL	_task_switch
   398 0000046D                                 _task_switch:
   399 0000046D 55                              	PUSH	EBP
   400 0000046E 89 E5                           	MOV	EBP,ESP
   401 00000470 56                              	PUSH	ESI
   402 00000471 53                              	PUSH	EBX
   403 00000472 8B 1D [00000034]                	MOV	EBX,DWORD [_taskctl]
   404 00000478 8B 13                           	MOV	EDX,DWORD [EBX]
   405 0000047A 69 D2 00000198                  	IMUL	EDX,EDX,408
   406 00000480 8D 14 1A                        	LEA	EDX,DWORD [EDX+EBX*1]
   407 00000483 8D 4A 0C                        	LEA	ECX,DWORD [12+EDX]
   408 00000486 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   409 00000489 8B 74 81 08                     	MOV	ESI,DWORD [8+ECX+EAX*4]
   410 0000048D 40                              	INC	EAX
   411 0000048E 89 41 04                        	MOV	DWORD [4+ECX],EAX
   412 00000491 3B 42 0C                        	CMP	EAX,DWORD [12+EDX]
   413 00000494 74 4C                           	JE	L97
   414 00000496                                 L94:
   415 00000496 80 7B 08 00                     	CMP	BYTE [8+EBX],0
   416 0000049A 75 2D                           	JNE	L98
   417 0000049C                                 L95:
   418 0000049C 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   419 0000049F 8B 5C 81 08                     	MOV	EBX,DWORD [8+ECX+EAX*4]
   420 000004A3 FF 73 0C                        	PUSH	DWORD [12+EBX]
   421 000004A6 FF 35 [00000038]                	PUSH	DWORD [_task_timer]
   422 000004AC E8 [00000000]                   	CALL	_timer_settime
   423 000004B1 39 F3                           	CMP	EBX,ESI
   424 000004B3 58                              	POP	EAX
   425 000004B4 5A                              	POP	EDX
   426 000004B5 74 0B                           	JE	L93
   427 000004B7 FF 33                           	PUSH	DWORD [EBX]
   428 000004B9 6A 00                           	PUSH	0
   429 000004BB E8 [00000000]                   	CALL	_farjmp
   430 000004C0 5B                              	POP	EBX
   431 000004C1 5E                              	POP	ESI
   432 000004C2                                 L93:
   433 000004C2 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   434 000004C5 5B                              	POP	EBX
   435 000004C6 5E                              	POP	ESI
   436 000004C7 5D                              	POP	EBP
   437 000004C8 C3                              	RET
   438 000004C9                                 L98:
   439 000004C9 E8 FFFFFC46                     	CALL	_task_switchsub
   440 000004CE 8B 15 [00000034]                	MOV	EDX,DWORD [_taskctl]
   441 000004D4 8B 02                           	MOV	EAX,DWORD [EDX]
   442 000004D6 69 C0 00000198                  	IMUL	EAX,EAX,408
   443 000004DC 8D 4C 10 0C                     	LEA	ECX,DWORD [12+EAX+EDX*1]
   444 000004E0 EB BA                           	JMP	L95
   445 000004E2                                 L97:
   446 000004E2 C7 41 04 00000000               	MOV	DWORD [4+ECX],0
   447 000004E9 EB AB                           	JMP	L94
   448 000004EB                                 	GLOBAL	_inthandler07
   449 000004EB                                 _inthandler07:
   450 000004EB 55                              	PUSH	EBP
   451 000004EC 89 E5                           	MOV	EBP,ESP
   452 000004EE 53                              	PUSH	EBX
   453 000004EF E8 FFFFFB5D                     	CALL	_task_now
   454 000004F4 89 C3                           	MOV	EBX,EAX
   455 000004F6 E8 [00000000]                   	CALL	_io_cli
   456 000004FB E8 [00000000]                   	CALL	_clts
   457 00000500 A1 [00000034]                   	MOV	EAX,DWORD [_taskctl]
   458 00000505 8B 40 04                        	MOV	EAX,DWORD [4+EAX]
   459 00000508 39 D8                           	CMP	EAX,EBX
   460 0000050A 74 19                           	JE	L100
   461 0000050C 85 C0                           	TEST	EAX,EAX
   462 0000050E 75 21                           	JNE	L102
   463 00000510                                 L101:
   464 00000510 8D 83 00000094                  	LEA	EAX,DWORD [148+EBX]
   465 00000516 50                              	PUSH	EAX
   466 00000517 E8 [00000000]                   	CALL	_frstor
   467 0000051C A1 [00000034]                   	MOV	EAX,DWORD [_taskctl]
   468 00000521 89 58 04                        	MOV	DWORD [4+EAX],EBX
   469 00000524 59                              	POP	ECX
   470 00000525                                 L100:
   471 00000525 E8 [00000000]                   	CALL	_io_sti
   472 0000052A 8B 5D FC                        	MOV	EBX,DWORD [-4+EBP]
   473 0000052D 31 C0                           	XOR	EAX,EAX
   474 0000052F C9                              	LEAVE
   475 00000530 C3                              	RET
   476 00000531                                 L102:
   477 00000531 05 00000094                     	ADD	EAX,148
   478 00000536 50                              	PUSH	EAX
   479 00000537 E8 [00000000]                   	CALL	_fnsave
   480 0000053C 58                              	POP	EAX
   481 0000053D EB D1                           	JMP	L101
   482 0000053F                                 	GLOBAL	_task_block
   483 0000053F                                 _task_block:
   484 0000053F 55                              	PUSH	EBP
   485 00000540 89 E5                           	MOV	EBP,ESP
   486 00000542 57                              	PUSH	EDI
   487 00000543 56                              	PUSH	ESI
   488 00000544 53                              	PUSH	EBX
   489 00000545 53                              	PUSH	EBX
   490 00000546 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   491 00000549 A1 00000F0A                     	MOV	EAX,DWORD [3850]
   492 0000054E 89 45 F0                        	MOV	DWORD [-16+EBP],EAX
   493 00000551 8B 1D 00000F0F                  	MOV	EBX,DWORD [3855]
   494 00000557 83 7F 04 02                     	CMP	DWORD [4+EDI],2
   495 0000055B 74 08                           	JE	L106
   496 0000055D                                 L103:
   497 0000055D 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   498 00000560 5B                              	POP	EBX
   499 00000561 5E                              	POP	ESI
   500 00000562 5F                              	POP	EDI
   501 00000563 5D                              	POP	EBP
   502 00000564 C3                              	RET
   503 00000565                                 L106:
   504 00000565 E8 FFFFFAE7                     	CALL	_task_now
   505 0000056A 57                              	PUSH	EDI
   506 0000056B 89 C6                           	MOV	ESI,EAX
   507 0000056D E8 FFFFFB25                     	CALL	_task_remove
   508 00000572 8B 87 0000012C                  	MOV	EAX,DWORD [300+EDI]
   509 00000578 8B 4D F0                        	MOV	ECX,DWORD [-16+EBP]
   510 0000057B C7 47 04 00000003               	MOV	DWORD [4+EDI],3
   511 00000582 8B 54 C1 04                     	MOV	EDX,DWORD [4+ECX+EAX*8]
   512 00000586 C7 42 04 00000003               	MOV	DWORD [4+EDX],3
   513 0000058D 8B 93 00001F40                  	MOV	EDX,DWORD [8000+EBX]
   514 00000593 89 04 D3                        	MOV	DWORD [EBX+EDX*8],EAX
   515 00000596 89 7C D3 04                     	MOV	DWORD [4+EBX+EDX*8],EDI
   516 0000059A FF 83 00001F40                  	INC	DWORD [8000+EBX]
   517 000005A0 39 F7                           	CMP	EDI,ESI
   518 000005A2 59                              	POP	ECX
   519 000005A3 75 B8                           	JNE	L103
   520 000005A5 E8 FFFFFB6A                     	CALL	_task_switchsub
   521 000005AA E8 FFFFFAA2                     	CALL	_task_now
   522 000005AF FF 30                           	PUSH	DWORD [EAX]
   523 000005B1 6A 00                           	PUSH	0
   524 000005B3 E8 [00000000]                   	CALL	_farjmp
   525 000005B8 58                              	POP	EAX
   526 000005B9 5A                              	POP	EDX
   527 000005BA EB A1                           	JMP	L103
   528                                          [SECTION .data]
   529 00000000                                 LC0:
   530 00000000 6D 74 61 73 6B 20 6D 65 73 73   	DB	"mtask message ublock run1",0x00
       0000000A 61 67 65 20 75 62 6C 6F 63 6B 
       00000014 20 72 75 6E 31 00 
   531 0000001A                                 LC1:
   532 0000001A 6D 74 61 73 6B 20 6D 65 73 73   	DB	"mtask message ublock run2",0x00
       00000024 61 67 65 20 75 62 6C 6F 63 6B 
       0000002E 20 72 75 6E 32 00 
   533                                          [SECTION .text]
   534 000005BC                                 	GLOBAL	_task_unblock
   535 000005BC                                 _task_unblock:
   536 000005BC 55                              	PUSH	EBP
   537 000005BD 89 E5                           	MOV	EBP,ESP
   538 000005BF 57                              	PUSH	EDI
   539 000005C0 56                              	PUSH	ESI
   540 000005C1 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   541 000005C4 53                              	PUSH	EBX
   542 000005C5 8B 1D 00000F0A                  	MOV	EBX,DWORD [3850]
   543 000005CB 8B 35 00000F0F                  	MOV	ESI,DWORD [3855]
   544 000005D1 FF 77 0C                        	PUSH	DWORD [12+EDI]
   545 000005D4 FF 77 08                        	PUSH	DWORD [8+EDI]
   546 000005D7 57                              	PUSH	EDI
   547 000005D8 E8 FFFFFDBE                     	CALL	_task_run
   548 000005DD 6A 0F                           	PUSH	15
   549 000005DF 68 000000FF                     	PUSH	255
   550 000005E4 6A 00                           	PUSH	0
   551 000005E6 6A 00                           	PUSH	0
   552 000005E8 6A 00                           	PUSH	0
   553 000005EA 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   554 000005F1 50                              	PUSH	EAX
   555 000005F2 FF 35 00000FF8                  	PUSH	DWORD [4088]
   556 000005F8 E8 [00000000]                   	CALL	_boxfill8
   557 000005FD 83 C4 28                        	ADD	ESP,40
   558 00000600 68 [00000000]                   	PUSH	LC0
   559 00000605 6A 07                           	PUSH	7
   560 00000607 6A 00                           	PUSH	0
   561 00000609 6A 00                           	PUSH	0
   562 0000060B 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   563 00000612 50                              	PUSH	EAX
   564 00000613 FF 35 00000FF8                  	PUSH	DWORD [4088]
   565 00000619 E8 [00000000]                   	CALL	_putfonts8_asc
   566 0000061E 83 C4 18                        	ADD	ESP,24
   567 00000621 8B 87 0000012C                  	MOV	EAX,DWORD [300+EDI]
   568 00000627 8B 54 C3 04                     	MOV	EDX,DWORD [4+EBX+EAX*8]
   569 0000062B 31 DB                           	XOR	EBX,EBX
   570 0000062D 8B 47 04                        	MOV	EAX,DWORD [4+EDI]
   571 00000630 89 42 04                        	MOV	DWORD [4+EDX],EAX
   572 00000633 8B 86 00001F40                  	MOV	EAX,DWORD [8000+ESI]
   573 00000639 39 C3                           	CMP	EBX,EAX
   574 0000063B 7D 0B                           	JGE	L109
   575 0000063D                                 L113:
   576 0000063D 39 7C DE 04                     	CMP	DWORD [4+ESI+EBX*8],EDI
   577 00000641 74 75                           	JE	L122
   578 00000643 43                              	INC	EBX
   579 00000644 39 C3                           	CMP	EBX,EAX
   580 00000646 7C F5                           	JL	L113
   581 00000648                                 L109:
   582 00000648 6A 0F                           	PUSH	15
   583 0000064A 68 000000FF                     	PUSH	255
   584 0000064F 6A 00                           	PUSH	0
   585 00000651 6A 00                           	PUSH	0
   586 00000653 6A 00                           	PUSH	0
   587 00000655 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   588 0000065C 50                              	PUSH	EAX
   589 0000065D FF 35 00000FF8                  	PUSH	DWORD [4088]
   590 00000663 E8 [00000000]                   	CALL	_boxfill8
   591 00000668 68 [0000001A]                   	PUSH	LC1
   592 0000066D 6A 07                           	PUSH	7
   593 0000066F 6A 00                           	PUSH	0
   594 00000671 6A 00                           	PUSH	0
   595 00000673 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   596 0000067A 50                              	PUSH	EAX
   597 0000067B FF 35 00000FF8                  	PUSH	DWORD [4088]
   598 00000681 E8 [00000000]                   	CALL	_putfonts8_asc
   599 00000686 8B 8E 00001F40                  	MOV	ECX,DWORD [8000+ESI]
   600 0000068C 83 C4 34                        	ADD	ESP,52
   601 0000068F 39 CB                           	CMP	EBX,ECX
   602 00000691 7D 14                           	JGE	L121
   603 00000693                                 L118:
   604 00000693 8B 44 DE 08                     	MOV	EAX,DWORD [8+ESI+EBX*8]
   605 00000697 8B 54 DE 0C                     	MOV	EDX,DWORD [12+ESI+EBX*8]
   606 0000069B 89 04 DE                        	MOV	DWORD [ESI+EBX*8],EAX
   607 0000069E 89 54 DE 04                     	MOV	DWORD [4+ESI+EBX*8],EDX
   608 000006A2 43                              	INC	EBX
   609 000006A3 39 CB                           	CMP	EBX,ECX
   610 000006A5 7C EC                           	JL	L118
   611 000006A7                                 L121:
   612 000006A7 8D 41 FF                        	LEA	EAX,DWORD [-1+ECX]
   613 000006AA 89 86 00001F40                  	MOV	DWORD [8000+ESI],EAX
   614 000006B0 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   615 000006B3 5B                              	POP	EBX
   616 000006B4 5E                              	POP	ESI
   617 000006B5 5F                              	POP	EDI
   618 000006B6 5D                              	POP	EBP
   619 000006B7 C3                              	RET
   620 000006B8                                 L122:
   621 000006B8 C7 44 DE 04 00000000            	MOV	DWORD [4+ESI+EBX*8],0
   622 000006C0 C7 04 DE 00000000               	MOV	DWORD [ESI+EBX*8],0
   623 000006C7 E9 FFFFFF7C                     	JMP	L109
   624 000006CC                                 	GLOBAL	_message_receive
   625 000006CC                                 _message_receive:
   626 000006CC 55                              	PUSH	EBP
   627 000006CD 89 E5                           	MOV	EBP,ESP
   628 000006CF 56                              	PUSH	ESI
   629 000006D0 53                              	PUSH	EBX
   630 000006D1 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   631 000006D4 E8 FFFFF978                     	CALL	_task_now
   632 000006D9 89 C3                           	MOV	EBX,EAX
   633 000006DB C7 80 00000130 00000001         	MOV	DWORD [304+EAX],1
   634 000006E5                                 L124:
   635 000006E5 8B 83 00000134                  	MOV	EAX,DWORD [308+EBX]
   636 000006EB 85 C0                           	TEST	EAX,EAX
   637 000006ED 75 0E                           	JNE	L134
   638 000006EF                                 L131:
   639 000006EF E8 FFFFF95D                     	CALL	_task_now
   640 000006F4 50                              	PUSH	EAX
   641 000006F5                                 L132:
   642 000006F5 E8 FFFFFE45                     	CALL	_task_block
   643 000006FA 58                              	POP	EAX
   644 000006FB EB E8                           	JMP	L124
   645 000006FD                                 L134:
   646 000006FD 81 FE 00002710                  	CMP	ESI,10000
   647 00000703 74 08                           	JE	L133
   648 00000705 39 70 0C                        	CMP	DWORD [12+EAX],ESI
   649 00000708 74 03                           	JE	L133
   650 0000070A 53                              	PUSH	EBX
   651 0000070B EB E8                           	JMP	L132
   652 0000070D                                 L133:
   653 0000070D C7 83 00000130 00000000         	MOV	DWORD [304+EBX],0
   654 00000717 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   655 0000071A 31 C0                           	XOR	EAX,EAX
   656 0000071C 5B                              	POP	EBX
   657 0000071D 5E                              	POP	ESI
   658 0000071E 5D                              	POP	EBP
   659 0000071F C3                              	RET
   660 00000720                                 	GLOBAL	_message_send
   661 00000720                                 _message_send:
   662 00000720 55                              	PUSH	EBP
   663 00000721 89 E5                           	MOV	EBP,ESP
   664 00000723 56                              	PUSH	ESI
   665 00000724 53                              	PUSH	EBX
   666 00000725 FF 75 08                        	PUSH	DWORD [8+EBP]
   667 00000728 8B 75 0C                        	MOV	ESI,DWORD [12+EBP]
   668 0000072B E8 FFFFF8D0                     	CALL	_pid2task
   669 00000730 89 C3                           	MOV	EBX,EAX
   670 00000732 58                              	POP	EAX
   671 00000733 83 C8 FF                        	OR	EAX,-1
   672 00000736 85 DB                           	TEST	EBX,EBX
   673 00000738 74 1F                           	JE	L135
   674 0000073A E8 FFFFF912                     	CALL	_task_now
   675 0000073F 89 B3 00000134                  	MOV	DWORD [308+EBX],ESI
   676 00000745 8B 80 0000012C                  	MOV	EAX,DWORD [300+EAX]
   677 0000074B 89 46 0C                        	MOV	DWORD [12+ESI],EAX
   678 0000074E 83 BB 00000130 01               	CMP	DWORD [304+EBX],1
   679 00000755 74 09                           	JE	L138
   680 00000757                                 L137:
   681 00000757 31 C0                           	XOR	EAX,EAX
   682 00000759                                 L135:
   683 00000759 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   684 0000075C 5B                              	POP	EBX
   685 0000075D 5E                              	POP	ESI
   686 0000075E 5D                              	POP	EBP
   687 0000075F C3                              	RET
   688 00000760                                 L138:
   689 00000760 53                              	PUSH	EBX
   690 00000761 E8 FFFFFE56                     	CALL	_task_unblock
   691 00000766 58                              	POP	EAX
   692 00000767 EB EE                           	JMP	L137
   693 00000769                                 	GLOBAL	_taskctl
   694                                          [SECTION .data]
   695 00000034                                 	ALIGNB	4
   696 00000034                                 _taskctl:
   697 00000034 00 00 00 00                     	RESB	4
   698 00000038                                 	GLOBAL	_task_timer
   699                                          [SECTION .data]
   700 00000038                                 	ALIGNB	4
   701 00000038                                 _task_timer:
   702 00000038 00 00 00 00                     	RESB	4
