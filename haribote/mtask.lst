     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_hlt
     7 00000000                                 	EXTERN	_memman_alloc_4k
     8 00000000                                 	EXTERN	_set_segmdesc
     9 00000000                                 	EXTERN	_load_tr
    10 00000000                                 	EXTERN	_timer_alloc
    11 00000000                                 	EXTERN	_timer_settime
    12 00000000                                 	EXTERN	_farjmp
    13 00000000                                 	EXTERN	_io_cli
    14 00000000                                 	EXTERN	_clts
    15 00000000                                 	EXTERN	_frstor
    16 00000000                                 	EXTERN	_io_sti
    17 00000000                                 	EXTERN	_fnsave
    18 00000000                                 [FILE "mtask.c"]
    19                                          [SECTION .text]
    20 00000000                                 	GLOBAL	_pid2task
    21 00000000                                 _pid2task:
    22 00000000 55                              	PUSH	EBP
    23 00000001 89 E5                           	MOV	EBP,ESP
    24 00000003 8B 15 00000F0A                  	MOV	EDX,DWORD [3850]
    25 00000009 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    26 0000000C 5D                              	POP	EBP
    27 0000000D 8B 44 C2 04                     	MOV	EAX,DWORD [4+EDX+EAX*8]
    28 00000011 C3                              	RET
    29 00000012                                 	GLOBAL	_init_pid
    30 00000012                                 _init_pid:
    31 00000012 55                              	PUSH	EBP
    32 00000013 31 C0                           	XOR	EAX,EAX
    33 00000015 89 E5                           	MOV	EBP,ESP
    34 00000017 C7 82 00013878 00000000         	MOV	DWORD [79992+EDX],0
    35 00000021 C7 82 00001F40 00000000         	MOV	DWORD [8000+EDX],0
    36 0000002B                                 L7:
    37 0000002B 89 04 C2                        	MOV	DWORD [EDX+EAX*8],EAX
    38 0000002E 40                              	INC	EAX
    39 0000002F 3D 0000270F                     	CMP	EAX,9999
    40 00000034 7E F5                           	JLE	L7
    41 00000036 31 C0                           	XOR	EAX,EAX
    42 00000038                                 L12:
    43 00000038 89 04 C2                        	MOV	DWORD [EDX+EAX*8],EAX
    44 0000003B 40                              	INC	EAX
    45 0000003C 3D 000003E8                     	CMP	EAX,1000
    46 00000041 7E F5                           	JLE	L12
    47 00000043 89 15 00000F0A                  	MOV	DWORD [3850],EDX
    48 00000049 89 15 00000F0F                  	MOV	DWORD [3855],EDX
    49 0000004F 5D                              	POP	EBP
    50 00000050 C3                              	RET
    51 00000051                                 	GLOBAL	_task_now
    52 00000051                                 _task_now:
    53 00000051 A1 [00000000]                   	MOV	EAX,DWORD [_taskctl]
    54 00000056 55                              	PUSH	EBP
    55 00000057 89 E5                           	MOV	EBP,ESP
    56 00000059 5D                              	POP	EBP
    57 0000005A 8B 10                           	MOV	EDX,DWORD [EAX]
    58 0000005C 69 D2 00000198                  	IMUL	EDX,EDX,408
    59 00000062 8D 44 02 0C                     	LEA	EAX,DWORD [12+EDX+EAX*1]
    60 00000066 8B 50 04                        	MOV	EDX,DWORD [4+EAX]
    61 00000069 8B 44 90 08                     	MOV	EAX,DWORD [8+EAX+EDX*4]
    62 0000006D C3                              	RET
    63 0000006E                                 	GLOBAL	_task_add
    64 0000006E                                 _task_add:
    65 0000006E 55                              	PUSH	EBP
    66 0000006F 89 E5                           	MOV	EBP,ESP
    67 00000071 8B 4D 08                        	MOV	ECX,DWORD [8+EBP]
    68 00000074 8B 51 08                        	MOV	EDX,DWORD [8+ECX]
    69 00000077 69 D2 00000198                  	IMUL	EDX,EDX,408
    70 0000007D 03 15 [00000000]                	ADD	EDX,DWORD [_taskctl]
    71 00000083 8B 42 0C                        	MOV	EAX,DWORD [12+EDX]
    72 00000086 89 4C 82 14                     	MOV	DWORD [20+EDX+EAX*4],ECX
    73 0000008A 40                              	INC	EAX
    74 0000008B 89 42 0C                        	MOV	DWORD [12+EDX],EAX
    75 0000008E C7 41 04 00000002               	MOV	DWORD [4+ECX],2
    76 00000095 5D                              	POP	EBP
    77 00000096 C3                              	RET
    78 00000097                                 	GLOBAL	_task_remove
    79 00000097                                 _task_remove:
    80 00000097 55                              	PUSH	EBP
    81 00000098 31 C9                           	XOR	ECX,ECX
    82 0000009A 89 E5                           	MOV	EBP,ESP
    83 0000009C 57                              	PUSH	EDI
    84 0000009D 56                              	PUSH	ESI
    85 0000009E 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
    86 000000A1 53                              	PUSH	EBX
    87 000000A2 8B 3D 00000F0A                  	MOV	EDI,DWORD [3850]
    88 000000A8 8B 46 08                        	MOV	EAX,DWORD [8+ESI]
    89 000000AB 69 C0 00000198                  	IMUL	EAX,EAX,408
    90 000000B1 03 05 [00000000]                	ADD	EAX,DWORD [_taskctl]
    91 000000B7 8D 50 0C                        	LEA	EDX,DWORD [12+EAX]
    92 000000BA 3B 48 0C                        	CMP	ECX,DWORD [12+EAX]
    93 000000BD 7D 0B                           	JGE	L21
    94 000000BF                                 L25:
    95 000000BF 39 74 8A 08                     	CMP	DWORD [8+EDX+ECX*4],ESI
    96 000000C3 74 05                           	JE	L21
    97 000000C5 41                              	INC	ECX
    98 000000C6 3B 0A                           	CMP	ECX,DWORD [EDX]
    99 000000C8 7C F5                           	JL	L25
   100 000000CA                                 L21:
   101 000000CA 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   102 000000CD FF 0A                           	DEC	DWORD [EDX]
   103 000000CF 39 C1                           	CMP	ECX,EAX
   104 000000D1 7D 04                           	JGE	L26
   105 000000D3 48                              	DEC	EAX
   106 000000D4 89 42 04                        	MOV	DWORD [4+EDX],EAX
   107 000000D7                                 L26:
   108 000000D7 8B 02                           	MOV	EAX,DWORD [EDX]
   109 000000D9 39 42 04                        	CMP	DWORD [4+EDX],EAX
   110 000000DC 7C 07                           	JL	L27
   111 000000DE C7 42 04 00000000               	MOV	DWORD [4+EDX],0
   112 000000E5                                 L27:
   113 000000E5 C7 46 04 00000001               	MOV	DWORD [4+ESI],1
   114 000000EC 8B 1A                           	MOV	EBX,DWORD [EDX]
   115 000000EE 39 D9                           	CMP	ECX,EBX
   116 000000F0 7D 0D                           	JGE	L35
   117 000000F2                                 L32:
   118 000000F2 8B 44 8A 0C                     	MOV	EAX,DWORD [12+EDX+ECX*4]
   119 000000F6 89 44 8A 08                     	MOV	DWORD [8+EDX+ECX*4],EAX
   120 000000FA 41                              	INC	ECX
   121 000000FB 39 D9                           	CMP	ECX,EBX
   122 000000FD 7C F3                           	JL	L32
   123 000000FF                                 L35:
   124 000000FF 8B 86 0000012C                  	MOV	EAX,DWORD [300+ESI]
   125 00000105 8B 54 C7 04                     	MOV	EDX,DWORD [4+EDI+EAX*8]
   126 00000109 8B 46 04                        	MOV	EAX,DWORD [4+ESI]
   127 0000010C 89 42 04                        	MOV	DWORD [4+EDX],EAX
   128 0000010F 5B                              	POP	EBX
   129 00000110 5E                              	POP	ESI
   130 00000111 5F                              	POP	EDI
   131 00000112 5D                              	POP	EBP
   132 00000113 C3                              	RET
   133 00000114                                 	GLOBAL	_task_switchsub
   134 00000114                                 _task_switchsub:
   135 00000114 55                              	PUSH	EBP
   136 00000115 31 C9                           	XOR	ECX,ECX
   137 00000117 89 E5                           	MOV	EBP,ESP
   138 00000119 A1 [00000000]                   	MOV	EAX,DWORD [_taskctl]
   139 0000011E 31 D2                           	XOR	EDX,EDX
   140 00000120                                 L42:
   141 00000120 83 7C 10 0C 00                  	CMP	DWORD [12+EAX+EDX*1],0
   142 00000125 7F 0C                           	JG	L38
   143 00000127 41                              	INC	ECX
   144 00000128 81 C2 00000198                  	ADD	EDX,408
   145 0000012E 83 F9 09                        	CMP	ECX,9
   146 00000131 7E ED                           	JLE	L42
   147 00000133                                 L38:
   148 00000133 89 08                           	MOV	DWORD [EAX],ECX
   149 00000135 C6 40 08 00                     	MOV	BYTE [8+EAX],0
   150 00000139 5D                              	POP	EBP
   151 0000013A C3                              	RET
   152 0000013B                                 	GLOBAL	_task_idle
   153 0000013B                                 _task_idle:
   154 0000013B 55                              	PUSH	EBP
   155 0000013C 89 E5                           	MOV	EBP,ESP
   156 0000013E                                 L45:
   157 0000013E E8 [00000000]                   	CALL	_io_hlt
   158 00000143 EB F9                           	JMP	L45
   159 00000145                                 	GLOBAL	_task_init
   160 00000145                                 _task_init:
   161 00000145 55                              	PUSH	EBP
   162 00000146 89 E5                           	MOV	EBP,ESP
   163 00000148 57                              	PUSH	EDI
   164 00000149 56                              	PUSH	ESI
   165 0000014A 31 FF                           	XOR	EDI,EDI
   166 0000014C 53                              	PUSH	EBX
   167 0000014D 31 F6                           	XOR	ESI,ESI
   168 0000014F BB 000003E7                     	MOV	EBX,999
   169 00000154 E8 FFFFFEB9                     	CALL	_init_pid
   170 00000159 68 0004D2BC                     	PUSH	316092
   171 0000015E FF 75 08                        	PUSH	DWORD [8+EBP]
   172 00000161 E8 [00000000]                   	CALL	_memman_alloc_4k
   173 00000166 A3 [00000000]                   	MOV	DWORD [_taskctl],EAX
   174 0000016B 58                              	POP	EAX
   175 0000016C 5A                              	POP	EDX
   176 0000016D                                 L53:
   177 0000016D 89 FA                           	MOV	EDX,EDI
   178 0000016F 8D 46 18                        	LEA	EAX,DWORD [24+ESI]
   179 00000172 03 15 [00000000]                	ADD	EDX,DWORD [_taskctl]
   180 00000178 89 82 00000FFC                  	MOV	DWORD [4092+EDX],EAX
   181 0000017E 8D 86 00001F58                  	LEA	EAX,DWORD [8024+ESI]
   182 00000184 89 82 00001088                  	MOV	DWORD [4232+EDX],EAX
   183 0000018A 8D 86 00270018                  	LEA	EAX,DWORD [2555928+ESI]
   184 00000190 C7 82 00001000 00000000         	MOV	DWORD [4096+EDX],0
   185 0000019A 68 00000089                     	PUSH	137
   186 0000019F 81 C2 00001028                  	ADD	EDX,4136
   187 000001A5 52                              	PUSH	EDX
   188 000001A6 6A 67                           	PUSH	103
   189 000001A8 50                              	PUSH	EAX
   190 000001A9 E8 [00000000]                   	CALL	_set_segmdesc
   191 000001AE A1 [00000000]                   	MOV	EAX,DWORD [_taskctl]
   192 000001B3 01 F8                           	ADD	EAX,EDI
   193 000001B5 68 00000082                     	PUSH	130
   194 000001BA 05 000010FC                     	ADD	EAX,4348
   195 000001BF 81 C7 00000138                  	ADD	EDI,312
   196 000001C5 50                              	PUSH	EAX
   197 000001C6 8D 86 00271F58                  	LEA	EAX,DWORD [2563928+ESI]
   198 000001CC 6A 0F                           	PUSH	15
   199 000001CE 83 C6 08                        	ADD	ESI,8
   200 000001D1 50                              	PUSH	EAX
   201 000001D2 E8 [00000000]                   	CALL	_set_segmdesc
   202 000001D7 83 C4 20                        	ADD	ESP,32
   203 000001DA 4B                              	DEC	EBX
   204 000001DB 79 90                           	JNS	L53
   205 000001DD 8B 0D [00000000]                	MOV	ECX,DWORD [_taskctl]
   206 000001E3 31 D2                           	XOR	EDX,EDX
   207 000001E5 BB 00000009                     	MOV	EBX,9
   208 000001EA                                 L58:
   209 000001EA 8D 04 11                        	LEA	EAX,DWORD [ECX+EDX*1]
   210 000001ED 81 C2 00000198                  	ADD	EDX,408
   211 000001F3 4B                              	DEC	EBX
   212 000001F4 C7 40 0C 00000000               	MOV	DWORD [12+EAX],0
   213 000001FB C7 40 10 00000000               	MOV	DWORD [16+EAX],0
   214 00000202 79 E6                           	JNS	L58
   215 00000204 E8 000000B2                     	CALL	_task_alloc
   216 00000209 89 C6                           	MOV	ESI,EAX
   217 0000020B C7 40 04 00000002               	MOV	DWORD [4+EAX],2
   218 00000212 C7 40 0C 00000002               	MOV	DWORD [12+EAX],2
   219 00000219 C7 40 08 00000000               	MOV	DWORD [8+EAX],0
   220 00000220 50                              	PUSH	EAX
   221 00000221 E8 FFFFFE48                     	CALL	_task_add
   222 00000226 E8 FFFFFEE9                     	CALL	_task_switchsub
   223 0000022B FF 36                           	PUSH	DWORD [ESI]
   224 0000022D E8 [00000000]                   	CALL	_load_tr
   225 00000232 E8 [00000000]                   	CALL	_timer_alloc
   226 00000237 FF 76 0C                        	PUSH	DWORD [12+ESI]
   227 0000023A 50                              	PUSH	EAX
   228 0000023B A3 [00000004]                   	MOV	DWORD [_task_timer],EAX
   229 00000240 E8 [00000000]                   	CALL	_timer_settime
   230 00000245 E8 00000071                     	CALL	_task_alloc
   231 0000024A 68 00010000                     	PUSH	65536
   232 0000024F FF 75 08                        	PUSH	DWORD [8+EBP]
   233 00000252 89 C3                           	MOV	EBX,EAX
   234 00000254 E8 [00000000]                   	CALL	_memman_alloc_4k
   235 00000259 05 00010000                     	ADD	EAX,65536
   236 0000025E 89 43 64                        	MOV	DWORD [100+EBX],EAX
   237 00000261 C7 43 4C [0000013B]             	MOV	DWORD [76+EBX],_task_idle
   238 00000268 C7 43 74 00000008               	MOV	DWORD [116+EBX],8
   239 0000026F C7 43 78 00000010               	MOV	DWORD [120+EBX],16
   240 00000276 C7 43 7C 00000008               	MOV	DWORD [124+EBX],8
   241 0000027D C7 83 00000080 00000008         	MOV	DWORD [128+EBX],8
   242 00000287 C7 83 00000084 00000008         	MOV	DWORD [132+EBX],8
   243 00000291 C7 83 00000088 00000008         	MOV	DWORD [136+EBX],8
   244 0000029B 6A 01                           	PUSH	1
   245 0000029D 6A 09                           	PUSH	9
   246 0000029F 53                              	PUSH	EBX
   247 000002A0 E8 000000F6                     	CALL	_task_run
   248 000002A5 A1 [00000000]                   	MOV	EAX,DWORD [_taskctl]
   249 000002AA C7 40 04 00000000               	MOV	DWORD [4+EAX],0
   250 000002B1 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   251 000002B4 89 F0                           	MOV	EAX,ESI
   252 000002B6 5B                              	POP	EBX
   253 000002B7 5E                              	POP	ESI
   254 000002B8 5F                              	POP	EDI
   255 000002B9 5D                              	POP	EBP
   256 000002BA C3                              	RET
   257 000002BB                                 	GLOBAL	_task_alloc
   258 000002BB                                 _task_alloc:
   259 000002BB 55                              	PUSH	EBP
   260 000002BC 31 C9                           	XOR	ECX,ECX
   261 000002BE 89 E5                           	MOV	EBP,ESP
   262 000002C0                                 L74:
   263 000002C0 89 C8                           	MOV	EAX,ECX
   264 000002C2 69 C0 00000138                  	IMUL	EAX,EAX,312
   265 000002C8 03 05 [00000000]                	ADD	EAX,DWORD [_taskctl]
   266 000002CE 83 B8 00001000 00               	CMP	DWORD [4096+EAX],0
   267 000002D5 74 0D                           	JE	L79
   268 000002D7 41                              	INC	ECX
   269 000002D8 81 F9 000003E7                  	CMP	ECX,999
   270 000002DE 7E E0                           	JLE	L74
   271 000002E0 31 C0                           	XOR	EAX,EAX
   272 000002E2                                 L63:
   273 000002E2 5D                              	POP	EBP
   274 000002E3 C3                              	RET
   275 000002E4                                 L79:
   276 000002E4 8D 90 00000FFC                  	LEA	EDX,DWORD [4092+EAX]
   277 000002EA B9 00000003                     	MOV	ECX,3
   278 000002EF C7 42 04 00000001               	MOV	DWORD [4+EDX],1
   279 000002F6 C7 42 50 00000202               	MOV	DWORD [80+EDX],514
   280 000002FD C7 42 54 00000000               	MOV	DWORD [84+EDX],0
   281 00000304 C7 42 58 00000000               	MOV	DWORD [88+EDX],0
   282 0000030B C7 42 5C 00000000               	MOV	DWORD [92+EDX],0
   283 00000312 C7 42 60 00000000               	MOV	DWORD [96+EDX],0
   284 00000319 C7 42 68 00000000               	MOV	DWORD [104+EDX],0
   285 00000320 C7 42 6C 00000000               	MOV	DWORD [108+EDX],0
   286 00000327 C7 42 70 00000000               	MOV	DWORD [112+EDX],0
   287 0000032E C7 42 74 00000000               	MOV	DWORD [116+EDX],0
   288 00000335 C7 82 00000080 00000000         	MOV	DWORD [128+EDX],0
   289 0000033F C7 82 00000084 00000000         	MOV	DWORD [132+EDX],0
   290 00000349 C7 82 00000088 00000000         	MOV	DWORD [136+EDX],0
   291 00000353 C7 82 00000090 40000000         	MOV	DWORD [144+EDX],1073741824
   292 0000035D C7 42 34 00000000               	MOV	DWORD [52+EDX],0
   293 00000364 C7 82 00000094 0000037F         	MOV	DWORD [148+EDX],895
   294 0000036E C7 82 00000098 00000000         	MOV	DWORD [152+EDX],0
   295 00000378 C7 82 0000009C 0000FFFF         	MOV	DWORD [156+EDX],65535
   296 00000382                                 L73:
   297 00000382 C7 84 8A 00000094 00000000      	MOV	DWORD [148+EDX+ECX*4],0
   298 0000038D 41                              	INC	ECX
   299 0000038E 89 D0                           	MOV	EAX,EDX
   300 00000390 83 F9 1A                        	CMP	ECX,26
   301 00000393 0F 8F FFFFFF49                  	JG	L63
   302 00000399 EB E7                           	JMP	L73
   303 0000039B                                 	GLOBAL	_task_run
   304 0000039B                                 _task_run:
   305 0000039B 55                              	PUSH	EBP
   306 0000039C 89 E5                           	MOV	EBP,ESP
   307 0000039E 57                              	PUSH	EDI
   308 0000039F 56                              	PUSH	ESI
   309 000003A0 53                              	PUSH	EBX
   310 000003A1 8B 7D 0C                        	MOV	EDI,DWORD [12+EBP]
   311 000003A4 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   312 000003A7 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   313 000003AA 8B 35 00000F0A                  	MOV	ESI,DWORD [3850]
   314 000003B0 85 FF                           	TEST	EDI,EDI
   315 000003B2 78 76                           	JS	L86
   316 000003B4                                 L81:
   317 000003B4 85 C0                           	TEST	EAX,EAX
   318 000003B6 7E 03                           	JLE	L82
   319 000003B8 89 43 0C                        	MOV	DWORD [12+EBX],EAX
   320 000003BB                                 L82:
   321 000003BB 83 7B 04 01                     	CMP	DWORD [4+EBX],1
   322 000003BF 74 4E                           	JE	L87
   323 000003C1                                 L83:
   324 000003C1 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   325 000003C5 74 3A                           	JE	L88
   326 000003C7                                 L84:
   327 000003C7 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   328 000003CB 74 23                           	JE	L85
   329 000003CD 8B 86 00013878                  	MOV	EAX,DWORD [79992+ESI]
   330 000003D3 8D 50 01                        	LEA	EDX,DWORD [1+EAX]
   331 000003D6 89 5C C6 04                     	MOV	DWORD [4+ESI+EAX*8],EBX
   332 000003DA 89 96 00013878                  	MOV	DWORD [79992+ESI],EDX
   333 000003E0 89 7B 08                        	MOV	DWORD [8+EBX],EDI
   334 000003E3 89 83 0000012C                  	MOV	DWORD [300+EBX],EAX
   335 000003E9 53                              	PUSH	EBX
   336 000003EA E8 FFFFFC7F                     	CALL	_task_add
   337 000003EF 59                              	POP	ECX
   338 000003F0                                 L85:
   339 000003F0 A1 [00000000]                   	MOV	EAX,DWORD [_taskctl]
   340 000003F5 C6 40 08 01                     	MOV	BYTE [8+EAX],1
   341 000003F9 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   342 000003FC 5B                              	POP	EBX
   343 000003FD 5E                              	POP	ESI
   344 000003FE 5F                              	POP	EDI
   345 000003FF 5D                              	POP	EBP
   346 00000400 C3                              	RET
   347 00000401                                 L88:
   348 00000401 39 7B 08                        	CMP	DWORD [8+EBX],EDI
   349 00000404 74 C1                           	JE	L84
   350 00000406 53                              	PUSH	EBX
   351 00000407 E8 FFFFFC8B                     	CALL	_task_remove
   352 0000040C 58                              	POP	EAX
   353 0000040D EB B8                           	JMP	L84
   354 0000040F                                 L87:
   355 0000040F 8B 86 00013878                  	MOV	EAX,DWORD [79992+ESI]
   356 00000415 8D 50 01                        	LEA	EDX,DWORD [1+EAX]
   357 00000418 89 5C C6 04                     	MOV	DWORD [4+ESI+EAX*8],EBX
   358 0000041C 89 96 00013878                  	MOV	DWORD [79992+ESI],EDX
   359 00000422 89 83 0000012C                  	MOV	DWORD [300+EBX],EAX
   360 00000428 EB 97                           	JMP	L83
   361 0000042A                                 L86:
   362 0000042A 8B 7B 08                        	MOV	EDI,DWORD [8+EBX]
   363 0000042D EB 85                           	JMP	L81
   364 0000042F                                 	GLOBAL	_task_sleep
   365 0000042F                                 _task_sleep:
   366 0000042F 55                              	PUSH	EBP
   367 00000430 89 E5                           	MOV	EBP,ESP
   368 00000432 56                              	PUSH	ESI
   369 00000433 53                              	PUSH	EBX
   370 00000434 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   371 00000437 83 7E 04 02                     	CMP	DWORD [4+ESI],2
   372 0000043B 74 07                           	JE	L92
   373 0000043D                                 L89:
   374 0000043D 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   375 00000440 5B                              	POP	EBX
   376 00000441 5E                              	POP	ESI
   377 00000442 5D                              	POP	EBP
   378 00000443 C3                              	RET
   379 00000444                                 L92:
   380 00000444 E8 FFFFFC08                     	CALL	_task_now
   381 00000449 56                              	PUSH	ESI
   382 0000044A 89 C3                           	MOV	EBX,EAX
   383 0000044C E8 FFFFFC46                     	CALL	_task_remove
   384 00000451 59                              	POP	ECX
   385 00000452 39 DE                           	CMP	ESI,EBX
   386 00000454 75 E7                           	JNE	L89
   387 00000456 E8 FFFFFCB9                     	CALL	_task_switchsub
   388 0000045B E8 FFFFFBF1                     	CALL	_task_now
   389 00000460 FF 30                           	PUSH	DWORD [EAX]
   390 00000462 6A 00                           	PUSH	0
   391 00000464 E8 [00000000]                   	CALL	_farjmp
   392 00000469 58                              	POP	EAX
   393 0000046A 5A                              	POP	EDX
   394 0000046B EB D0                           	JMP	L89
   395 0000046D                                 	GLOBAL	_task_switch
   396 0000046D                                 _task_switch:
   397 0000046D 55                              	PUSH	EBP
   398 0000046E 89 E5                           	MOV	EBP,ESP
   399 00000470 56                              	PUSH	ESI
   400 00000471 53                              	PUSH	EBX
   401 00000472 8B 1D [00000000]                	MOV	EBX,DWORD [_taskctl]
   402 00000478 8B 13                           	MOV	EDX,DWORD [EBX]
   403 0000047A 69 D2 00000198                  	IMUL	EDX,EDX,408
   404 00000480 8D 14 1A                        	LEA	EDX,DWORD [EDX+EBX*1]
   405 00000483 8D 4A 0C                        	LEA	ECX,DWORD [12+EDX]
   406 00000486 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   407 00000489 8B 74 81 08                     	MOV	ESI,DWORD [8+ECX+EAX*4]
   408 0000048D 40                              	INC	EAX
   409 0000048E 89 41 04                        	MOV	DWORD [4+ECX],EAX
   410 00000491 3B 42 0C                        	CMP	EAX,DWORD [12+EDX]
   411 00000494 74 4C                           	JE	L97
   412 00000496                                 L94:
   413 00000496 80 7B 08 00                     	CMP	BYTE [8+EBX],0
   414 0000049A 75 2D                           	JNE	L98
   415 0000049C                                 L95:
   416 0000049C 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   417 0000049F 8B 5C 81 08                     	MOV	EBX,DWORD [8+ECX+EAX*4]
   418 000004A3 FF 73 0C                        	PUSH	DWORD [12+EBX]
   419 000004A6 FF 35 [00000004]                	PUSH	DWORD [_task_timer]
   420 000004AC E8 [00000000]                   	CALL	_timer_settime
   421 000004B1 39 F3                           	CMP	EBX,ESI
   422 000004B3 58                              	POP	EAX
   423 000004B4 5A                              	POP	EDX
   424 000004B5 74 0B                           	JE	L93
   425 000004B7 FF 33                           	PUSH	DWORD [EBX]
   426 000004B9 6A 00                           	PUSH	0
   427 000004BB E8 [00000000]                   	CALL	_farjmp
   428 000004C0 5B                              	POP	EBX
   429 000004C1 5E                              	POP	ESI
   430 000004C2                                 L93:
   431 000004C2 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   432 000004C5 5B                              	POP	EBX
   433 000004C6 5E                              	POP	ESI
   434 000004C7 5D                              	POP	EBP
   435 000004C8 C3                              	RET
   436 000004C9                                 L98:
   437 000004C9 E8 FFFFFC46                     	CALL	_task_switchsub
   438 000004CE 8B 15 [00000000]                	MOV	EDX,DWORD [_taskctl]
   439 000004D4 8B 02                           	MOV	EAX,DWORD [EDX]
   440 000004D6 69 C0 00000198                  	IMUL	EAX,EAX,408
   441 000004DC 8D 4C 10 0C                     	LEA	ECX,DWORD [12+EAX+EDX*1]
   442 000004E0 EB BA                           	JMP	L95
   443 000004E2                                 L97:
   444 000004E2 C7 41 04 00000000               	MOV	DWORD [4+ECX],0
   445 000004E9 EB AB                           	JMP	L94
   446 000004EB                                 	GLOBAL	_inthandler07
   447 000004EB                                 _inthandler07:
   448 000004EB 55                              	PUSH	EBP
   449 000004EC 89 E5                           	MOV	EBP,ESP
   450 000004EE 53                              	PUSH	EBX
   451 000004EF E8 FFFFFB5D                     	CALL	_task_now
   452 000004F4 89 C3                           	MOV	EBX,EAX
   453 000004F6 E8 [00000000]                   	CALL	_io_cli
   454 000004FB E8 [00000000]                   	CALL	_clts
   455 00000500 A1 [00000000]                   	MOV	EAX,DWORD [_taskctl]
   456 00000505 8B 40 04                        	MOV	EAX,DWORD [4+EAX]
   457 00000508 39 D8                           	CMP	EAX,EBX
   458 0000050A 74 19                           	JE	L100
   459 0000050C 85 C0                           	TEST	EAX,EAX
   460 0000050E 75 21                           	JNE	L102
   461 00000510                                 L101:
   462 00000510 8D 83 00000094                  	LEA	EAX,DWORD [148+EBX]
   463 00000516 50                              	PUSH	EAX
   464 00000517 E8 [00000000]                   	CALL	_frstor
   465 0000051C A1 [00000000]                   	MOV	EAX,DWORD [_taskctl]
   466 00000521 89 58 04                        	MOV	DWORD [4+EAX],EBX
   467 00000524 59                              	POP	ECX
   468 00000525                                 L100:
   469 00000525 E8 [00000000]                   	CALL	_io_sti
   470 0000052A 8B 5D FC                        	MOV	EBX,DWORD [-4+EBP]
   471 0000052D 31 C0                           	XOR	EAX,EAX
   472 0000052F C9                              	LEAVE
   473 00000530 C3                              	RET
   474 00000531                                 L102:
   475 00000531 05 00000094                     	ADD	EAX,148
   476 00000536 50                              	PUSH	EAX
   477 00000537 E8 [00000000]                   	CALL	_fnsave
   478 0000053C 58                              	POP	EAX
   479 0000053D EB D1                           	JMP	L101
   480 0000053F                                 	GLOBAL	_task_block
   481 0000053F                                 _task_block:
   482 0000053F 55                              	PUSH	EBP
   483 00000540 89 E5                           	MOV	EBP,ESP
   484 00000542 53                              	PUSH	EBX
   485 00000543 8B 15 00000F0A                  	MOV	EDX,DWORD [3850]
   486 00000549 8B 0D 00000F0F                  	MOV	ECX,DWORD [3855]
   487 0000054F 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   488 00000552 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   489 00000556 74 03                           	JE	L105
   490 00000558                                 L103:
   491 00000558 5B                              	POP	EBX
   492 00000559 5D                              	POP	EBP
   493 0000055A C3                              	RET
   494 0000055B                                 L105:
   495 0000055B 8B 83 0000012C                  	MOV	EAX,DWORD [300+EBX]
   496 00000561 C7 43 04 00000003               	MOV	DWORD [4+EBX],3
   497 00000568 8B 54 C2 04                     	MOV	EDX,DWORD [4+EDX+EAX*8]
   498 0000056C C7 42 04 00000003               	MOV	DWORD [4+EDX],3
   499 00000573 8B 91 00001F40                  	MOV	EDX,DWORD [8000+ECX]
   500 00000579 89 04 D1                        	MOV	DWORD [ECX+EDX*8],EAX
   501 0000057C 89 5C D1 04                     	MOV	DWORD [4+ECX+EDX*8],EBX
   502 00000580 FF 81 00001F40                  	INC	DWORD [8000+ECX]
   503 00000586 EB D0                           	JMP	L103
   504 00000588                                 	GLOBAL	_task_unblock
   505 00000588                                 _task_unblock:
   506 00000588 55                              	PUSH	EBP
   507 00000589 89 E5                           	MOV	EBP,ESP
   508 0000058B 57                              	PUSH	EDI
   509 0000058C 56                              	PUSH	ESI
   510 0000058D 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   511 00000590 53                              	PUSH	EBX
   512 00000591 8B 1D 00000F0A                  	MOV	EBX,DWORD [3850]
   513 00000597 8B 35 00000F0F                  	MOV	ESI,DWORD [3855]
   514 0000059D FF 77 0C                        	PUSH	DWORD [12+EDI]
   515 000005A0 FF 77 08                        	PUSH	DWORD [8+EDI]
   516 000005A3 57                              	PUSH	EDI
   517 000005A4 E8 FFFFFDF2                     	CALL	_task_run
   518 000005A9 83 C4 0C                        	ADD	ESP,12
   519 000005AC 8B 87 0000012C                  	MOV	EAX,DWORD [300+EDI]
   520 000005B2 31 C9                           	XOR	ECX,ECX
   521 000005B4 8B 54 C3 04                     	MOV	EDX,DWORD [4+EBX+EAX*8]
   522 000005B8 8B 47 04                        	MOV	EAX,DWORD [4+EDI]
   523 000005BB 89 42 04                        	MOV	DWORD [4+EDX],EAX
   524 000005BE 8B 86 00001F40                  	MOV	EAX,DWORD [8000+ESI]
   525 000005C4 39 C1                           	CMP	ECX,EAX
   526 000005C6 7D 0B                           	JGE	L108
   527 000005C8                                 L112:
   528 000005C8 39 7C CE 04                     	CMP	DWORD [4+ESI+ECX*8],EDI
   529 000005CC 74 34                           	JE	L121
   530 000005CE 41                              	INC	ECX
   531 000005CF 39 C1                           	CMP	ECX,EAX
   532 000005D1 7C F5                           	JL	L112
   533 000005D3                                 L108:
   534 000005D3 8B 9E 00001F40                  	MOV	EBX,DWORD [8000+ESI]
   535 000005D9 39 D9                           	CMP	ECX,EBX
   536 000005DB 7D 14                           	JGE	L120
   537 000005DD                                 L117:
   538 000005DD 8B 44 CE 08                     	MOV	EAX,DWORD [8+ESI+ECX*8]
   539 000005E1 8B 54 CE 0C                     	MOV	EDX,DWORD [12+ESI+ECX*8]
   540 000005E5 89 04 CE                        	MOV	DWORD [ESI+ECX*8],EAX
   541 000005E8 89 54 CE 04                     	MOV	DWORD [4+ESI+ECX*8],EDX
   542 000005EC 41                              	INC	ECX
   543 000005ED 39 D9                           	CMP	ECX,EBX
   544 000005EF 7C EC                           	JL	L117
   545 000005F1                                 L120:
   546 000005F1 8D 43 FF                        	LEA	EAX,DWORD [-1+EBX]
   547 000005F4 89 86 00001F40                  	MOV	DWORD [8000+ESI],EAX
   548 000005FA 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   549 000005FD 5B                              	POP	EBX
   550 000005FE 5E                              	POP	ESI
   551 000005FF 5F                              	POP	EDI
   552 00000600 5D                              	POP	EBP
   553 00000601 C3                              	RET
   554 00000602                                 L121:
   555 00000602 C7 44 CE 04 00000000            	MOV	DWORD [4+ESI+ECX*8],0
   556 0000060A C7 04 CE 00000000               	MOV	DWORD [ESI+ECX*8],0
   557 00000611 EB C0                           	JMP	L108
   558 00000613                                 	GLOBAL	_message_receive
   559 00000613                                 _message_receive:
   560 00000613 55                              	PUSH	EBP
   561 00000614 89 E5                           	MOV	EBP,ESP
   562 00000616 56                              	PUSH	ESI
   563 00000617 53                              	PUSH	EBX
   564 00000618 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   565 0000061B E8 FFFFFA31                     	CALL	_task_now
   566 00000620 89 C3                           	MOV	EBX,EAX
   567 00000622 C7 80 00000130 00000001         	MOV	DWORD [304+EAX],1
   568 0000062C 50                              	PUSH	EAX
   569 0000062D E8 FFFFFF0D                     	CALL	_task_block
   570 00000632 58                              	POP	EAX
   571 00000633                                 L123:
   572 00000633 8B 83 00000134                  	MOV	EAX,DWORD [308+EBX]
   573 00000639 85 C0                           	TEST	EAX,EAX
   574 0000063B 74 F6                           	JE	L123
   575 0000063D 81 FE 00002710                  	CMP	ESI,10000
   576 00000643 74 05                           	JE	L122
   577 00000645 39 70 0C                        	CMP	DWORD [12+EAX],ESI
   578 00000648 75 E9                           	JNE	L123
   579 0000064A                                 L122:
   580 0000064A 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   581 0000064D 31 C0                           	XOR	EAX,EAX
   582 0000064F 5B                              	POP	EBX
   583 00000650 5E                              	POP	ESI
   584 00000651 5D                              	POP	EBP
   585 00000652 C3                              	RET
   586 00000653                                 	GLOBAL	_message_send
   587 00000653                                 _message_send:
   588 00000653 55                              	PUSH	EBP
   589 00000654 89 E5                           	MOV	EBP,ESP
   590 00000656 FF 75 08                        	PUSH	DWORD [8+EBP]
   591 00000659 E8 FFFFF9A2                     	CALL	_pid2task
   592 0000065E 89 C2                           	MOV	EDX,EAX
   593 00000660 58                              	POP	EAX
   594 00000661 83 C8 FF                        	OR	EAX,-1
   595 00000664 85 D2                           	TEST	EDX,EDX
   596 00000666 74 0B                           	JE	L130
   597 00000668 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   598 0000066B 89 82 00000134                  	MOV	DWORD [308+EDX],EAX
   599 00000671 31 C0                           	XOR	EAX,EAX
   600 00000673                                 L130:
   601 00000673 C9                              	LEAVE
   602 00000674 C3                              	RET
   603 00000675                                 	GLOBAL	_taskctl
   604                                          [SECTION .data]
   605 00000000                                 	ALIGNB	4
   606 00000000                                 _taskctl:
   607 00000000 00 00 00 00                     	RESB	4
   608 00000004                                 	GLOBAL	_task_timer
   609                                          [SECTION .data]
   610 00000004                                 	ALIGNB	4
   611 00000004                                 _task_timer:
   612 00000004 00 00 00 00                     	RESB	4
