     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	__alloca
     7 00000000                                 	EXTERN	_io_hlt
     8 00000000                                 	EXTERN	_memman_alloc_4k
     9 00000000                                 	EXTERN	_set_segmdesc
    10 00000000                                 	EXTERN	_load_tr
    11 00000000                                 	EXTERN	_timer_alloc
    12 00000000                                 	EXTERN	_timer_settime
    13 00000000                                 	EXTERN	_farjmp
    14 00000000                                 	EXTERN	_io_cli
    15 00000000                                 	EXTERN	_clts
    16 00000000                                 	EXTERN	_frstor
    17 00000000                                 	EXTERN	_io_sti
    18 00000000                                 	EXTERN	_fnsave
    19 00000000                                 	EXTERN	_boxfill8
    20 00000000                                 	EXTERN	_sprintf
    21 00000000                                 	EXTERN	_putfonts8_asc
    22 00000000                                 [FILE "mtask.c"]
    23                                          [SECTION .text]
    24 00000000                                 	GLOBAL	_pid2task
    25 00000000                                 _pid2task:
    26 00000000 55                              	PUSH	EBP
    27 00000001 89 E5                           	MOV	EBP,ESP
    28 00000003 8B 15 00000F0A                  	MOV	EDX,DWORD [3850]
    29 00000009 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    30 0000000C 5D                              	POP	EBP
    31 0000000D 8B 44 C2 04                     	MOV	EAX,DWORD [4+EDX+EAX*8]
    32 00000011 C3                              	RET
    33 00000012                                 	GLOBAL	_init_pid
    34 00000012                                 _init_pid:
    35 00000012 55                              	PUSH	EBP
    36 00000013 B8 000157D0                     	MOV	EAX,88016
    37 00000018 89 E5                           	MOV	EBP,ESP
    38 0000001A E8 [00000000]                   	CALL	__alloca
    39 0000001F 31 C0                           	XOR	EAX,EAX
    40 00000021 C7 45 F8 00000000               	MOV	DWORD [-8+EBP],0
    41 00000028 C7 85 FFFEC770 00000000         	MOV	DWORD [-80016+EBP],0
    42 00000032                                 L7:
    43 00000032 89 84 C5 FFFEC780               	MOV	DWORD [-80000+EBP+EAX*8],EAX
    44 00000039 40                              	INC	EAX
    45 0000003A 3D 0000270F                     	CMP	EAX,9999
    46 0000003F 7E F1                           	JLE	L7
    47 00000041 31 C0                           	XOR	EAX,EAX
    48 00000043                                 L12:
    49 00000043 89 84 C5 FFFEA830               	MOV	DWORD [-88016+EBP+EAX*8],EAX
    50 0000004A 40                              	INC	EAX
    51 0000004B 3D 000003E8                     	CMP	EAX,1000
    52 00000050 7E F1                           	JLE	L12
    53 00000052 8D 85 FFFEC780                  	LEA	EAX,DWORD [-80000+EBP]
    54 00000058 A3 00000F0A                     	MOV	DWORD [3850],EAX
    55 0000005D 8D 85 FFFEA830                  	LEA	EAX,DWORD [-88016+EBP]
    56 00000063 A3 00000F0F                     	MOV	DWORD [3855],EAX
    57 00000068 C9                              	LEAVE
    58 00000069 C3                              	RET
    59 0000006A                                 	GLOBAL	_pid_alloc
    60 0000006A                                 _pid_alloc:
    61 0000006A 55                              	PUSH	EBP
    62 0000006B 8B 0D 00000F0A                  	MOV	ECX,DWORD [3850]
    63 00000071 89 E5                           	MOV	EBP,ESP
    64 00000073 8B 81 00013878                  	MOV	EAX,DWORD [79992+ECX]
    65 00000079 8B 55 08                        	MOV	EDX,DWORD [8+EBP]
    66 0000007C 89 54 C1 04                     	MOV	DWORD [4+ECX+EAX*8],EDX
    67 00000080 8D 50 01                        	LEA	EDX,DWORD [1+EAX]
    68 00000083 89 91 00013878                  	MOV	DWORD [79992+ECX],EDX
    69 00000089 5D                              	POP	EBP
    70 0000008A 83 C4 FF                        	ADD ESP,-1
    71 0000008D C3                              	RET
    72 0000008E                                 	GLOBAL	_task_now
    73 0000008E                                 _task_now:
    74 0000008E A1 [0000000C]                   	MOV	EAX,DWORD [_taskctl]
    75 00000093 55                              	PUSH	EBP
    76 00000094 89 E5                           	MOV	EBP,ESP
    77 00000096 5D                              	POP	EBP
    78 00000097 8B 10                           	MOV	EDX,DWORD [EAX]
    79 00000099 69 D2 00000198                  	IMUL	EDX,EDX,408
    80 0000009F 8D 44 02 0C                     	LEA	EAX,DWORD [12+EDX+EAX*1]
    81 000000A3 8B 50 04                        	MOV	EDX,DWORD [4+EAX]
    82 000000A6 8B 44 90 08                     	MOV	EAX,DWORD [8+EAX+EDX*4]
    83 000000AA C3                              	RET
    84 000000AB                                 	GLOBAL	_task_add
    85 000000AB                                 _task_add:
    86 000000AB 55                              	PUSH	EBP
    87 000000AC 89 E5                           	MOV	EBP,ESP
    88 000000AE 8B 4D 08                        	MOV	ECX,DWORD [8+EBP]
    89 000000B1 8B 51 08                        	MOV	EDX,DWORD [8+ECX]
    90 000000B4 69 D2 00000198                  	IMUL	EDX,EDX,408
    91 000000BA 03 15 [0000000C]                	ADD	EDX,DWORD [_taskctl]
    92 000000C0 8B 42 0C                        	MOV	EAX,DWORD [12+EDX]
    93 000000C3 89 4C 82 14                     	MOV	DWORD [20+EDX+EAX*4],ECX
    94 000000C7 40                              	INC	EAX
    95 000000C8 89 42 0C                        	MOV	DWORD [12+EDX],EAX
    96 000000CB C7 41 04 00000002               	MOV	DWORD [4+ECX],2
    97 000000D2 5D                              	POP	EBP
    98 000000D3 C3                              	RET
    99 000000D4                                 	GLOBAL	_task_remove
   100 000000D4                                 _task_remove:
   101 000000D4 55                              	PUSH	EBP
   102 000000D5 31 C9                           	XOR	ECX,ECX
   103 000000D7 89 E5                           	MOV	EBP,ESP
   104 000000D9 57                              	PUSH	EDI
   105 000000DA 56                              	PUSH	ESI
   106 000000DB 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   107 000000DE 53                              	PUSH	EBX
   108 000000DF 8B 3D 00000F0A                  	MOV	EDI,DWORD [3850]
   109 000000E5 8B 46 08                        	MOV	EAX,DWORD [8+ESI]
   110 000000E8 69 C0 00000198                  	IMUL	EAX,EAX,408
   111 000000EE 03 05 [0000000C]                	ADD	EAX,DWORD [_taskctl]
   112 000000F4 8D 50 0C                        	LEA	EDX,DWORD [12+EAX]
   113 000000F7 3B 48 0C                        	CMP	ECX,DWORD [12+EAX]
   114 000000FA 7D 0B                           	JGE	L22
   115 000000FC                                 L26:
   116 000000FC 39 74 8A 08                     	CMP	DWORD [8+EDX+ECX*4],ESI
   117 00000100 74 05                           	JE	L22
   118 00000102 41                              	INC	ECX
   119 00000103 3B 0A                           	CMP	ECX,DWORD [EDX]
   120 00000105 7C F5                           	JL	L26
   121 00000107                                 L22:
   122 00000107 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   123 0000010A FF 0A                           	DEC	DWORD [EDX]
   124 0000010C 39 C1                           	CMP	ECX,EAX
   125 0000010E 7D 04                           	JGE	L27
   126 00000110 48                              	DEC	EAX
   127 00000111 89 42 04                        	MOV	DWORD [4+EDX],EAX
   128 00000114                                 L27:
   129 00000114 8B 02                           	MOV	EAX,DWORD [EDX]
   130 00000116 39 42 04                        	CMP	DWORD [4+EDX],EAX
   131 00000119 7C 07                           	JL	L28
   132 0000011B C7 42 04 00000000               	MOV	DWORD [4+EDX],0
   133 00000122                                 L28:
   134 00000122 C7 46 04 00000001               	MOV	DWORD [4+ESI],1
   135 00000129 8B 1A                           	MOV	EBX,DWORD [EDX]
   136 0000012B 39 D9                           	CMP	ECX,EBX
   137 0000012D 7D 0D                           	JGE	L36
   138 0000012F                                 L33:
   139 0000012F 8B 44 8A 0C                     	MOV	EAX,DWORD [12+EDX+ECX*4]
   140 00000133 89 44 8A 08                     	MOV	DWORD [8+EDX+ECX*4],EAX
   141 00000137 41                              	INC	ECX
   142 00000138 39 D9                           	CMP	ECX,EBX
   143 0000013A 7C F3                           	JL	L33
   144 0000013C                                 L36:
   145 0000013C 8B 86 0000012C                  	MOV	EAX,DWORD [300+ESI]
   146 00000142 8B 54 C7 04                     	MOV	EDX,DWORD [4+EDI+EAX*8]
   147 00000146 8B 46 04                        	MOV	EAX,DWORD [4+ESI]
   148 00000149 89 42 04                        	MOV	DWORD [4+EDX],EAX
   149 0000014C 5B                              	POP	EBX
   150 0000014D 5E                              	POP	ESI
   151 0000014E 5F                              	POP	EDI
   152 0000014F 5D                              	POP	EBP
   153 00000150 C3                              	RET
   154 00000151                                 	GLOBAL	_task_switchsub
   155 00000151                                 _task_switchsub:
   156 00000151 55                              	PUSH	EBP
   157 00000152 31 C9                           	XOR	ECX,ECX
   158 00000154 89 E5                           	MOV	EBP,ESP
   159 00000156 A1 [0000000C]                   	MOV	EAX,DWORD [_taskctl]
   160 0000015B 31 D2                           	XOR	EDX,EDX
   161 0000015D                                 L43:
   162 0000015D 83 7C 10 0C 00                  	CMP	DWORD [12+EAX+EDX*1],0
   163 00000162 7F 0C                           	JG	L39
   164 00000164 41                              	INC	ECX
   165 00000165 81 C2 00000198                  	ADD	EDX,408
   166 0000016B 83 F9 09                        	CMP	ECX,9
   167 0000016E 7E ED                           	JLE	L43
   168 00000170                                 L39:
   169 00000170 89 08                           	MOV	DWORD [EAX],ECX
   170 00000172 C6 40 08 00                     	MOV	BYTE [8+EAX],0
   171 00000176 5D                              	POP	EBP
   172 00000177 C3                              	RET
   173 00000178                                 	GLOBAL	_task_idle
   174 00000178                                 _task_idle:
   175 00000178 55                              	PUSH	EBP
   176 00000179 89 E5                           	MOV	EBP,ESP
   177 0000017B                                 L46:
   178 0000017B E8 [00000000]                   	CALL	_io_hlt
   179 00000180 EB F9                           	JMP	L46
   180 00000182                                 	GLOBAL	_task_init
   181 00000182                                 _task_init:
   182 00000182 55                              	PUSH	EBP
   183 00000183 89 E5                           	MOV	EBP,ESP
   184 00000185 57                              	PUSH	EDI
   185 00000186 56                              	PUSH	ESI
   186 00000187 31 FF                           	XOR	EDI,EDI
   187 00000189 53                              	PUSH	EBX
   188 0000018A 31 F6                           	XOR	ESI,ESI
   189 0000018C FF 75 08                        	PUSH	DWORD [8+EBP]
   190 0000018F BB 000003E7                     	MOV	EBX,999
   191 00000194 E8 FFFFFE79                     	CALL	_init_pid
   192 00000199 68 0004E25C                     	PUSH	320092
   193 0000019E FF 75 08                        	PUSH	DWORD [8+EBP]
   194 000001A1 E8 [00000000]                   	CALL	_memman_alloc_4k
   195 000001A6 83 C4 0C                        	ADD	ESP,12
   196 000001A9 A3 [0000000C]                   	MOV	DWORD [_taskctl],EAX
   197 000001AE                                 L54:
   198 000001AE 89 FA                           	MOV	EDX,EDI
   199 000001B0 8D 46 18                        	LEA	EAX,DWORD [24+ESI]
   200 000001B3 03 15 [0000000C]                	ADD	EDX,DWORD [_taskctl]
   201 000001B9 89 82 00000FFC                  	MOV	DWORD [4092+EDX],EAX
   202 000001BF 8D 86 00001F58                  	LEA	EAX,DWORD [8024+ESI]
   203 000001C5 89 82 00001088                  	MOV	DWORD [4232+EDX],EAX
   204 000001CB 8D 86 00270018                  	LEA	EAX,DWORD [2555928+ESI]
   205 000001D1 C7 82 00001000 00000000         	MOV	DWORD [4096+EDX],0
   206 000001DB 68 00000089                     	PUSH	137
   207 000001E0 81 C2 00001028                  	ADD	EDX,4136
   208 000001E6 52                              	PUSH	EDX
   209 000001E7 6A 67                           	PUSH	103
   210 000001E9 50                              	PUSH	EAX
   211 000001EA E8 [00000000]                   	CALL	_set_segmdesc
   212 000001EF A1 [0000000C]                   	MOV	EAX,DWORD [_taskctl]
   213 000001F4 01 F8                           	ADD	EAX,EDI
   214 000001F6 68 00000082                     	PUSH	130
   215 000001FB 05 000010FC                     	ADD	EAX,4348
   216 00000200 81 C7 0000013C                  	ADD	EDI,316
   217 00000206 50                              	PUSH	EAX
   218 00000207 8D 86 00271F58                  	LEA	EAX,DWORD [2563928+ESI]
   219 0000020D 6A 0F                           	PUSH	15
   220 0000020F 83 C6 08                        	ADD	ESI,8
   221 00000212 50                              	PUSH	EAX
   222 00000213 E8 [00000000]                   	CALL	_set_segmdesc
   223 00000218 83 C4 20                        	ADD	ESP,32
   224 0000021B 4B                              	DEC	EBX
   225 0000021C 79 90                           	JNS	L54
   226 0000021E 8B 0D [0000000C]                	MOV	ECX,DWORD [_taskctl]
   227 00000224 31 D2                           	XOR	EDX,EDX
   228 00000226 BB 00000009                     	MOV	EBX,9
   229 0000022B                                 L59:
   230 0000022B 8D 04 11                        	LEA	EAX,DWORD [ECX+EDX*1]
   231 0000022E 81 C2 00000198                  	ADD	EDX,408
   232 00000234 4B                              	DEC	EBX
   233 00000235 C7 40 0C 00000000               	MOV	DWORD [12+EAX],0
   234 0000023C C7 40 10 00000000               	MOV	DWORD [16+EAX],0
   235 00000243 79 E6                           	JNS	L59
   236 00000245 E8 000000B2                     	CALL	_task_alloc
   237 0000024A 89 C6                           	MOV	ESI,EAX
   238 0000024C C7 40 04 00000002               	MOV	DWORD [4+EAX],2
   239 00000253 C7 40 0C 00000002               	MOV	DWORD [12+EAX],2
   240 0000025A C7 40 08 00000000               	MOV	DWORD [8+EAX],0
   241 00000261 50                              	PUSH	EAX
   242 00000262 E8 FFFFFE44                     	CALL	_task_add
   243 00000267 E8 FFFFFEE5                     	CALL	_task_switchsub
   244 0000026C FF 36                           	PUSH	DWORD [ESI]
   245 0000026E E8 [00000000]                   	CALL	_load_tr
   246 00000273 E8 [00000000]                   	CALL	_timer_alloc
   247 00000278 FF 76 0C                        	PUSH	DWORD [12+ESI]
   248 0000027B 50                              	PUSH	EAX
   249 0000027C A3 [00000010]                   	MOV	DWORD [_task_timer],EAX
   250 00000281 E8 [00000000]                   	CALL	_timer_settime
   251 00000286 E8 00000071                     	CALL	_task_alloc
   252 0000028B 68 00010000                     	PUSH	65536
   253 00000290 FF 75 08                        	PUSH	DWORD [8+EBP]
   254 00000293 89 C3                           	MOV	EBX,EAX
   255 00000295 E8 [00000000]                   	CALL	_memman_alloc_4k
   256 0000029A 05 00010000                     	ADD	EAX,65536
   257 0000029F 89 43 64                        	MOV	DWORD [100+EBX],EAX
   258 000002A2 C7 43 4C [00000178]             	MOV	DWORD [76+EBX],_task_idle
   259 000002A9 C7 43 74 00000008               	MOV	DWORD [116+EBX],8
   260 000002B0 C7 43 78 00000010               	MOV	DWORD [120+EBX],16
   261 000002B7 C7 43 7C 00000008               	MOV	DWORD [124+EBX],8
   262 000002BE C7 83 00000080 00000008         	MOV	DWORD [128+EBX],8
   263 000002C8 C7 83 00000084 00000008         	MOV	DWORD [132+EBX],8
   264 000002D2 C7 83 00000088 00000008         	MOV	DWORD [136+EBX],8
   265 000002DC 6A 01                           	PUSH	1
   266 000002DE 6A 09                           	PUSH	9
   267 000002E0 53                              	PUSH	EBX
   268 000002E1 E8 0000010F                     	CALL	_task_run
   269 000002E6 A1 [0000000C]                   	MOV	EAX,DWORD [_taskctl]
   270 000002EB C7 40 04 00000000               	MOV	DWORD [4+EAX],0
   271 000002F2 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   272 000002F5 89 F0                           	MOV	EAX,ESI
   273 000002F7 5B                              	POP	EBX
   274 000002F8 5E                              	POP	ESI
   275 000002F9 5F                              	POP	EDI
   276 000002FA 5D                              	POP	EBP
   277 000002FB C3                              	RET
   278 000002FC                                 	GLOBAL	_task_alloc
   279 000002FC                                 _task_alloc:
   280 000002FC 55                              	PUSH	EBP
   281 000002FD 31 D2                           	XOR	EDX,EDX
   282 000002FF 89 E5                           	MOV	EBP,ESP
   283 00000301 53                              	PUSH	EBX
   284 00000302                                 L75:
   285 00000302 89 D0                           	MOV	EAX,EDX
   286 00000304 69 C0 0000013C                  	IMUL	EAX,EAX,316
   287 0000030A 03 05 [0000000C]                	ADD	EAX,DWORD [_taskctl]
   288 00000310 83 B8 00001000 00               	CMP	DWORD [4096+EAX],0
   289 00000317 74 10                           	JE	L80
   290 00000319 42                              	INC	EDX
   291 0000031A 81 FA 000003E7                  	CMP	EDX,999
   292 00000320 7E E0                           	JLE	L75
   293 00000322 31 C0                           	XOR	EAX,EAX
   294 00000324                                 L64:
   295 00000324 8B 5D FC                        	MOV	EBX,DWORD [-4+EBP]
   296 00000327 C9                              	LEAVE
   297 00000328 C3                              	RET
   298 00000329                                 L80:
   299 00000329 8D 98 00000FFC                  	LEA	EBX,DWORD [4092+EAX]
   300 0000032F BA 00000003                     	MOV	EDX,3
   301 00000334 C7 43 04 00000001               	MOV	DWORD [4+EBX],1
   302 0000033B C7 43 50 00000202               	MOV	DWORD [80+EBX],514
   303 00000342 C7 43 54 00000000               	MOV	DWORD [84+EBX],0
   304 00000349 C7 43 58 00000000               	MOV	DWORD [88+EBX],0
   305 00000350 C7 43 5C 00000000               	MOV	DWORD [92+EBX],0
   306 00000357 C7 43 60 00000000               	MOV	DWORD [96+EBX],0
   307 0000035E C7 43 68 00000000               	MOV	DWORD [104+EBX],0
   308 00000365 C7 43 6C 00000000               	MOV	DWORD [108+EBX],0
   309 0000036C C7 43 70 00000000               	MOV	DWORD [112+EBX],0
   310 00000373 C7 43 74 00000000               	MOV	DWORD [116+EBX],0
   311 0000037A C7 83 00000080 00000000         	MOV	DWORD [128+EBX],0
   312 00000384 C7 83 00000084 00000000         	MOV	DWORD [132+EBX],0
   313 0000038E C7 83 00000088 00000000         	MOV	DWORD [136+EBX],0
   314 00000398 C7 83 00000090 40000000         	MOV	DWORD [144+EBX],1073741824
   315 000003A2 C7 43 34 00000000               	MOV	DWORD [52+EBX],0
   316 000003A9 C7 83 00000094 0000037F         	MOV	DWORD [148+EBX],895
   317 000003B3 C7 83 00000098 00000000         	MOV	DWORD [152+EBX],0
   318 000003BD C7 83 0000009C 0000FFFF         	MOV	DWORD [156+EBX],65535
   319 000003C7                                 L74:
   320 000003C7 C7 84 93 00000094 00000000      	MOV	DWORD [148+EBX+EDX*4],0
   321 000003D2 42                              	INC	EDX
   322 000003D3 83 FA 1A                        	CMP	EDX,26
   323 000003D6 7E EF                           	JLE	L74
   324 000003D8 53                              	PUSH	EBX
   325 000003D9 E8 FFFFFC8C                     	CALL	_pid_alloc
   326 000003DE C7 83 00000134 00000000         	MOV	DWORD [308+EBX],0
   327 000003E8 89 83 0000012C                  	MOV	DWORD [300+EBX],EAX
   328 000003EE 89 D8                           	MOV	EAX,EBX
   329 000003F0 E9 FFFFFF2F                     	JMP	L64
   330 000003F5                                 	GLOBAL	_task_run
   331 000003F5                                 _task_run:
   332 000003F5 55                              	PUSH	EBP
   333 000003F6 89 E5                           	MOV	EBP,ESP
   334 000003F8 56                              	PUSH	ESI
   335 000003F9 53                              	PUSH	EBX
   336 000003FA 8B 75 0C                        	MOV	ESI,DWORD [12+EBP]
   337 000003FD 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   338 00000400 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   339 00000403 85 F6                           	TEST	ESI,ESI
   340 00000405 78 3B                           	JS	L86
   341 00000407                                 L82:
   342 00000407 85 C0                           	TEST	EAX,EAX
   343 00000409 7E 03                           	JLE	L83
   344 0000040B 89 43 0C                        	MOV	DWORD [12+EBX],EAX
   345 0000040E                                 L83:
   346 0000040E 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   347 00000412 74 20                           	JE	L87
   348 00000414                                 L84:
   349 00000414 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   350 00000418 74 0A                           	JE	L85
   351 0000041A 89 73 08                        	MOV	DWORD [8+EBX],ESI
   352 0000041D 53                              	PUSH	EBX
   353 0000041E E8 FFFFFC88                     	CALL	_task_add
   354 00000423 58                              	POP	EAX
   355 00000424                                 L85:
   356 00000424 A1 [0000000C]                   	MOV	EAX,DWORD [_taskctl]
   357 00000429 C6 40 08 01                     	MOV	BYTE [8+EAX],1
   358 0000042D 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   359 00000430 5B                              	POP	EBX
   360 00000431 5E                              	POP	ESI
   361 00000432 5D                              	POP	EBP
   362 00000433 C3                              	RET
   363 00000434                                 L87:
   364 00000434 39 73 08                        	CMP	DWORD [8+EBX],ESI
   365 00000437 74 DB                           	JE	L84
   366 00000439 53                              	PUSH	EBX
   367 0000043A E8 FFFFFC95                     	CALL	_task_remove
   368 0000043F 5A                              	POP	EDX
   369 00000440 EB D2                           	JMP	L84
   370 00000442                                 L86:
   371 00000442 8B 73 08                        	MOV	ESI,DWORD [8+EBX]
   372 00000445 EB C0                           	JMP	L82
   373 00000447                                 	GLOBAL	_task_sleep
   374 00000447                                 _task_sleep:
   375 00000447 55                              	PUSH	EBP
   376 00000448 89 E5                           	MOV	EBP,ESP
   377 0000044A 56                              	PUSH	ESI
   378 0000044B 53                              	PUSH	EBX
   379 0000044C 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   380 0000044F 83 7E 04 02                     	CMP	DWORD [4+ESI],2
   381 00000453 74 07                           	JE	L91
   382 00000455                                 L88:
   383 00000455 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   384 00000458 5B                              	POP	EBX
   385 00000459 5E                              	POP	ESI
   386 0000045A 5D                              	POP	EBP
   387 0000045B C3                              	RET
   388 0000045C                                 L91:
   389 0000045C E8 FFFFFC2D                     	CALL	_task_now
   390 00000461 56                              	PUSH	ESI
   391 00000462 89 C3                           	MOV	EBX,EAX
   392 00000464 E8 FFFFFC6B                     	CALL	_task_remove
   393 00000469 58                              	POP	EAX
   394 0000046A 39 DE                           	CMP	ESI,EBX
   395 0000046C 75 E7                           	JNE	L88
   396 0000046E E8 FFFFFCDE                     	CALL	_task_switchsub
   397 00000473 E8 FFFFFC16                     	CALL	_task_now
   398 00000478 FF 30                           	PUSH	DWORD [EAX]
   399 0000047A 6A 00                           	PUSH	0
   400 0000047C E8 [00000000]                   	CALL	_farjmp
   401 00000481 59                              	POP	ECX
   402 00000482 5B                              	POP	EBX
   403 00000483 EB D0                           	JMP	L88
   404 00000485                                 	GLOBAL	_task_switch
   405 00000485                                 _task_switch:
   406 00000485 55                              	PUSH	EBP
   407 00000486 89 E5                           	MOV	EBP,ESP
   408 00000488 56                              	PUSH	ESI
   409 00000489 53                              	PUSH	EBX
   410 0000048A 8B 1D [0000000C]                	MOV	EBX,DWORD [_taskctl]
   411 00000490 8B 13                           	MOV	EDX,DWORD [EBX]
   412 00000492 69 D2 00000198                  	IMUL	EDX,EDX,408
   413 00000498 8D 14 1A                        	LEA	EDX,DWORD [EDX+EBX*1]
   414 0000049B 8D 4A 0C                        	LEA	ECX,DWORD [12+EDX]
   415 0000049E 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   416 000004A1 8B 74 81 08                     	MOV	ESI,DWORD [8+ECX+EAX*4]
   417 000004A5 40                              	INC	EAX
   418 000004A6 89 41 04                        	MOV	DWORD [4+ECX],EAX
   419 000004A9 3B 42 0C                        	CMP	EAX,DWORD [12+EDX]
   420 000004AC 74 4C                           	JE	L96
   421 000004AE                                 L93:
   422 000004AE 80 7B 08 00                     	CMP	BYTE [8+EBX],0
   423 000004B2 75 2D                           	JNE	L97
   424 000004B4                                 L94:
   425 000004B4 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   426 000004B7 8B 5C 81 08                     	MOV	EBX,DWORD [8+ECX+EAX*4]
   427 000004BB FF 73 0C                        	PUSH	DWORD [12+EBX]
   428 000004BE FF 35 [00000010]                	PUSH	DWORD [_task_timer]
   429 000004C4 E8 [00000000]                   	CALL	_timer_settime
   430 000004C9 39 F3                           	CMP	EBX,ESI
   431 000004CB 59                              	POP	ECX
   432 000004CC 58                              	POP	EAX
   433 000004CD 74 0B                           	JE	L92
   434 000004CF FF 33                           	PUSH	DWORD [EBX]
   435 000004D1 6A 00                           	PUSH	0
   436 000004D3 E8 [00000000]                   	CALL	_farjmp
   437 000004D8 58                              	POP	EAX
   438 000004D9 5A                              	POP	EDX
   439 000004DA                                 L92:
   440 000004DA 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   441 000004DD 5B                              	POP	EBX
   442 000004DE 5E                              	POP	ESI
   443 000004DF 5D                              	POP	EBP
   444 000004E0 C3                              	RET
   445 000004E1                                 L97:
   446 000004E1 E8 FFFFFC6B                     	CALL	_task_switchsub
   447 000004E6 8B 15 [0000000C]                	MOV	EDX,DWORD [_taskctl]
   448 000004EC 8B 02                           	MOV	EAX,DWORD [EDX]
   449 000004EE 69 C0 00000198                  	IMUL	EAX,EAX,408
   450 000004F4 8D 4C 10 0C                     	LEA	ECX,DWORD [12+EAX+EDX*1]
   451 000004F8 EB BA                           	JMP	L94
   452 000004FA                                 L96:
   453 000004FA C7 41 04 00000000               	MOV	DWORD [4+ECX],0
   454 00000501 EB AB                           	JMP	L93
   455 00000503                                 	GLOBAL	_inthandler07
   456 00000503                                 _inthandler07:
   457 00000503 55                              	PUSH	EBP
   458 00000504 89 E5                           	MOV	EBP,ESP
   459 00000506 53                              	PUSH	EBX
   460 00000507 E8 FFFFFB82                     	CALL	_task_now
   461 0000050C 89 C3                           	MOV	EBX,EAX
   462 0000050E E8 [00000000]                   	CALL	_io_cli
   463 00000513 E8 [00000000]                   	CALL	_clts
   464 00000518 A1 [0000000C]                   	MOV	EAX,DWORD [_taskctl]
   465 0000051D 8B 40 04                        	MOV	EAX,DWORD [4+EAX]
   466 00000520 39 D8                           	CMP	EAX,EBX
   467 00000522 74 19                           	JE	L99
   468 00000524 85 C0                           	TEST	EAX,EAX
   469 00000526 75 21                           	JNE	L101
   470 00000528                                 L100:
   471 00000528 8D 83 00000094                  	LEA	EAX,DWORD [148+EBX]
   472 0000052E 50                              	PUSH	EAX
   473 0000052F E8 [00000000]                   	CALL	_frstor
   474 00000534 A1 [0000000C]                   	MOV	EAX,DWORD [_taskctl]
   475 00000539 89 58 04                        	MOV	DWORD [4+EAX],EBX
   476 0000053C 58                              	POP	EAX
   477 0000053D                                 L99:
   478 0000053D E8 [00000000]                   	CALL	_io_sti
   479 00000542 8B 5D FC                        	MOV	EBX,DWORD [-4+EBP]
   480 00000545 31 C0                           	XOR	EAX,EAX
   481 00000547 C9                              	LEAVE
   482 00000548 C3                              	RET
   483 00000549                                 L101:
   484 00000549 05 00000094                     	ADD	EAX,148
   485 0000054E 50                              	PUSH	EAX
   486 0000054F E8 [00000000]                   	CALL	_fnsave
   487 00000554 58                              	POP	EAX
   488 00000555 EB D1                           	JMP	L100
   489 00000557                                 	GLOBAL	_task_block
   490 00000557                                 _task_block:
   491 00000557 55                              	PUSH	EBP
   492 00000558 89 E5                           	MOV	EBP,ESP
   493 0000055A 57                              	PUSH	EDI
   494 0000055B 56                              	PUSH	ESI
   495 0000055C 53                              	PUSH	EBX
   496 0000055D 53                              	PUSH	EBX
   497 0000055E 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   498 00000561 A1 00000F0A                     	MOV	EAX,DWORD [3850]
   499 00000566 89 45 F0                        	MOV	DWORD [-16+EBP],EAX
   500 00000569 8B 1D 00000F0F                  	MOV	EBX,DWORD [3855]
   501 0000056F 83 7F 04 02                     	CMP	DWORD [4+EDI],2
   502 00000573 74 08                           	JE	L105
   503 00000575                                 L102:
   504 00000575 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   505 00000578 5B                              	POP	EBX
   506 00000579 5E                              	POP	ESI
   507 0000057A 5F                              	POP	EDI
   508 0000057B 5D                              	POP	EBP
   509 0000057C C3                              	RET
   510 0000057D                                 L105:
   511 0000057D E8 FFFFFB0C                     	CALL	_task_now
   512 00000582 57                              	PUSH	EDI
   513 00000583 89 C6                           	MOV	ESI,EAX
   514 00000585 E8 FFFFFB4A                     	CALL	_task_remove
   515 0000058A 8B 87 0000012C                  	MOV	EAX,DWORD [300+EDI]
   516 00000590 8B 4D F0                        	MOV	ECX,DWORD [-16+EBP]
   517 00000593 C7 47 04 00000003               	MOV	DWORD [4+EDI],3
   518 0000059A 8B 54 C1 04                     	MOV	EDX,DWORD [4+ECX+EAX*8]
   519 0000059E C7 42 04 00000003               	MOV	DWORD [4+EDX],3
   520 000005A5 8B 93 00001F40                  	MOV	EDX,DWORD [8000+EBX]
   521 000005AB 89 04 D3                        	MOV	DWORD [EBX+EDX*8],EAX
   522 000005AE 89 7C D3 04                     	MOV	DWORD [4+EBX+EDX*8],EDI
   523 000005B2 FF 83 00001F40                  	INC	DWORD [8000+EBX]
   524 000005B8 39 F7                           	CMP	EDI,ESI
   525 000005BA 59                              	POP	ECX
   526 000005BB 75 B8                           	JNE	L102
   527 000005BD E8 FFFFFB8F                     	CALL	_task_switchsub
   528 000005C2 E8 FFFFFAC7                     	CALL	_task_now
   529 000005C7 FF 30                           	PUSH	DWORD [EAX]
   530 000005C9 6A 00                           	PUSH	0
   531 000005CB E8 [00000000]                   	CALL	_farjmp
   532 000005D0 58                              	POP	EAX
   533 000005D1 5A                              	POP	EDX
   534 000005D2 EB A1                           	JMP	L102
   535 000005D4                                 	GLOBAL	_task_unblock
   536 000005D4                                 _task_unblock:
   537 000005D4 55                              	PUSH	EBP
   538 000005D5 89 E5                           	MOV	EBP,ESP
   539 000005D7 57                              	PUSH	EDI
   540 000005D8 56                              	PUSH	ESI
   541 000005D9 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   542 000005DC 53                              	PUSH	EBX
   543 000005DD 8B 1D 00000F0A                  	MOV	EBX,DWORD [3850]
   544 000005E3 8B 35 00000F0F                  	MOV	ESI,DWORD [3855]
   545 000005E9 FF 77 0C                        	PUSH	DWORD [12+EDI]
   546 000005EC FF 77 08                        	PUSH	DWORD [8+EDI]
   547 000005EF 57                              	PUSH	EDI
   548 000005F0 E8 FFFFFE00                     	CALL	_task_run
   549 000005F5 83 C4 0C                        	ADD	ESP,12
   550 000005F8 8B 87 0000012C                  	MOV	EAX,DWORD [300+EDI]
   551 000005FE 31 C9                           	XOR	ECX,ECX
   552 00000600 8B 54 C3 04                     	MOV	EDX,DWORD [4+EBX+EAX*8]
   553 00000604 8B 47 04                        	MOV	EAX,DWORD [4+EDI]
   554 00000607 89 42 04                        	MOV	DWORD [4+EDX],EAX
   555 0000060A 8B 86 00001F40                  	MOV	EAX,DWORD [8000+ESI]
   556 00000610 39 C1                           	CMP	ECX,EAX
   557 00000612 7D 0B                           	JGE	L108
   558 00000614                                 L112:
   559 00000614 39 7C CE 04                     	CMP	DWORD [4+ESI+ECX*8],EDI
   560 00000618 74 34                           	JE	L121
   561 0000061A 41                              	INC	ECX
   562 0000061B 39 C1                           	CMP	ECX,EAX
   563 0000061D 7C F5                           	JL	L112
   564 0000061F                                 L108:
   565 0000061F 8B 9E 00001F40                  	MOV	EBX,DWORD [8000+ESI]
   566 00000625 39 D9                           	CMP	ECX,EBX
   567 00000627 7D 14                           	JGE	L120
   568 00000629                                 L117:
   569 00000629 8B 44 CE 08                     	MOV	EAX,DWORD [8+ESI+ECX*8]
   570 0000062D 8B 54 CE 0C                     	MOV	EDX,DWORD [12+ESI+ECX*8]
   571 00000631 89 04 CE                        	MOV	DWORD [ESI+ECX*8],EAX
   572 00000634 89 54 CE 04                     	MOV	DWORD [4+ESI+ECX*8],EDX
   573 00000638 41                              	INC	ECX
   574 00000639 39 D9                           	CMP	ECX,EBX
   575 0000063B 7C EC                           	JL	L117
   576 0000063D                                 L120:
   577 0000063D 8D 43 FF                        	LEA	EAX,DWORD [-1+EBX]
   578 00000640 89 86 00001F40                  	MOV	DWORD [8000+ESI],EAX
   579 00000646 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   580 00000649 5B                              	POP	EBX
   581 0000064A 5E                              	POP	ESI
   582 0000064B 5F                              	POP	EDI
   583 0000064C 5D                              	POP	EBP
   584 0000064D C3                              	RET
   585 0000064E                                 L121:
   586 0000064E C7 44 CE 04 00000000            	MOV	DWORD [4+ESI+ECX*8],0
   587 00000656 C7 04 CE 00000000               	MOV	DWORD [ESI+ECX*8],0
   588 0000065D EB C0                           	JMP	L108
   589 0000065F                                 	GLOBAL	_message_receive
   590 0000065F                                 _message_receive:
   591 0000065F 55                              	PUSH	EBP
   592 00000660 89 E5                           	MOV	EBP,ESP
   593 00000662 57                              	PUSH	EDI
   594 00000663 56                              	PUSH	ESI
   595 00000664 53                              	PUSH	EBX
   596 00000665 83 EC 20                        	SUB	ESP,32
   597 00000668 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   598 0000066B 8B 75 0C                        	MOV	ESI,DWORD [12+EBP]
   599 0000066E E8 FFFFFA1B                     	CALL	_task_now
   600 00000673 89 C3                           	MOV	EBX,EAX
   601 00000675 C7 80 00000130 00000001         	MOV	DWORD [304+EAX],1
   602 0000067F                                 L123:
   603 0000067F 8B 93 00000134                  	MOV	EDX,DWORD [308+EBX]
   604 00000685 85 D2                           	TEST	EDX,EDX
   605 00000687 75 09                           	JNE	L131
   606 00000689                                 L130:
   607 00000689 53                              	PUSH	EBX
   608 0000068A E8 FFFFFEC8                     	CALL	_task_block
   609 0000068F 58                              	POP	EAX
   610 00000690 EB ED                           	JMP	L123
   611 00000692                                 L131:
   612 00000692 81 FF 00002710                  	CMP	EDI,10000
   613 00000698 74 19                           	JE	L132
   614 0000069A 39 7A 0C                        	CMP	DWORD [12+EDX],EDI
   615 0000069D 75 EA                           	JNE	L130
   616 0000069F C7 83 00000130 00000000         	MOV	DWORD [304+EBX],0
   617 000006A9                                 L122:
   618 000006A9 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   619 000006AC 31 C0                           	XOR	EAX,EAX
   620 000006AE 5B                              	POP	EBX
   621 000006AF 5E                              	POP	ESI
   622 000006B0 5F                              	POP	EDI
   623 000006B1 5D                              	POP	EBP
   624 000006B2 C3                              	RET
   625 000006B3                                 L132:
   626 000006B3 C7 83 00000130 00000000         	MOV	DWORD [304+EBX],0
   627 000006BD 8B 02                           	MOV	EAX,DWORD [EDX]
   628 000006BF 89 06                           	MOV	DWORD [ESI],EAX
   629 000006C1 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   630 000006C4 89 46 04                        	MOV	DWORD [4+ESI],EAX
   631 000006C7 8B 42 08                        	MOV	EAX,DWORD [8+EDX]
   632 000006CA 89 46 08                        	MOV	DWORD [8+ESI],EAX
   633 000006CD 8B 42 0C                        	MOV	EAX,DWORD [12+EDX]
   634 000006D0 89 46 0C                        	MOV	DWORD [12+ESI],EAX
   635 000006D3 C7 83 00000134 00000000         	MOV	DWORD [308+EBX],0
   636 000006DD EB CA                           	JMP	L122
   637                                          [SECTION .data]
   638 00000000                                 LC0:
   639 00000000 74 61 73 6B 72 75 6E 20 25 64   	DB	"taskrun %d",0x00
       0000000A 00 
   640                                          [SECTION .text]
   641 000006DF                                 	GLOBAL	_message_send
   642 000006DF                                 _message_send:
   643 000006DF 55                              	PUSH	EBP
   644 000006E0 89 E5                           	MOV	EBP,ESP
   645 000006E2 57                              	PUSH	EDI
   646 000006E3 56                              	PUSH	ESI
   647 000006E4 53                              	PUSH	EBX
   648 000006E5 83 EC 20                        	SUB	ESP,32
   649 000006E8 FF 75 08                        	PUSH	DWORD [8+EBP]
   650 000006EB 8B 7D 0C                        	MOV	EDI,DWORD [12+EBP]
   651 000006EE E8 FFFFF90D                     	CALL	_pid2task
   652 000006F3 89 C6                           	MOV	ESI,EAX
   653 000006F5 58                              	POP	EAX
   654 000006F6 83 C8 FF                        	OR	EAX,-1
   655 000006F9 85 F6                           	TEST	ESI,ESI
   656 000006FB 0F 84 0000008F                  	JE	L133
   657 00000701 8D 5D D4                        	LEA	EBX,DWORD [-44+EBP]
   658 00000704 E8 [00000000]                   	CALL	_io_cli
   659 00000709 6A 0F                           	PUSH	15
   660 0000070B 68 000000FF                     	PUSH	255
   661 00000710 6A 00                           	PUSH	0
   662 00000712 6A 00                           	PUSH	0
   663 00000714 6A 00                           	PUSH	0
   664 00000716 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   665 0000071D 50                              	PUSH	EAX
   666 0000071E FF 35 00000FF8                  	PUSH	DWORD [4088]
   667 00000724 E8 [00000000]                   	CALL	_boxfill8
   668 00000729 FF 37                           	PUSH	DWORD [EDI]
   669 0000072B 68 [00000000]                   	PUSH	LC0
   670 00000730 53                              	PUSH	EBX
   671 00000731 E8 [00000000]                   	CALL	_sprintf
   672 00000736 83 C4 28                        	ADD	ESP,40
   673 00000739 53                              	PUSH	EBX
   674 0000073A 6A 07                           	PUSH	7
   675 0000073C 6A 00                           	PUSH	0
   676 0000073E 6A 00                           	PUSH	0
   677 00000740 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   678 00000747 50                              	PUSH	EAX
   679 00000748 FF 35 00000FF8                  	PUSH	DWORD [4088]
   680 0000074E E8 [00000000]                   	CALL	_putfonts8_asc
   681 00000753 E8 FFFFF936                     	CALL	_task_now
   682 00000758 83 C4 18                        	ADD	ESP,24
   683 0000075B 8B 96 00000134                  	MOV	EDX,DWORD [308+ESI]
   684 00000761 8B 80 0000012C                  	MOV	EAX,DWORD [300+EAX]
   685 00000767 89 47 0C                        	MOV	DWORD [12+EDI],EAX
   686 0000076A 8B 07                           	MOV	EAX,DWORD [EDI]
   687 0000076C 89 02                           	MOV	DWORD [EDX],EAX
   688 0000076E 8B 47 04                        	MOV	EAX,DWORD [4+EDI]
   689 00000771 89 42 04                        	MOV	DWORD [4+EDX],EAX
   690 00000774 8B 47 08                        	MOV	EAX,DWORD [8+EDI]
   691 00000777 89 42 08                        	MOV	DWORD [8+EDX],EAX
   692 0000077A 8B 47 0C                        	MOV	EAX,DWORD [12+EDI]
   693 0000077D 89 42 0C                        	MOV	DWORD [12+EDX],EAX
   694 00000780 83 BE 00000130 00               	CMP	DWORD [304+ESI],0
   695 00000787 75 0F                           	JNE	L136
   696 00000789                                 L135:
   697 00000789 E8 [00000000]                   	CALL	_io_sti
   698 0000078E 31 C0                           	XOR	EAX,EAX
   699 00000790                                 L133:
   700 00000790 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   701 00000793 5B                              	POP	EBX
   702 00000794 5E                              	POP	ESI
   703 00000795 5F                              	POP	EDI
   704 00000796 5D                              	POP	EBP
   705 00000797 C3                              	RET
   706 00000798                                 L136:
   707 00000798 56                              	PUSH	ESI
   708 00000799 E8 FFFFFE36                     	CALL	_task_unblock
   709 0000079E 58                              	POP	EAX
   710 0000079F EB E8                           	JMP	L135
   711 000007A1                                 	GLOBAL	_taskctl
   712                                          [SECTION .data]
   713 0000000B 00                              	ALIGNB	4
   714 0000000C                                 _taskctl:
   715 0000000C 00 00 00 00                     	RESB	4
   716 00000010                                 	GLOBAL	_task_timer
   717                                          [SECTION .data]
   718 00000010                                 	ALIGNB	4
   719 00000010                                 _task_timer:
   720 00000010 00 00 00 00                     	RESB	4
