     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_hlt
     7 00000000                                 	EXTERN	_memman_alloc_4k
     8 00000000                                 	EXTERN	_set_segmdesc
     9 00000000                                 	EXTERN	_load_tr
    10 00000000                                 	EXTERN	_timer_alloc
    11 00000000                                 	EXTERN	_timer_settime
    12 00000000                                 	EXTERN	_farjmp
    13 00000000                                 	EXTERN	_io_cli
    14 00000000                                 	EXTERN	_clts
    15 00000000                                 	EXTERN	_frstor
    16 00000000                                 	EXTERN	_io_sti
    17 00000000                                 	EXTERN	_fnsave
    18 00000000                                 	EXTERN	_boxfill8
    19 00000000                                 	EXTERN	_putfonts8_asc
    20 00000000                                 [FILE "mtask.c"]
    21                                          [SECTION .text]
    22 00000000                                 	GLOBAL	_pid2task
    23 00000000                                 _pid2task:
    24 00000000 55                              	PUSH	EBP
    25 00000001 89 E5                           	MOV	EBP,ESP
    26 00000003 8B 15 00000F0A                  	MOV	EDX,DWORD [3850]
    27 00000009 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    28 0000000C 5D                              	POP	EBP
    29 0000000D 8B 44 C2 04                     	MOV	EAX,DWORD [4+EDX+EAX*8]
    30 00000011 C3                              	RET
    31 00000012                                 	GLOBAL	_init_pid
    32 00000012                                 _init_pid:
    33 00000012 55                              	PUSH	EBP
    34 00000013 31 C0                           	XOR	EAX,EAX
    35 00000015 89 E5                           	MOV	EBP,ESP
    36 00000017 C7 82 00013878 00000000         	MOV	DWORD [79992+EDX],0
    37 00000021 C7 82 00001F40 00000000         	MOV	DWORD [8000+EDX],0
    38 0000002B                                 L7:
    39 0000002B 89 04 C2                        	MOV	DWORD [EDX+EAX*8],EAX
    40 0000002E 40                              	INC	EAX
    41 0000002F 3D 0000270F                     	CMP	EAX,9999
    42 00000034 7E F5                           	JLE	L7
    43 00000036 31 C0                           	XOR	EAX,EAX
    44 00000038                                 L12:
    45 00000038 89 04 C2                        	MOV	DWORD [EDX+EAX*8],EAX
    46 0000003B 40                              	INC	EAX
    47 0000003C 3D 000003E8                     	CMP	EAX,1000
    48 00000041 7E F5                           	JLE	L12
    49 00000043 89 15 00000F0A                  	MOV	DWORD [3850],EDX
    50 00000049 89 15 00000F0F                  	MOV	DWORD [3855],EDX
    51 0000004F 5D                              	POP	EBP
    52 00000050 C3                              	RET
    53 00000051                                 	GLOBAL	_task_now
    54 00000051                                 _task_now:
    55 00000051 A1 [00000018]                   	MOV	EAX,DWORD [_taskctl]
    56 00000056 55                              	PUSH	EBP
    57 00000057 89 E5                           	MOV	EBP,ESP
    58 00000059 5D                              	POP	EBP
    59 0000005A 8B 10                           	MOV	EDX,DWORD [EAX]
    60 0000005C 69 D2 00000198                  	IMUL	EDX,EDX,408
    61 00000062 8D 44 02 0C                     	LEA	EAX,DWORD [12+EDX+EAX*1]
    62 00000066 8B 50 04                        	MOV	EDX,DWORD [4+EAX]
    63 00000069 8B 44 90 08                     	MOV	EAX,DWORD [8+EAX+EDX*4]
    64 0000006D C3                              	RET
    65 0000006E                                 	GLOBAL	_task_add
    66 0000006E                                 _task_add:
    67 0000006E 55                              	PUSH	EBP
    68 0000006F 89 E5                           	MOV	EBP,ESP
    69 00000071 8B 4D 08                        	MOV	ECX,DWORD [8+EBP]
    70 00000074 8B 51 08                        	MOV	EDX,DWORD [8+ECX]
    71 00000077 69 D2 00000198                  	IMUL	EDX,EDX,408
    72 0000007D 03 15 [00000018]                	ADD	EDX,DWORD [_taskctl]
    73 00000083 8B 42 0C                        	MOV	EAX,DWORD [12+EDX]
    74 00000086 89 4C 82 14                     	MOV	DWORD [20+EDX+EAX*4],ECX
    75 0000008A 40                              	INC	EAX
    76 0000008B 89 42 0C                        	MOV	DWORD [12+EDX],EAX
    77 0000008E C7 41 04 00000002               	MOV	DWORD [4+ECX],2
    78 00000095 5D                              	POP	EBP
    79 00000096 C3                              	RET
    80 00000097                                 	GLOBAL	_task_remove
    81 00000097                                 _task_remove:
    82 00000097 55                              	PUSH	EBP
    83 00000098 31 C9                           	XOR	ECX,ECX
    84 0000009A 89 E5                           	MOV	EBP,ESP
    85 0000009C 57                              	PUSH	EDI
    86 0000009D 56                              	PUSH	ESI
    87 0000009E 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
    88 000000A1 53                              	PUSH	EBX
    89 000000A2 8B 3D 00000F0A                  	MOV	EDI,DWORD [3850]
    90 000000A8 8B 46 08                        	MOV	EAX,DWORD [8+ESI]
    91 000000AB 69 C0 00000198                  	IMUL	EAX,EAX,408
    92 000000B1 03 05 [00000018]                	ADD	EAX,DWORD [_taskctl]
    93 000000B7 8D 50 0C                        	LEA	EDX,DWORD [12+EAX]
    94 000000BA 3B 48 0C                        	CMP	ECX,DWORD [12+EAX]
    95 000000BD 7D 0B                           	JGE	L21
    96 000000BF                                 L25:
    97 000000BF 39 74 8A 08                     	CMP	DWORD [8+EDX+ECX*4],ESI
    98 000000C3 74 05                           	JE	L21
    99 000000C5 41                              	INC	ECX
   100 000000C6 3B 0A                           	CMP	ECX,DWORD [EDX]
   101 000000C8 7C F5                           	JL	L25
   102 000000CA                                 L21:
   103 000000CA 8B 42 04                        	MOV	EAX,DWORD [4+EDX]
   104 000000CD FF 0A                           	DEC	DWORD [EDX]
   105 000000CF 39 C1                           	CMP	ECX,EAX
   106 000000D1 7D 04                           	JGE	L26
   107 000000D3 48                              	DEC	EAX
   108 000000D4 89 42 04                        	MOV	DWORD [4+EDX],EAX
   109 000000D7                                 L26:
   110 000000D7 8B 02                           	MOV	EAX,DWORD [EDX]
   111 000000D9 39 42 04                        	CMP	DWORD [4+EDX],EAX
   112 000000DC 7C 07                           	JL	L27
   113 000000DE C7 42 04 00000000               	MOV	DWORD [4+EDX],0
   114 000000E5                                 L27:
   115 000000E5 C7 46 04 00000001               	MOV	DWORD [4+ESI],1
   116 000000EC 8B 1A                           	MOV	EBX,DWORD [EDX]
   117 000000EE 39 D9                           	CMP	ECX,EBX
   118 000000F0 7D 0D                           	JGE	L35
   119 000000F2                                 L32:
   120 000000F2 8B 44 8A 0C                     	MOV	EAX,DWORD [12+EDX+ECX*4]
   121 000000F6 89 44 8A 08                     	MOV	DWORD [8+EDX+ECX*4],EAX
   122 000000FA 41                              	INC	ECX
   123 000000FB 39 D9                           	CMP	ECX,EBX
   124 000000FD 7C F3                           	JL	L32
   125 000000FF                                 L35:
   126 000000FF 8B 86 0000012C                  	MOV	EAX,DWORD [300+ESI]
   127 00000105 8B 54 C7 04                     	MOV	EDX,DWORD [4+EDI+EAX*8]
   128 00000109 8B 46 04                        	MOV	EAX,DWORD [4+ESI]
   129 0000010C 89 42 04                        	MOV	DWORD [4+EDX],EAX
   130 0000010F 5B                              	POP	EBX
   131 00000110 5E                              	POP	ESI
   132 00000111 5F                              	POP	EDI
   133 00000112 5D                              	POP	EBP
   134 00000113 C3                              	RET
   135 00000114                                 	GLOBAL	_task_switchsub
   136 00000114                                 _task_switchsub:
   137 00000114 55                              	PUSH	EBP
   138 00000115 31 C9                           	XOR	ECX,ECX
   139 00000117 89 E5                           	MOV	EBP,ESP
   140 00000119 A1 [00000018]                   	MOV	EAX,DWORD [_taskctl]
   141 0000011E 31 D2                           	XOR	EDX,EDX
   142 00000120                                 L42:
   143 00000120 83 7C 10 0C 00                  	CMP	DWORD [12+EAX+EDX*1],0
   144 00000125 7F 0C                           	JG	L38
   145 00000127 41                              	INC	ECX
   146 00000128 81 C2 00000198                  	ADD	EDX,408
   147 0000012E 83 F9 09                        	CMP	ECX,9
   148 00000131 7E ED                           	JLE	L42
   149 00000133                                 L38:
   150 00000133 89 08                           	MOV	DWORD [EAX],ECX
   151 00000135 C6 40 08 00                     	MOV	BYTE [8+EAX],0
   152 00000139 5D                              	POP	EBP
   153 0000013A C3                              	RET
   154 0000013B                                 	GLOBAL	_task_idle
   155 0000013B                                 _task_idle:
   156 0000013B 55                              	PUSH	EBP
   157 0000013C 89 E5                           	MOV	EBP,ESP
   158 0000013E                                 L45:
   159 0000013E E8 [00000000]                   	CALL	_io_hlt
   160 00000143 EB F9                           	JMP	L45
   161 00000145                                 	GLOBAL	_task_init
   162 00000145                                 _task_init:
   163 00000145 55                              	PUSH	EBP
   164 00000146 89 E5                           	MOV	EBP,ESP
   165 00000148 57                              	PUSH	EDI
   166 00000149 56                              	PUSH	ESI
   167 0000014A 31 FF                           	XOR	EDI,EDI
   168 0000014C 53                              	PUSH	EBX
   169 0000014D 31 F6                           	XOR	ESI,ESI
   170 0000014F BB 000003E7                     	MOV	EBX,999
   171 00000154 E8 FFFFFEB9                     	CALL	_init_pid
   172 00000159 68 0004E25C                     	PUSH	320092
   173 0000015E FF 75 08                        	PUSH	DWORD [8+EBP]
   174 00000161 E8 [00000000]                   	CALL	_memman_alloc_4k
   175 00000166 A3 [00000018]                   	MOV	DWORD [_taskctl],EAX
   176 0000016B 58                              	POP	EAX
   177 0000016C 5A                              	POP	EDX
   178 0000016D                                 L53:
   179 0000016D 89 FA                           	MOV	EDX,EDI
   180 0000016F 8D 46 18                        	LEA	EAX,DWORD [24+ESI]
   181 00000172 03 15 [00000018]                	ADD	EDX,DWORD [_taskctl]
   182 00000178 89 82 00000FFC                  	MOV	DWORD [4092+EDX],EAX
   183 0000017E 8D 86 00001F58                  	LEA	EAX,DWORD [8024+ESI]
   184 00000184 89 82 00001088                  	MOV	DWORD [4232+EDX],EAX
   185 0000018A 8D 86 00270018                  	LEA	EAX,DWORD [2555928+ESI]
   186 00000190 C7 82 00001000 00000000         	MOV	DWORD [4096+EDX],0
   187 0000019A 68 00000089                     	PUSH	137
   188 0000019F 81 C2 00001028                  	ADD	EDX,4136
   189 000001A5 52                              	PUSH	EDX
   190 000001A6 6A 67                           	PUSH	103
   191 000001A8 50                              	PUSH	EAX
   192 000001A9 E8 [00000000]                   	CALL	_set_segmdesc
   193 000001AE A1 [00000018]                   	MOV	EAX,DWORD [_taskctl]
   194 000001B3 01 F8                           	ADD	EAX,EDI
   195 000001B5 68 00000082                     	PUSH	130
   196 000001BA 05 000010FC                     	ADD	EAX,4348
   197 000001BF 81 C7 0000013C                  	ADD	EDI,316
   198 000001C5 50                              	PUSH	EAX
   199 000001C6 8D 86 00271F58                  	LEA	EAX,DWORD [2563928+ESI]
   200 000001CC 6A 0F                           	PUSH	15
   201 000001CE 83 C6 08                        	ADD	ESI,8
   202 000001D1 50                              	PUSH	EAX
   203 000001D2 E8 [00000000]                   	CALL	_set_segmdesc
   204 000001D7 83 C4 20                        	ADD	ESP,32
   205 000001DA 4B                              	DEC	EBX
   206 000001DB 79 90                           	JNS	L53
   207 000001DD 8B 0D [00000018]                	MOV	ECX,DWORD [_taskctl]
   208 000001E3 31 D2                           	XOR	EDX,EDX
   209 000001E5 BB 00000009                     	MOV	EBX,9
   210 000001EA                                 L58:
   211 000001EA 8D 04 11                        	LEA	EAX,DWORD [ECX+EDX*1]
   212 000001ED 81 C2 00000198                  	ADD	EDX,408
   213 000001F3 4B                              	DEC	EBX
   214 000001F4 C7 40 0C 00000000               	MOV	DWORD [12+EAX],0
   215 000001FB C7 40 10 00000000               	MOV	DWORD [16+EAX],0
   216 00000202 79 E6                           	JNS	L58
   217 00000204 E8 0000012B                     	CALL	_task_alloc
   218 00000209 89 C6                           	MOV	ESI,EAX
   219 0000020B C7 40 04 00000002               	MOV	DWORD [4+EAX],2
   220 00000212 C7 40 0C 00000002               	MOV	DWORD [12+EAX],2
   221 00000219 C7 40 08 00000000               	MOV	DWORD [8+EAX],0
   222 00000220 6A 28                           	PUSH	40
   223 00000222 FF 75 08                        	PUSH	DWORD [8+EBP]
   224 00000225 E8 [00000000]                   	CALL	_memman_alloc_4k
   225 0000022A 89 86 00000138                  	MOV	DWORD [312+ESI],EAX
   226 00000230 C6 00 74                        	MOV	BYTE [EAX],116
   227 00000233 8B 86 00000138                  	MOV	EAX,DWORD [312+ESI]
   228 00000239 C6 40 01 61                     	MOV	BYTE [1+EAX],97
   229 0000023D 8B 86 00000138                  	MOV	EAX,DWORD [312+ESI]
   230 00000243 C6 40 02 73                     	MOV	BYTE [2+EAX],115
   231 00000247 8B 86 00000138                  	MOV	EAX,DWORD [312+ESI]
   232 0000024D C6 40 03 6B                     	MOV	BYTE [3+EAX],107
   233 00000251 8B 86 00000138                  	MOV	EAX,DWORD [312+ESI]
   234 00000257 C6 40 04 5F                     	MOV	BYTE [4+EAX],95
   235 0000025B 8B 86 00000138                  	MOV	EAX,DWORD [312+ESI]
   236 00000261 C6 40 05 61                     	MOV	BYTE [5+EAX],97
   237 00000265 56                              	PUSH	ESI
   238 00000266 E8 FFFFFE03                     	CALL	_task_add
   239 0000026B E8 FFFFFEA4                     	CALL	_task_switchsub
   240 00000270 FF 36                           	PUSH	DWORD [ESI]
   241 00000272 E8 [00000000]                   	CALL	_load_tr
   242 00000277 E8 [00000000]                   	CALL	_timer_alloc
   243 0000027C FF 76 0C                        	PUSH	DWORD [12+ESI]
   244 0000027F 50                              	PUSH	EAX
   245 00000280 A3 [0000001C]                   	MOV	DWORD [_task_timer],EAX
   246 00000285 E8 [00000000]                   	CALL	_timer_settime
   247 0000028A E8 000000A5                     	CALL	_task_alloc
   248 0000028F 68 00010000                     	PUSH	65536
   249 00000294 FF 75 08                        	PUSH	DWORD [8+EBP]
   250 00000297 89 C3                           	MOV	EBX,EAX
   251 00000299 E8 [00000000]                   	CALL	_memman_alloc_4k
   252 0000029E 83 C4 20                        	ADD	ESP,32
   253 000002A1 05 00010000                     	ADD	EAX,65536
   254 000002A6 89 43 64                        	MOV	DWORD [100+EBX],EAX
   255 000002A9 C7 43 4C [0000013B]             	MOV	DWORD [76+EBX],_task_idle
   256 000002B0 C7 43 74 00000008               	MOV	DWORD [116+EBX],8
   257 000002B7 C7 43 78 00000010               	MOV	DWORD [120+EBX],16
   258 000002BE C7 43 7C 00000008               	MOV	DWORD [124+EBX],8
   259 000002C5 C7 83 00000080 00000008         	MOV	DWORD [128+EBX],8
   260 000002CF C7 83 00000084 00000008         	MOV	DWORD [132+EBX],8
   261 000002D9 C7 83 00000088 00000008         	MOV	DWORD [136+EBX],8
   262 000002E3 6A 28                           	PUSH	40
   263 000002E5 FF 75 08                        	PUSH	DWORD [8+EBP]
   264 000002E8 E8 [00000000]                   	CALL	_memman_alloc_4k
   265 000002ED 89 83 00000138                  	MOV	DWORD [312+EBX],EAX
   266 000002F3 C6 00 69                        	MOV	BYTE [EAX],105
   267 000002F6 8B 83 00000138                  	MOV	EAX,DWORD [312+EBX]
   268 000002FC C6 40 01 64                     	MOV	BYTE [1+EAX],100
   269 00000300 8B 83 00000138                  	MOV	EAX,DWORD [312+EBX]
   270 00000306 C6 40 02 6C                     	MOV	BYTE [2+EAX],108
   271 0000030A 8B 83 00000138                  	MOV	EAX,DWORD [312+EBX]
   272 00000310 C6 40 03 65                     	MOV	BYTE [3+EAX],101
   273 00000314 6A 01                           	PUSH	1
   274 00000316 6A 09                           	PUSH	9
   275 00000318 53                              	PUSH	EBX
   276 00000319 E8 000000F6                     	CALL	_task_run
   277 0000031E A1 [00000018]                   	MOV	EAX,DWORD [_taskctl]
   278 00000323 C7 40 04 00000000               	MOV	DWORD [4+EAX],0
   279 0000032A 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   280 0000032D 89 F0                           	MOV	EAX,ESI
   281 0000032F 5B                              	POP	EBX
   282 00000330 5E                              	POP	ESI
   283 00000331 5F                              	POP	EDI
   284 00000332 5D                              	POP	EBP
   285 00000333 C3                              	RET
   286 00000334                                 	GLOBAL	_task_alloc
   287 00000334                                 _task_alloc:
   288 00000334 55                              	PUSH	EBP
   289 00000335 31 C9                           	XOR	ECX,ECX
   290 00000337 89 E5                           	MOV	EBP,ESP
   291 00000339                                 L74:
   292 00000339 89 C8                           	MOV	EAX,ECX
   293 0000033B 69 C0 0000013C                  	IMUL	EAX,EAX,316
   294 00000341 03 05 [00000018]                	ADD	EAX,DWORD [_taskctl]
   295 00000347 83 B8 00001000 00               	CMP	DWORD [4096+EAX],0
   296 0000034E 74 0D                           	JE	L79
   297 00000350 41                              	INC	ECX
   298 00000351 81 F9 000003E7                  	CMP	ECX,999
   299 00000357 7E E0                           	JLE	L74
   300 00000359 31 C0                           	XOR	EAX,EAX
   301 0000035B                                 L63:
   302 0000035B 5D                              	POP	EBP
   303 0000035C C3                              	RET
   304 0000035D                                 L79:
   305 0000035D 8D 90 00000FFC                  	LEA	EDX,DWORD [4092+EAX]
   306 00000363 B9 00000003                     	MOV	ECX,3
   307 00000368 C7 42 04 00000001               	MOV	DWORD [4+EDX],1
   308 0000036F C7 42 50 00000202               	MOV	DWORD [80+EDX],514
   309 00000376 C7 42 54 00000000               	MOV	DWORD [84+EDX],0
   310 0000037D C7 42 58 00000000               	MOV	DWORD [88+EDX],0
   311 00000384 C7 42 5C 00000000               	MOV	DWORD [92+EDX],0
   312 0000038B C7 42 60 00000000               	MOV	DWORD [96+EDX],0
   313 00000392 C7 42 68 00000000               	MOV	DWORD [104+EDX],0
   314 00000399 C7 42 6C 00000000               	MOV	DWORD [108+EDX],0
   315 000003A0 C7 42 70 00000000               	MOV	DWORD [112+EDX],0
   316 000003A7 C7 42 74 00000000               	MOV	DWORD [116+EDX],0
   317 000003AE C7 82 00000080 00000000         	MOV	DWORD [128+EDX],0
   318 000003B8 C7 82 00000084 00000000         	MOV	DWORD [132+EDX],0
   319 000003C2 C7 82 00000088 00000000         	MOV	DWORD [136+EDX],0
   320 000003CC C7 82 00000090 40000000         	MOV	DWORD [144+EDX],1073741824
   321 000003D6 C7 42 34 00000000               	MOV	DWORD [52+EDX],0
   322 000003DD C7 82 00000094 0000037F         	MOV	DWORD [148+EDX],895
   323 000003E7 C7 82 00000098 00000000         	MOV	DWORD [152+EDX],0
   324 000003F1 C7 82 0000009C 0000FFFF         	MOV	DWORD [156+EDX],65535
   325 000003FB                                 L73:
   326 000003FB C7 84 8A 00000094 00000000      	MOV	DWORD [148+EDX+ECX*4],0
   327 00000406 41                              	INC	ECX
   328 00000407 89 D0                           	MOV	EAX,EDX
   329 00000409 83 F9 1A                        	CMP	ECX,26
   330 0000040C 0F 8F FFFFFF49                  	JG	L63
   331 00000412 EB E7                           	JMP	L73
   332 00000414                                 	GLOBAL	_task_run
   333 00000414                                 _task_run:
   334 00000414 55                              	PUSH	EBP
   335 00000415 89 E5                           	MOV	EBP,ESP
   336 00000417 57                              	PUSH	EDI
   337 00000418 56                              	PUSH	ESI
   338 00000419 53                              	PUSH	EBX
   339 0000041A 8B 7D 0C                        	MOV	EDI,DWORD [12+EBP]
   340 0000041D 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   341 00000420 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   342 00000423 8B 35 00000F0A                  	MOV	ESI,DWORD [3850]
   343 00000429 85 FF                           	TEST	EDI,EDI
   344 0000042B 78 76                           	JS	L86
   345 0000042D                                 L81:
   346 0000042D 85 C0                           	TEST	EAX,EAX
   347 0000042F 7E 03                           	JLE	L82
   348 00000431 89 43 0C                        	MOV	DWORD [12+EBX],EAX
   349 00000434                                 L82:
   350 00000434 83 7B 04 01                     	CMP	DWORD [4+EBX],1
   351 00000438 74 4E                           	JE	L87
   352 0000043A                                 L83:
   353 0000043A 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   354 0000043E 74 3A                           	JE	L88
   355 00000440                                 L84:
   356 00000440 83 7B 04 02                     	CMP	DWORD [4+EBX],2
   357 00000444 74 23                           	JE	L85
   358 00000446 8B 86 00013878                  	MOV	EAX,DWORD [79992+ESI]
   359 0000044C 8D 50 01                        	LEA	EDX,DWORD [1+EAX]
   360 0000044F 89 5C C6 04                     	MOV	DWORD [4+ESI+EAX*8],EBX
   361 00000453 89 96 00013878                  	MOV	DWORD [79992+ESI],EDX
   362 00000459 89 7B 08                        	MOV	DWORD [8+EBX],EDI
   363 0000045C 89 83 0000012C                  	MOV	DWORD [300+EBX],EAX
   364 00000462 53                              	PUSH	EBX
   365 00000463 E8 FFFFFC06                     	CALL	_task_add
   366 00000468 59                              	POP	ECX
   367 00000469                                 L85:
   368 00000469 A1 [00000018]                   	MOV	EAX,DWORD [_taskctl]
   369 0000046E C6 40 08 01                     	MOV	BYTE [8+EAX],1
   370 00000472 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   371 00000475 5B                              	POP	EBX
   372 00000476 5E                              	POP	ESI
   373 00000477 5F                              	POP	EDI
   374 00000478 5D                              	POP	EBP
   375 00000479 C3                              	RET
   376 0000047A                                 L88:
   377 0000047A 39 7B 08                        	CMP	DWORD [8+EBX],EDI
   378 0000047D 74 C1                           	JE	L84
   379 0000047F 53                              	PUSH	EBX
   380 00000480 E8 FFFFFC12                     	CALL	_task_remove
   381 00000485 58                              	POP	EAX
   382 00000486 EB B8                           	JMP	L84
   383 00000488                                 L87:
   384 00000488 8B 86 00013878                  	MOV	EAX,DWORD [79992+ESI]
   385 0000048E 8D 50 01                        	LEA	EDX,DWORD [1+EAX]
   386 00000491 89 5C C6 04                     	MOV	DWORD [4+ESI+EAX*8],EBX
   387 00000495 89 96 00013878                  	MOV	DWORD [79992+ESI],EDX
   388 0000049B 89 83 0000012C                  	MOV	DWORD [300+EBX],EAX
   389 000004A1 EB 97                           	JMP	L83
   390 000004A3                                 L86:
   391 000004A3 8B 7B 08                        	MOV	EDI,DWORD [8+EBX]
   392 000004A6 EB 85                           	JMP	L81
   393 000004A8                                 	GLOBAL	_task_sleep
   394 000004A8                                 _task_sleep:
   395 000004A8 55                              	PUSH	EBP
   396 000004A9 89 E5                           	MOV	EBP,ESP
   397 000004AB 56                              	PUSH	ESI
   398 000004AC 53                              	PUSH	EBX
   399 000004AD 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   400 000004B0 83 7E 04 02                     	CMP	DWORD [4+ESI],2
   401 000004B4 74 07                           	JE	L92
   402 000004B6                                 L89:
   403 000004B6 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   404 000004B9 5B                              	POP	EBX
   405 000004BA 5E                              	POP	ESI
   406 000004BB 5D                              	POP	EBP
   407 000004BC C3                              	RET
   408 000004BD                                 L92:
   409 000004BD E8 FFFFFB8F                     	CALL	_task_now
   410 000004C2 56                              	PUSH	ESI
   411 000004C3 89 C3                           	MOV	EBX,EAX
   412 000004C5 E8 FFFFFBCD                     	CALL	_task_remove
   413 000004CA 59                              	POP	ECX
   414 000004CB 39 DE                           	CMP	ESI,EBX
   415 000004CD 75 E7                           	JNE	L89
   416 000004CF E8 FFFFFC40                     	CALL	_task_switchsub
   417 000004D4 E8 FFFFFB78                     	CALL	_task_now
   418 000004D9 FF 30                           	PUSH	DWORD [EAX]
   419 000004DB 6A 00                           	PUSH	0
   420 000004DD E8 [00000000]                   	CALL	_farjmp
   421 000004E2 58                              	POP	EAX
   422 000004E3 5A                              	POP	EDX
   423 000004E4 EB D0                           	JMP	L89
   424 000004E6                                 	GLOBAL	_task_switch
   425 000004E6                                 _task_switch:
   426 000004E6 55                              	PUSH	EBP
   427 000004E7 89 E5                           	MOV	EBP,ESP
   428 000004E9 56                              	PUSH	ESI
   429 000004EA 53                              	PUSH	EBX
   430 000004EB 8B 1D [00000018]                	MOV	EBX,DWORD [_taskctl]
   431 000004F1 8B 13                           	MOV	EDX,DWORD [EBX]
   432 000004F3 69 D2 00000198                  	IMUL	EDX,EDX,408
   433 000004F9 8D 14 1A                        	LEA	EDX,DWORD [EDX+EBX*1]
   434 000004FC 8D 4A 0C                        	LEA	ECX,DWORD [12+EDX]
   435 000004FF 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   436 00000502 8B 74 81 08                     	MOV	ESI,DWORD [8+ECX+EAX*4]
   437 00000506 40                              	INC	EAX
   438 00000507 89 41 04                        	MOV	DWORD [4+ECX],EAX
   439 0000050A 3B 42 0C                        	CMP	EAX,DWORD [12+EDX]
   440 0000050D 74 4C                           	JE	L97
   441 0000050F                                 L94:
   442 0000050F 80 7B 08 00                     	CMP	BYTE [8+EBX],0
   443 00000513 75 2D                           	JNE	L98
   444 00000515                                 L95:
   445 00000515 8B 41 04                        	MOV	EAX,DWORD [4+ECX]
   446 00000518 8B 5C 81 08                     	MOV	EBX,DWORD [8+ECX+EAX*4]
   447 0000051C FF 73 0C                        	PUSH	DWORD [12+EBX]
   448 0000051F FF 35 [0000001C]                	PUSH	DWORD [_task_timer]
   449 00000525 E8 [00000000]                   	CALL	_timer_settime
   450 0000052A 39 F3                           	CMP	EBX,ESI
   451 0000052C 58                              	POP	EAX
   452 0000052D 5A                              	POP	EDX
   453 0000052E 74 0B                           	JE	L93
   454 00000530 FF 33                           	PUSH	DWORD [EBX]
   455 00000532 6A 00                           	PUSH	0
   456 00000534 E8 [00000000]                   	CALL	_farjmp
   457 00000539 5B                              	POP	EBX
   458 0000053A 5E                              	POP	ESI
   459 0000053B                                 L93:
   460 0000053B 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   461 0000053E 5B                              	POP	EBX
   462 0000053F 5E                              	POP	ESI
   463 00000540 5D                              	POP	EBP
   464 00000541 C3                              	RET
   465 00000542                                 L98:
   466 00000542 E8 FFFFFBCD                     	CALL	_task_switchsub
   467 00000547 8B 15 [00000018]                	MOV	EDX,DWORD [_taskctl]
   468 0000054D 8B 02                           	MOV	EAX,DWORD [EDX]
   469 0000054F 69 C0 00000198                  	IMUL	EAX,EAX,408
   470 00000555 8D 4C 10 0C                     	LEA	ECX,DWORD [12+EAX+EDX*1]
   471 00000559 EB BA                           	JMP	L95
   472 0000055B                                 L97:
   473 0000055B C7 41 04 00000000               	MOV	DWORD [4+ECX],0
   474 00000562 EB AB                           	JMP	L94
   475 00000564                                 	GLOBAL	_inthandler07
   476 00000564                                 _inthandler07:
   477 00000564 55                              	PUSH	EBP
   478 00000565 89 E5                           	MOV	EBP,ESP
   479 00000567 53                              	PUSH	EBX
   480 00000568 E8 FFFFFAE4                     	CALL	_task_now
   481 0000056D 89 C3                           	MOV	EBX,EAX
   482 0000056F E8 [00000000]                   	CALL	_io_cli
   483 00000574 E8 [00000000]                   	CALL	_clts
   484 00000579 A1 [00000018]                   	MOV	EAX,DWORD [_taskctl]
   485 0000057E 8B 40 04                        	MOV	EAX,DWORD [4+EAX]
   486 00000581 39 D8                           	CMP	EAX,EBX
   487 00000583 74 19                           	JE	L100
   488 00000585 85 C0                           	TEST	EAX,EAX
   489 00000587 75 21                           	JNE	L102
   490 00000589                                 L101:
   491 00000589 8D 83 00000094                  	LEA	EAX,DWORD [148+EBX]
   492 0000058F 50                              	PUSH	EAX
   493 00000590 E8 [00000000]                   	CALL	_frstor
   494 00000595 A1 [00000018]                   	MOV	EAX,DWORD [_taskctl]
   495 0000059A 89 58 04                        	MOV	DWORD [4+EAX],EBX
   496 0000059D 59                              	POP	ECX
   497 0000059E                                 L100:
   498 0000059E E8 [00000000]                   	CALL	_io_sti
   499 000005A3 8B 5D FC                        	MOV	EBX,DWORD [-4+EBP]
   500 000005A6 31 C0                           	XOR	EAX,EAX
   501 000005A8 C9                              	LEAVE
   502 000005A9 C3                              	RET
   503 000005AA                                 L102:
   504 000005AA 05 00000094                     	ADD	EAX,148
   505 000005AF 50                              	PUSH	EAX
   506 000005B0 E8 [00000000]                   	CALL	_fnsave
   507 000005B5 58                              	POP	EAX
   508 000005B6 EB D1                           	JMP	L101
   509 000005B8                                 	GLOBAL	_task_block
   510 000005B8                                 _task_block:
   511 000005B8 55                              	PUSH	EBP
   512 000005B9 89 E5                           	MOV	EBP,ESP
   513 000005BB 57                              	PUSH	EDI
   514 000005BC 56                              	PUSH	ESI
   515 000005BD 53                              	PUSH	EBX
   516 000005BE 53                              	PUSH	EBX
   517 000005BF 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   518 000005C2 A1 00000F0A                     	MOV	EAX,DWORD [3850]
   519 000005C7 89 45 F0                        	MOV	DWORD [-16+EBP],EAX
   520 000005CA 8B 1D 00000F0F                  	MOV	EBX,DWORD [3855]
   521 000005D0 83 7F 04 02                     	CMP	DWORD [4+EDI],2
   522 000005D4 74 08                           	JE	L106
   523 000005D6                                 L103:
   524 000005D6 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   525 000005D9 5B                              	POP	EBX
   526 000005DA 5E                              	POP	ESI
   527 000005DB 5F                              	POP	EDI
   528 000005DC 5D                              	POP	EBP
   529 000005DD C3                              	RET
   530 000005DE                                 L106:
   531 000005DE E8 FFFFFA6E                     	CALL	_task_now
   532 000005E3 57                              	PUSH	EDI
   533 000005E4 89 C6                           	MOV	ESI,EAX
   534 000005E6 E8 FFFFFAAC                     	CALL	_task_remove
   535 000005EB 8B 87 0000012C                  	MOV	EAX,DWORD [300+EDI]
   536 000005F1 8B 4D F0                        	MOV	ECX,DWORD [-16+EBP]
   537 000005F4 C7 47 04 00000003               	MOV	DWORD [4+EDI],3
   538 000005FB 8B 54 C1 04                     	MOV	EDX,DWORD [4+ECX+EAX*8]
   539 000005FF C7 42 04 00000003               	MOV	DWORD [4+EDX],3
   540 00000606 8B 93 00001F40                  	MOV	EDX,DWORD [8000+EBX]
   541 0000060C 89 04 D3                        	MOV	DWORD [EBX+EDX*8],EAX
   542 0000060F 89 7C D3 04                     	MOV	DWORD [4+EBX+EDX*8],EDI
   543 00000613 FF 83 00001F40                  	INC	DWORD [8000+EBX]
   544 00000619 39 F7                           	CMP	EDI,ESI
   545 0000061B 59                              	POP	ECX
   546 0000061C 75 B8                           	JNE	L103
   547 0000061E E8 FFFFFAF1                     	CALL	_task_switchsub
   548 00000623 E8 FFFFFA29                     	CALL	_task_now
   549 00000628 FF 30                           	PUSH	DWORD [EAX]
   550 0000062A 6A 00                           	PUSH	0
   551 0000062C E8 [00000000]                   	CALL	_farjmp
   552 00000631 58                              	POP	EAX
   553 00000632 5A                              	POP	EDX
   554 00000633 EB A1                           	JMP	L103
   555 00000635                                 	GLOBAL	_task_unblock
   556 00000635                                 _task_unblock:
   557 00000635 55                              	PUSH	EBP
   558 00000636 89 E5                           	MOV	EBP,ESP
   559 00000638 57                              	PUSH	EDI
   560 00000639 56                              	PUSH	ESI
   561 0000063A 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   562 0000063D 53                              	PUSH	EBX
   563 0000063E 8B 1D 00000F0A                  	MOV	EBX,DWORD [3850]
   564 00000644 8B 35 00000F0F                  	MOV	ESI,DWORD [3855]
   565 0000064A FF 77 0C                        	PUSH	DWORD [12+EDI]
   566 0000064D FF 77 08                        	PUSH	DWORD [8+EDI]
   567 00000650 57                              	PUSH	EDI
   568 00000651 E8 FFFFFDBE                     	CALL	_task_run
   569 00000656 83 C4 0C                        	ADD	ESP,12
   570 00000659 8B 87 0000012C                  	MOV	EAX,DWORD [300+EDI]
   571 0000065F 31 C9                           	XOR	ECX,ECX
   572 00000661 8B 54 C3 04                     	MOV	EDX,DWORD [4+EBX+EAX*8]
   573 00000665 8B 47 04                        	MOV	EAX,DWORD [4+EDI]
   574 00000668 89 42 04                        	MOV	DWORD [4+EDX],EAX
   575 0000066B 8B 86 00001F40                  	MOV	EAX,DWORD [8000+ESI]
   576 00000671 39 C1                           	CMP	ECX,EAX
   577 00000673 7D 0B                           	JGE	L109
   578 00000675                                 L113:
   579 00000675 39 7C CE 04                     	CMP	DWORD [4+ESI+ECX*8],EDI
   580 00000679 74 34                           	JE	L122
   581 0000067B 41                              	INC	ECX
   582 0000067C 39 C1                           	CMP	ECX,EAX
   583 0000067E 7C F5                           	JL	L113
   584 00000680                                 L109:
   585 00000680 8B 9E 00001F40                  	MOV	EBX,DWORD [8000+ESI]
   586 00000686 39 D9                           	CMP	ECX,EBX
   587 00000688 7D 14                           	JGE	L121
   588 0000068A                                 L118:
   589 0000068A 8B 44 CE 08                     	MOV	EAX,DWORD [8+ESI+ECX*8]
   590 0000068E 8B 54 CE 0C                     	MOV	EDX,DWORD [12+ESI+ECX*8]
   591 00000692 89 04 CE                        	MOV	DWORD [ESI+ECX*8],EAX
   592 00000695 89 54 CE 04                     	MOV	DWORD [4+ESI+ECX*8],EDX
   593 00000699 41                              	INC	ECX
   594 0000069A 39 D9                           	CMP	ECX,EBX
   595 0000069C 7C EC                           	JL	L118
   596 0000069E                                 L121:
   597 0000069E 8D 43 FF                        	LEA	EAX,DWORD [-1+EBX]
   598 000006A1 89 86 00001F40                  	MOV	DWORD [8000+ESI],EAX
   599 000006A7 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   600 000006AA 5B                              	POP	EBX
   601 000006AB 5E                              	POP	ESI
   602 000006AC 5F                              	POP	EDI
   603 000006AD 5D                              	POP	EBP
   604 000006AE C3                              	RET
   605 000006AF                                 L122:
   606 000006AF C7 44 CE 04 00000000            	MOV	DWORD [4+ESI+ECX*8],0
   607 000006B7 C7 04 CE 00000000               	MOV	DWORD [ESI+ECX*8],0
   608 000006BE EB C0                           	JMP	L109
   609                                          [SECTION .data]
   610 00000000                                 LC0:
   611 00000000 6D 74 61 73 6B 20 6D 65 73 73   	DB	"mtask message recv mess",0x00
       0000000A 61 67 65 20 72 65 63 76 20 6D 
       00000014 65 73 73 00 
   612                                          [SECTION .text]
   613 000006C0                                 	GLOBAL	_message_receive
   614 000006C0                                 _message_receive:
   615 000006C0 55                              	PUSH	EBP
   616 000006C1 89 E5                           	MOV	EBP,ESP
   617 000006C3 56                              	PUSH	ESI
   618 000006C4 53                              	PUSH	EBX
   619 000006C5 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   620 000006C8 E8 FFFFF984                     	CALL	_task_now
   621 000006CD 89 C3                           	MOV	EBX,EAX
   622 000006CF C7 80 00000130 00000001         	MOV	DWORD [304+EAX],1
   623 000006D9                                 L124:
   624 000006D9 8B 83 00000134                  	MOV	EAX,DWORD [308+EBX]
   625 000006DF 85 C0                           	TEST	EAX,EAX
   626 000006E1 75 0E                           	JNE	L134
   627 000006E3                                 L131:
   628 000006E3 E8 FFFFF969                     	CALL	_task_now
   629 000006E8 50                              	PUSH	EAX
   630 000006E9                                 L132:
   631 000006E9 E8 FFFFFECA                     	CALL	_task_block
   632 000006EE 58                              	POP	EAX
   633 000006EF EB E8                           	JMP	L124
   634 000006F1                                 L134:
   635 000006F1 81 FE 00002710                  	CMP	ESI,10000
   636 000006F7 74 25                           	JE	L135
   637 000006F9 39 70 0C                        	CMP	DWORD [12+EAX],ESI
   638 000006FC 74 03                           	JE	L133
   639 000006FE 53                              	PUSH	EBX
   640 000006FF EB E8                           	JMP	L132
   641 00000701                                 L133:
   642 00000701 C7 83 00000130 00000000         	MOV	DWORD [304+EBX],0
   643 0000070B C7 83 00000134 00000000         	MOV	DWORD [308+EBX],0
   644 00000715 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   645 00000718 31 C0                           	XOR	EAX,EAX
   646 0000071A 5B                              	POP	EBX
   647 0000071B 5E                              	POP	ESI
   648 0000071C 5D                              	POP	EBP
   649 0000071D C3                              	RET
   650 0000071E                                 L135:
   651 0000071E 6A 0F                           	PUSH	15
   652 00000720 68 000000FF                     	PUSH	255
   653 00000725 6A 00                           	PUSH	0
   654 00000727 6A 08                           	PUSH	8
   655 00000729 6A 00                           	PUSH	0
   656 0000072B 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   657 00000732 50                              	PUSH	EAX
   658 00000733 FF 35 00000FF8                  	PUSH	DWORD [4088]
   659 00000739 E8 [00000000]                   	CALL	_boxfill8
   660 0000073E 68 [00000000]                   	PUSH	LC0
   661 00000743 6A 07                           	PUSH	7
   662 00000745 6A 00                           	PUSH	0
   663 00000747 6A 08                           	PUSH	8
   664 00000749 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   665 00000750 50                              	PUSH	EAX
   666 00000751 FF 35 00000FF8                  	PUSH	DWORD [4088]
   667 00000757 E8 [00000000]                   	CALL	_putfonts8_asc
   668 0000075C EB A3                           	JMP	L133
   669 0000075E                                 	GLOBAL	_message_send
   670 0000075E                                 _message_send:
   671 0000075E 55                              	PUSH	EBP
   672 0000075F 89 E5                           	MOV	EBP,ESP
   673 00000761 56                              	PUSH	ESI
   674 00000762 53                              	PUSH	EBX
   675 00000763 FF 75 08                        	PUSH	DWORD [8+EBP]
   676 00000766 8B 75 0C                        	MOV	ESI,DWORD [12+EBP]
   677 00000769 E8 FFFFF892                     	CALL	_pid2task
   678 0000076E 89 C3                           	MOV	EBX,EAX
   679 00000770 58                              	POP	EAX
   680 00000771 83 C8 FF                        	OR	EAX,-1
   681 00000774 85 DB                           	TEST	EBX,EBX
   682 00000776 74 1C                           	JE	L136
   683 00000778 E8 FFFFF8D4                     	CALL	_task_now
   684 0000077D 89 B3 00000134                  	MOV	DWORD [308+EBX],ESI
   685 00000783 8B 80 0000012C                  	MOV	EAX,DWORD [300+EAX]
   686 00000789 89 46 0C                        	MOV	DWORD [12+ESI],EAX
   687 0000078C 83 7B 04 03                     	CMP	DWORD [4+EBX],3
   688 00000790 74 09                           	JE	L139
   689 00000792                                 L138:
   690 00000792 31 C0                           	XOR	EAX,EAX
   691 00000794                                 L136:
   692 00000794 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   693 00000797 5B                              	POP	EBX
   694 00000798 5E                              	POP	ESI
   695 00000799 5D                              	POP	EBP
   696 0000079A C3                              	RET
   697 0000079B                                 L139:
   698 0000079B 53                              	PUSH	EBX
   699 0000079C E8 FFFFFE94                     	CALL	_task_unblock
   700 000007A1 58                              	POP	EAX
   701 000007A2 EB EE                           	JMP	L138
   702 000007A4                                 	GLOBAL	_taskctl
   703                                          [SECTION .data]
   704 00000018                                 	ALIGNB	4
   705 00000018                                 _taskctl:
   706 00000018 00 00 00 00                     	RESB	4
   707 0000001C                                 	GLOBAL	_task_timer
   708                                          [SECTION .data]
   709 0000001C                                 	ALIGNB	4
   710 0000001C                                 _task_timer:
   711 0000001C 00 00 00 00                     	RESB	4
