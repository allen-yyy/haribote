     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_HDEntry
     7 00000000                                 	EXTERN	_FSEntry
     8 00000000                                 	EXTERN	_io_cli
     9 00000000                                 	EXTERN	_io_sti
    10 00000000                                 	EXTERN	_file_search
    11 00000000                                 	EXTERN	_memman_alloc_4k
    12 00000000                                 	EXTERN	_file_loadfile
    13 00000000                                 	EXTERN	_task_alloc
    14 00000000                                 	EXTERN	_putfonts8_asc
    15 00000000                                 	EXTERN	_task_run
    16 00000000                                 	EXTERN	_strcmp
    17 00000000                                 	EXTERN	_task_now
    18 00000000                                 	EXTERN	_set_segmdesc
    19 00000000                                 	EXTERN	_start_sys
    20 00000000                                 	EXTERN	_task_sleep
    21 00000000                                 [FILE "driver.c"]
    22 00000000                                 	GLOBAL	_dDevs
    23                                          [SECTION .data]
    24 00000000                                 LC0:
    25 00000000 49 64 65 20 48 44 00            	DB	"Ide HD",0x00
    26 00000007                                 LC1:
    27 00000007 46 53 00                        	DB	"FS",0x00
    28 0000000A 00 00                           	ALIGNB	4
    29 0000000C                                 _dDevs:
    30 0000000C [00000000]                      	DD	LC0
    31 00000010 [00000000]                      	DD	_HDEntry
    32 00000014 00 00 00 00                     	RESB	4
    33 00000018 [00000007]                      	DD	LC1
    34 0000001C [00000000]                      	DD	_FSEntry
    35 00000020 00 00 00 00                     	RESB	4
    36 00000024                                 	GLOBAL	_etable
    37 00000024                                 LC2:
    38 00000024 74 65 73 74 00                  	DB	"test",0x00
    39 00000029                                 LC3:
    40 00000029 73 79 73 74 65 73 74 2E 73 79   	DB	"systest.sys",0x00
       00000033 73 00 
    41 00000035 00 00 00                        	ALIGNB	4
    42 00000038                                 _etable:
    43 00000038 [00000024]                      	DD	LC2
    44 0000003C [00000029]                      	DD	LC3
    45 00000040 00 00 00 00                     	RESB	4
    46                                          [SECTION .text]
    47 00000000                                 	GLOBAL	_LDevs
    48 00000000                                 _LDevs:
    49 00000000 55                              	PUSH	EBP
    50 00000001 89 E5                           	MOV	EBP,ESP
    51 00000003 57                              	PUSH	EDI
    52 00000004 56                              	PUSH	ESI
    53 00000005 31 FF                           	XOR	EDI,EDI
    54 00000007 53                              	PUSH	EBX
    55 00000008 31 F6                           	XOR	ESI,ESI
    56 0000000A 83 EC 10                        	SUB	ESP,16
    57 0000000D E8 [00000000]                   	CALL	_io_cli
    58 00000012                                 L7:
    59 00000012 8B 86 [0000000C]                	MOV	EAX,DWORD [_dDevs+ESI]
    60 00000018 8D 5D E4                        	LEA	EBX,DWORD [-28+EBP]
    61 0000001B 89 45 E4                        	MOV	DWORD [-28+EBP],EAX
    62 0000001E 89 9E [00000014]                	MOV	DWORD [_dDevs+8+ESI],EBX
    63 00000024 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    64 00000027 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
    65 0000002A E8 [00000000]                   	CALL	_io_sti
    66 0000002F 53                              	PUSH	EBX
    67 00000030 FF 96 [00000010]                	CALL	DWORD [_dDevs+4+ESI]
    68 00000036 5A                              	POP	EDX
    69 00000037 31 D2                           	XOR	EDX,EDX
    70 00000039 85 C0                           	TEST	EAX,EAX
    71 0000003B 74 13                           	JE	L1
    72 0000003D 47                              	INC	EDI
    73 0000003E 83 C6 0C                        	ADD	ESI,12
    74 00000041 83 FF 01                        	CMP	EDI,1
    75 00000044 7E CC                           	JLE	L7
    76 00000046 E8 [00000000]                   	CALL	_io_sti
    77 0000004B BA 00000001                     	MOV	EDX,1
    78 00000050                                 L1:
    79 00000050 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
    80 00000053 89 D0                           	MOV	EAX,EDX
    81 00000055 5B                              	POP	EBX
    82 00000056 5E                              	POP	ESI
    83 00000057 5F                              	POP	EDI
    84 00000058 5D                              	POP	EBP
    85 00000059 C3                              	RET
    86                                          [SECTION .data]
    87 00000044                                 LC4:
    88 00000044 20 20 74 00                     	DB	"  t",0x00
    89                                          [SECTION .text]
    90 0000005A                                 	GLOBAL	_load_external_device
    91 0000005A                                 _load_external_device:
    92 0000005A 55                              	PUSH	EBP
    93 0000005B 89 E5                           	MOV	EBP,ESP
    94 0000005D 57                              	PUSH	EDI
    95 0000005E 56                              	PUSH	ESI
    96 0000005F 53                              	PUSH	EBX
    97 00000060 83 EC 18                        	SUB	ESP,24
    98 00000063 C7 45 DC 00000000               	MOV	DWORD [-36+EBP],0
    99 0000006A C7 45 E0 00000000               	MOV	DWORD [-32+EBP],0
   100 00000071                                 L15:
   101 00000071 8B 55 DC                        	MOV	EDX,DWORD [-36+EBP]
   102 00000074 8B 82 [00000038]                	MOV	EAX,DWORD [_etable+EDX]
   103 0000007A 8B 10                           	MOV	EDX,DWORD [EAX]
   104 0000007C 8B 45 E4                        	MOV	EAX,DWORD [-28+EBP]
   105 0000007F 89 10                           	MOV	DWORD [EAX],EDX
   106 00000081 68 000000E0                     	PUSH	224
   107 00000086 8B 55 DC                        	MOV	EDX,DWORD [-36+EBP]
   108 00000089 68 00102600                     	PUSH	1058304
   109 0000008E 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   110 00000091 FF B2 [0000003C]                	PUSH	DWORD [_etable+4+EDX]
   111 00000097 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
   112 0000009A 8D 45 E4                        	LEA	EAX,DWORD [-28+EBP]
   113 0000009D 89 82 [00000040]                	MOV	DWORD [_etable+8+EDX],EAX
   114 000000A3 E8 [00000000]                   	CALL	_file_search
   115 000000A8 89 C6                           	MOV	ESI,EAX
   116 000000AA FF 70 1C                        	PUSH	DWORD [28+EAX]
   117 000000AD FF 75 0C                        	PUSH	DWORD [12+EBP]
   118 000000B0 E8 [00000000]                   	CALL	_memman_alloc_4k
   119 000000B5 68 00103E00                     	PUSH	1064448
   120 000000BA FF 75 08                        	PUSH	DWORD [8+EBP]
   121 000000BD 50                              	PUSH	EAX
   122 000000BE 89 C7                           	MOV	EDI,EAX
   123 000000C0 FF 76 1C                        	PUSH	DWORD [28+ESI]
   124 000000C3 0F B7 46 1A                     	MOVZX	EAX,WORD [26+ESI]
   125 000000C7 50                              	PUSH	EAX
   126 000000C8 E8 [00000000]                   	CALL	_file_loadfile
   127 000000CD 83 C4 28                        	ADD	ESP,40
   128 000000D0 E8 [00000000]                   	CALL	_task_alloc
   129 000000D5 68 00010000                     	PUSH	65536
   130 000000DA 89 C3                           	MOV	EBX,EAX
   131 000000DC FF 75 0C                        	PUSH	DWORD [12+EBP]
   132 000000DF E8 [00000000]                   	CALL	_memman_alloc_4k
   133 000000E4 05 0000FFF4                     	ADD	EAX,65524
   134 000000E9 89 43 64                        	MOV	DWORD [100+EBX],EAX
   135 000000EC C7 43 4C [000001B4]             	MOV	DWORD [76+EBX],_opensys
   136 000000F3 C7 43 74 00000008               	MOV	DWORD [116+EBX],8
   137 000000FA C7 43 78 00000008               	MOV	DWORD [120+EBX],8
   138 00000101 C7 43 7C 00000008               	MOV	DWORD [124+EBX],8
   139 00000108 C7 83 00000080 00000008         	MOV	DWORD [128+EBX],8
   140 00000112 C7 83 00000084 00000008         	MOV	DWORD [132+EBX],8
   141 0000011C C7 83 00000088 00000008         	MOV	DWORD [136+EBX],8
   142 00000126 89 78 04                        	MOV	DWORD [4+EAX],EDI
   143 00000129 8B 53 64                        	MOV	EDX,DWORD [100+EBX]
   144 0000012C 8B 46 1C                        	MOV	EAX,DWORD [28+ESI]
   145 0000012F 89 42 08                        	MOV	DWORD [8+EDX],EAX
   146 00000132 68 [00000044]                   	PUSH	LC4
   147 00000137 6A 07                           	PUSH	7
   148 00000139 6A 09                           	PUSH	9
   149 0000013B 6A 00                           	PUSH	0
   150 0000013D 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   151 00000144 50                              	PUSH	EAX
   152 00000145 FF 35 00000FF8                  	PUSH	DWORD [4088]
   153 0000014B E8 [00000000]                   	CALL	_putfonts8_asc
   154 00000150 83 C4 20                        	ADD	ESP,32
   155 00000153 6A 01                           	PUSH	1
   156 00000155 6A 01                           	PUSH	1
   157 00000157 53                              	PUSH	EBX
   158 00000158 E8 [00000000]                   	CALL	_task_run
   159 0000015D 83 C4 0C                        	ADD	ESP,12
   160 00000160 83 45 DC 0C                     	ADD	DWORD [-36+EBP],12
   161 00000164 FF 4D E0                        	DEC	DWORD [-32+EBP]
   162 00000167 0F 89 FFFFFF04                  	JNS	L15
   163 0000016D 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   164 00000170 B8 00000001                     	MOV	EAX,1
   165 00000175 5B                              	POP	EBX
   166 00000176 5E                              	POP	ESI
   167 00000177 5F                              	POP	EDI
   168 00000178 5D                              	POP	EBP
   169 00000179 C3                              	RET
   170 0000017A                                 	GLOBAL	_GetMyObj
   171 0000017A                                 _GetMyObj:
   172 0000017A 55                              	PUSH	EBP
   173 0000017B 89 E5                           	MOV	EBP,ESP
   174 0000017D 57                              	PUSH	EDI
   175 0000017E 56                              	PUSH	ESI
   176 0000017F 31 F6                           	XOR	ESI,ESI
   177 00000181 53                              	PUSH	EBX
   178 00000182 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   179 00000185 31 DB                           	XOR	EBX,EBX
   180 00000187                                 L24:
   181 00000187 57                              	PUSH	EDI
   182 00000188 FF B3 [0000000C]                	PUSH	DWORD [_dDevs+EBX]
   183 0000018E E8 [00000000]                   	CALL	_strcmp
   184 00000193 59                              	POP	ECX
   185 00000194 5A                              	POP	EDX
   186 00000195 85 C0                           	TEST	EAX,EAX
   187 00000197 74 13                           	JE	L27
   188 00000199 46                              	INC	ESI
   189 0000019A 83 C3 0C                        	ADD	EBX,12
   190 0000019D 83 FE 01                        	CMP	ESI,1
   191 000001A0 7E E5                           	JLE	L24
   192 000001A2 31 C0                           	XOR	EAX,EAX
   193 000001A4                                 L18:
   194 000001A4 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   195 000001A7 5B                              	POP	EBX
   196 000001A8 5E                              	POP	ESI
   197 000001A9 5F                              	POP	EDI
   198 000001AA 5D                              	POP	EBP
   199 000001AB C3                              	RET
   200 000001AC                                 L27:
   201 000001AC 8B 83 [00000014]                	MOV	EAX,DWORD [_dDevs+8+EBX]
   202 000001B2 EB F0                           	JMP	L18
   203 000001B4                                 	GLOBAL	_opensys
   204 000001B4                                 _opensys:
   205 000001B4 55                              	PUSH	EBP
   206 000001B5 89 E5                           	MOV	EBP,ESP
   207 000001B7 57                              	PUSH	EDI
   208 000001B8 56                              	PUSH	ESI
   209 000001B9 53                              	PUSH	EBX
   210 000001BA 83 EC 18                        	SUB	ESP,24
   211 000001BD 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   212 000001C0 8B 5D 0C                        	MOV	EBX,DWORD [12+EBP]
   213 000001C3 4B                              	DEC	EBX
   214 000001C4 E8 [00000000]                   	CALL	_task_now
   215 000001C9 8B 4F 50                        	MOV	ECX,DWORD [80+EDI]
   216 000001CC 8B 57 40                        	MOV	EDX,DWORD [64+EDI]
   217 000001CF 89 45 F0                        	MOV	DWORD [-16+EBP],EAX
   218 000001D2 8B 37                           	MOV	ESI,DWORD [EDI]
   219 000001D4 8B 47 30                        	MOV	EAX,DWORD [48+EDI]
   220 000001D7 89 4D E4                        	MOV	DWORD [-28+EBP],ECX
   221 000001DA 89 55 E8                        	MOV	DWORD [-24+EBP],EDX
   222 000001DD 89 45 EC                        	MOV	DWORD [-20+EBP],EAX
   223 000001E0 56                              	PUSH	ESI
   224 000001E1 4E                              	DEC	ESI
   225 000001E2 68 003C0000                     	PUSH	3932160
   226 000001E7 E8 [00000000]                   	CALL	_memman_alloc_4k
   227 000001EC 8B 55 F0                        	MOV	EDX,DWORD [-16+EBP]
   228 000001EF 89 45 E0                        	MOV	DWORD [-32+EBP],EAX
   229 000001F2 89 82 00000114                  	MOV	DWORD [276+EDX],EAX
   230 000001F8 68 000040BA                     	PUSH	16570
   231 000001FD 57                              	PUSH	EDI
   232 000001FE 53                              	PUSH	EBX
   233 000001FF BB 00000008                     	MOV	EBX,8
   234 00000204 8B 02                           	MOV	EAX,DWORD [EDX]
   235 00000206 99                              	CDQ
   236 00000207 F7 FB                           	IDIV	EBX
   237 00000209 8D 04 C5 00273E80               	LEA	EAX,DWORD [2571904+EAX*8]
   238 00000210 50                              	PUSH	EAX
   239 00000211 E8 [00000000]                   	CALL	_set_segmdesc
   240 00000216 68 000040B2                     	PUSH	16562
   241 0000021B FF 75 E0                        	PUSH	DWORD [-32+EBP]
   242 0000021E 56                              	PUSH	ESI
   243 0000021F 8B 4D F0                        	MOV	ECX,DWORD [-16+EBP]
   244 00000222 8B 01                           	MOV	EAX,DWORD [ECX]
   245 00000224 99                              	CDQ
   246 00000225 F7 FB                           	IDIV	EBX
   247 00000227 8D 04 C5 00275DC0               	LEA	EAX,DWORD [2579904+EAX*8]
   248 0000022E 50                              	PUSH	EAX
   249 0000022F E8 [00000000]                   	CALL	_set_segmdesc
   250 00000234 83 C4 28                        	ADD	ESP,40
   251 00000237 83 7D E8 00                     	CMP	DWORD [-24+EBP],0
   252 0000023B 7E 1A                           	JLE	L35
   253 0000023D 8B 5D EC                        	MOV	EBX,DWORD [-20+EBP]
   254 00000240 8B 45 E4                        	MOV	EAX,DWORD [-28+EBP]
   255 00000243 03 5D E0                        	ADD	EBX,DWORD [-32+EBP]
   256 00000246 8B 55 E8                        	MOV	EDX,DWORD [-24+EBP]
   257 00000249 8D 0C 87                        	LEA	ECX,DWORD [EDI+EAX*4]
   258 0000024C                                 L33:
   259 0000024C 8A 01                           	MOV	AL,BYTE [ECX]
   260 0000024E 83 C1 04                        	ADD	ECX,4
   261 00000251 88 03                           	MOV	BYTE [EBX],AL
   262 00000253 43                              	INC	EBX
   263 00000254 4A                              	DEC	EDX
   264 00000255 75 F5                           	JNE	L33
   265 00000257                                 L35:
   266 00000257 68 [00000044]                   	PUSH	LC4
   267 0000025C BB 00000008                     	MOV	EBX,8
   268 00000261 6A 07                           	PUSH	7
   269 00000263 6A 00                           	PUSH	0
   270 00000265 6A 00                           	PUSH	0
   271 00000267 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   272 0000026E 50                              	PUSH	EAX
   273 0000026F FF 35 00000FF8                  	PUSH	DWORD [4088]
   274 00000275 E8 [00000000]                   	CALL	_putfonts8_asc
   275 0000027A 8B 45 F0                        	MOV	EAX,DWORD [-16+EBP]
   276 0000027D 83 C0 30                        	ADD	EAX,48
   277 00000280 50                              	PUSH	EAX
   278 00000281 8B 55 F0                        	MOV	EDX,DWORD [-16+EBP]
   279 00000284 8B 02                           	MOV	EAX,DWORD [EDX]
   280 00000286 99                              	CDQ
   281 00000287 F7 FB                           	IDIV	EBX
   282 00000289 8D 04 C5 00005DC0               	LEA	EAX,DWORD [24000+EAX*8]
   283 00000290 50                              	PUSH	EAX
   284 00000291 FF 75 EC                        	PUSH	DWORD [-20+EBP]
   285 00000294 8B 4D F0                        	MOV	ECX,DWORD [-16+EBP]
   286 00000297 8B 01                           	MOV	EAX,DWORD [ECX]
   287 00000299 99                              	CDQ
   288 0000029A F7 FB                           	IDIV	EBX
   289 0000029C 8D 04 C5 00003E80               	LEA	EAX,DWORD [16000+EAX*8]
   290 000002A3 50                              	PUSH	EAX
   291 000002A4 6A 1B                           	PUSH	27
   292 000002A6 E8 [00000000]                   	CALL	_start_sys
   293 000002AB 83 C4 2C                        	ADD	ESP,44
   294 000002AE E8 [00000000]                   	CALL	_task_now
   295 000002B3 89 45 08                        	MOV	DWORD [8+EBP],EAX
   296 000002B6 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   297 000002B9 5B                              	POP	EBX
   298 000002BA 5E                              	POP	ESI
   299 000002BB 5F                              	POP	EDI
   300 000002BC 5D                              	POP	EBP
   301 000002BD E9 [00000000]                   	JMP	_task_sleep
