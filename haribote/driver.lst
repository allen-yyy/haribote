     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_HDEntry
     7 00000000                                 	EXTERN	_FSEntry
     8 00000000                                 	EXTERN	_io_cli
     9 00000000                                 	EXTERN	_io_sti
    10 00000000                                 	EXTERN	_file_search
    11 00000000                                 	EXTERN	_memman_alloc_4k
    12 00000000                                 	EXTERN	_file_loadfile
    13 00000000                                 	EXTERN	_task_alloc
    14 00000000                                 	EXTERN	_task_run
    15 00000000                                 	EXTERN	_task_now
    16 00000000                                 	EXTERN	_set_segmdesc
    17 00000000                                 	EXTERN	_start_sys
    18 00000000                                 	EXTERN	_task_sleep
    19 00000000                                 [FILE "driver.c"]
    20 00000000                                 	GLOBAL	_dDevs
    21                                          [SECTION .data]
    22 00000000                                 LC0:
    23 00000000 49 64 65 20 48 44 00            	DB	"Ide HD",0x00
    24 00000007                                 LC1:
    25 00000007 46 53 00                        	DB	"FS",0x00
    26 0000000A 00 00                           	ALIGNB	4
    27 0000000C                                 _dDevs:
    28 0000000C [00000000]                      	DD	LC0
    29 00000010 [00000000]                      	DD	_HDEntry
    30 00000014 00 00 00 00                     	RESB	4
    31 00000018 [00000007]                      	DD	LC1
    32 0000001C [00000000]                      	DD	_FSEntry
    33 00000020 00 00 00 00                     	RESB	4
    34 00000024                                 	GLOBAL	_etable
    35 00000024                                 LC2:
    36 00000024 74 65 73 74 00                  	DB	"test",0x00
    37 00000029                                 LC3:
    38 00000029 73 79 73 74 65 73 74 2E 73 79   	DB	"systest.sys",0x00
       00000033 73 00 
    39 00000035 00 00 00                        	ALIGNB	4
    40 00000038                                 _etable:
    41 00000038 [00000024]                      	DD	LC2
    42 0000003C [00000029]                      	DD	LC3
    43 00000040 00 00 00 00                     	RESB	4
    44                                          [SECTION .text]
    45 00000000                                 	GLOBAL	_LDevs
    46 00000000                                 _LDevs:
    47 00000000 55                              	PUSH	EBP
    48 00000001 89 E5                           	MOV	EBP,ESP
    49 00000003 57                              	PUSH	EDI
    50 00000004 56                              	PUSH	ESI
    51 00000005 31 FF                           	XOR	EDI,EDI
    52 00000007 53                              	PUSH	EBX
    53 00000008 31 F6                           	XOR	ESI,ESI
    54 0000000A 83 EC 10                        	SUB	ESP,16
    55 0000000D E8 [00000000]                   	CALL	_io_cli
    56 00000012                                 L7:
    57 00000012 8B 86 [0000000C]                	MOV	EAX,DWORD [_dDevs+ESI]
    58 00000018 8D 5D E4                        	LEA	EBX,DWORD [-28+EBP]
    59 0000001B 89 45 E4                        	MOV	DWORD [-28+EBP],EAX
    60 0000001E 89 9E [00000014]                	MOV	DWORD [_dDevs+8+ESI],EBX
    61 00000024 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    62 00000027 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
    63 0000002A E8 [00000000]                   	CALL	_io_sti
    64 0000002F 53                              	PUSH	EBX
    65 00000030 FF 96 [00000010]                	CALL	DWORD [_dDevs+4+ESI]
    66 00000036 5A                              	POP	EDX
    67 00000037 31 D2                           	XOR	EDX,EDX
    68 00000039 85 C0                           	TEST	EAX,EAX
    69 0000003B 74 13                           	JE	L1
    70 0000003D 47                              	INC	EDI
    71 0000003E 83 C6 0C                        	ADD	ESI,12
    72 00000041 83 FF 01                        	CMP	EDI,1
    73 00000044 7E CC                           	JLE	L7
    74 00000046 E8 [00000000]                   	CALL	_io_sti
    75 0000004B BA 00000001                     	MOV	EDX,1
    76 00000050                                 L1:
    77 00000050 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
    78 00000053 89 D0                           	MOV	EAX,EDX
    79 00000055 5B                              	POP	EBX
    80 00000056 5E                              	POP	ESI
    81 00000057 5F                              	POP	EDI
    82 00000058 5D                              	POP	EBP
    83 00000059 C3                              	RET
    84 0000005A                                 	GLOBAL	_load_external_device
    85 0000005A                                 _load_external_device:
    86 0000005A 55                              	PUSH	EBP
    87 0000005B 89 E5                           	MOV	EBP,ESP
    88 0000005D 57                              	PUSH	EDI
    89 0000005E 56                              	PUSH	ESI
    90 0000005F 53                              	PUSH	EBX
    91 00000060 83 EC 18                        	SUB	ESP,24
    92 00000063 C7 45 DC 00000000               	MOV	DWORD [-36+EBP],0
    93 0000006A C7 45 E0 00000000               	MOV	DWORD [-32+EBP],0
    94 00000071                                 L15:
    95 00000071 8B 55 DC                        	MOV	EDX,DWORD [-36+EBP]
    96 00000074 68 000000E0                     	PUSH	224
    97 00000079 68 00102600                     	PUSH	1058304
    98 0000007E 8B 82 [00000038]                	MOV	EAX,DWORD [_etable+EDX]
    99 00000084 89 45 E4                        	MOV	DWORD [-28+EBP],EAX
   100 00000087 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   101 0000008A FF B2 [0000003C]                	PUSH	DWORD [_etable+4+EDX]
   102 00000090 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
   103 00000093 8D 45 E4                        	LEA	EAX,DWORD [-28+EBP]
   104 00000096 89 82 [00000040]                	MOV	DWORD [_etable+8+EDX],EAX
   105 0000009C E8 [00000000]                   	CALL	_file_search
   106 000000A1 89 C6                           	MOV	ESI,EAX
   107 000000A3 FF 70 1C                        	PUSH	DWORD [28+EAX]
   108 000000A6 FF 75 0C                        	PUSH	DWORD [12+EBP]
   109 000000A9 E8 [00000000]                   	CALL	_memman_alloc_4k
   110 000000AE 68 00103E00                     	PUSH	1064448
   111 000000B3 FF 75 08                        	PUSH	DWORD [8+EBP]
   112 000000B6 50                              	PUSH	EAX
   113 000000B7 89 C7                           	MOV	EDI,EAX
   114 000000B9 FF 76 1C                        	PUSH	DWORD [28+ESI]
   115 000000BC 0F B7 46 1A                     	MOVZX	EAX,WORD [26+ESI]
   116 000000C0 50                              	PUSH	EAX
   117 000000C1 E8 [00000000]                   	CALL	_file_loadfile
   118 000000C6 83 C4 28                        	ADD	ESP,40
   119 000000C9 E8 [00000000]                   	CALL	_task_alloc
   120 000000CE 68 00010000                     	PUSH	65536
   121 000000D3 89 C3                           	MOV	EBX,EAX
   122 000000D5 FF 75 0C                        	PUSH	DWORD [12+EBP]
   123 000000D8 E8 [00000000]                   	CALL	_memman_alloc_4k
   124 000000DD 05 0000FFF4                     	ADD	EAX,65524
   125 000000E2 89 43 64                        	MOV	DWORD [100+EBX],EAX
   126 000000E5 C7 43 4C [00000152]             	MOV	DWORD [76+EBX],_opensys
   127 000000EC C7 43 74 00000008               	MOV	DWORD [116+EBX],8
   128 000000F3 C7 43 78 00000010               	MOV	DWORD [120+EBX],16
   129 000000FA C7 43 7C 00000008               	MOV	DWORD [124+EBX],8
   130 00000101 C7 83 00000080 00000008         	MOV	DWORD [128+EBX],8
   131 0000010B C7 83 00000084 00000008         	MOV	DWORD [132+EBX],8
   132 00000115 C7 83 00000088 00000008         	MOV	DWORD [136+EBX],8
   133 0000011F 89 78 04                        	MOV	DWORD [4+EAX],EDI
   134 00000122 8B 53 64                        	MOV	EDX,DWORD [100+EBX]
   135 00000125 8B 46 1C                        	MOV	EAX,DWORD [28+ESI]
   136 00000128 89 42 08                        	MOV	DWORD [8+EDX],EAX
   137 0000012B 6A 01                           	PUSH	1
   138 0000012D 6A 02                           	PUSH	2
   139 0000012F 53                              	PUSH	EBX
   140 00000130 E8 [00000000]                   	CALL	_task_run
   141 00000135 83 C4 14                        	ADD	ESP,20
   142 00000138 83 45 DC 0C                     	ADD	DWORD [-36+EBP],12
   143 0000013C FF 4D E0                        	DEC	DWORD [-32+EBP]
   144 0000013F 0F 89 FFFFFF2C                  	JNS	L15
   145 00000145 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   146 00000148 B8 00000001                     	MOV	EAX,1
   147 0000014D 5B                              	POP	EBX
   148 0000014E 5E                              	POP	ESI
   149 0000014F 5F                              	POP	EDI
   150 00000150 5D                              	POP	EBP
   151 00000151 C3                              	RET
   152 00000152                                 	GLOBAL	_opensys
   153 00000152                                 _opensys:
   154 00000152 55                              	PUSH	EBP
   155 00000153 89 E5                           	MOV	EBP,ESP
   156 00000155 57                              	PUSH	EDI
   157 00000156 56                              	PUSH	ESI
   158 00000157 53                              	PUSH	EBX
   159 00000158 83 EC 18                        	SUB	ESP,24
   160 0000015B 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   161 0000015E 8B 5D 0C                        	MOV	EBX,DWORD [12+EBP]
   162 00000161 4B                              	DEC	EBX
   163 00000162 E8 [00000000]                   	CALL	_task_now
   164 00000167 8B 4F 50                        	MOV	ECX,DWORD [80+EDI]
   165 0000016A 8B 57 40                        	MOV	EDX,DWORD [64+EDI]
   166 0000016D 89 45 F0                        	MOV	DWORD [-16+EBP],EAX
   167 00000170 8B 37                           	MOV	ESI,DWORD [EDI]
   168 00000172 8B 47 30                        	MOV	EAX,DWORD [48+EDI]
   169 00000175 89 4D E4                        	MOV	DWORD [-28+EBP],ECX
   170 00000178 89 55 E8                        	MOV	DWORD [-24+EBP],EDX
   171 0000017B 89 45 EC                        	MOV	DWORD [-20+EBP],EAX
   172 0000017E 56                              	PUSH	ESI
   173 0000017F 4E                              	DEC	ESI
   174 00000180 68 003C0000                     	PUSH	3932160
   175 00000185 E8 [00000000]                   	CALL	_memman_alloc_4k
   176 0000018A 8B 55 F0                        	MOV	EDX,DWORD [-16+EBP]
   177 0000018D 89 45 E0                        	MOV	DWORD [-32+EBP],EAX
   178 00000190 89 82 00000114                  	MOV	DWORD [276+EDX],EAX
   179 00000196 68 000040BA                     	PUSH	16570
   180 0000019B 57                              	PUSH	EDI
   181 0000019C 53                              	PUSH	EBX
   182 0000019D BB 00000008                     	MOV	EBX,8
   183 000001A2 8B 02                           	MOV	EAX,DWORD [EDX]
   184 000001A4 99                              	CDQ
   185 000001A5 F7 FB                           	IDIV	EBX
   186 000001A7 8D 04 C5 00273E80               	LEA	EAX,DWORD [2571904+EAX*8]
   187 000001AE 50                              	PUSH	EAX
   188 000001AF E8 [00000000]                   	CALL	_set_segmdesc
   189 000001B4 68 000040B2                     	PUSH	16562
   190 000001B9 FF 75 E0                        	PUSH	DWORD [-32+EBP]
   191 000001BC 56                              	PUSH	ESI
   192 000001BD 8B 4D F0                        	MOV	ECX,DWORD [-16+EBP]
   193 000001C0 8B 01                           	MOV	EAX,DWORD [ECX]
   194 000001C2 99                              	CDQ
   195 000001C3 F7 FB                           	IDIV	EBX
   196 000001C5 8D 04 C5 00275DC0               	LEA	EAX,DWORD [2579904+EAX*8]
   197 000001CC 50                              	PUSH	EAX
   198 000001CD E8 [00000000]                   	CALL	_set_segmdesc
   199 000001D2 83 C4 28                        	ADD	ESP,40
   200 000001D5 83 7D E8 00                     	CMP	DWORD [-24+EBP],0
   201 000001D9 7E 1A                           	JLE	L25
   202 000001DB 8B 5D EC                        	MOV	EBX,DWORD [-20+EBP]
   203 000001DE 8B 45 E4                        	MOV	EAX,DWORD [-28+EBP]
   204 000001E1 03 5D E0                        	ADD	EBX,DWORD [-32+EBP]
   205 000001E4 8B 55 E8                        	MOV	EDX,DWORD [-24+EBP]
   206 000001E7 8D 0C 87                        	LEA	ECX,DWORD [EDI+EAX*4]
   207 000001EA                                 L23:
   208 000001EA 8A 01                           	MOV	AL,BYTE [ECX]
   209 000001EC 83 C1 04                        	ADD	ECX,4
   210 000001EF 88 03                           	MOV	BYTE [EBX],AL
   211 000001F1 43                              	INC	EBX
   212 000001F2 4A                              	DEC	EDX
   213 000001F3 75 F5                           	JNE	L23
   214 000001F5                                 L25:
   215 000001F5 8B 45 F0                        	MOV	EAX,DWORD [-16+EBP]
   216 000001F8 BB 00000008                     	MOV	EBX,8
   217 000001FD 83 C0 30                        	ADD	EAX,48
   218 00000200 50                              	PUSH	EAX
   219 00000201 8B 55 F0                        	MOV	EDX,DWORD [-16+EBP]
   220 00000204 8B 02                           	MOV	EAX,DWORD [EDX]
   221 00000206 99                              	CDQ
   222 00000207 F7 FB                           	IDIV	EBX
   223 00000209 8D 04 C5 00005DC0               	LEA	EAX,DWORD [24000+EAX*8]
   224 00000210 50                              	PUSH	EAX
   225 00000211 FF 75 EC                        	PUSH	DWORD [-20+EBP]
   226 00000214 8B 4D F0                        	MOV	ECX,DWORD [-16+EBP]
   227 00000217 8B 01                           	MOV	EAX,DWORD [ECX]
   228 00000219 99                              	CDQ
   229 0000021A F7 FB                           	IDIV	EBX
   230 0000021C 8D 04 C5 00003E80               	LEA	EAX,DWORD [16000+EAX*8]
   231 00000223 50                              	PUSH	EAX
   232 00000224 6A 1B                           	PUSH	27
   233 00000226 E8 [00000000]                   	CALL	_start_sys
   234 0000022B 83 C4 14                        	ADD	ESP,20
   235 0000022E E8 [00000000]                   	CALL	_task_now
   236 00000233 89 45 08                        	MOV	DWORD [8+EBP],EAX
   237 00000236 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   238 00000239 5B                              	POP	EBX
   239 0000023A 5E                              	POP	ESI
   240 0000023B 5F                              	POP	EDI
   241 0000023C 5D                              	POP	EBP
   242 0000023D E9 [00000000]                   	JMP	_task_sleep
   243 00000242                                 	GLOBAL	_devcalls
   244                                          [SECTION .data]
   245 00000044 00 00 00 00 00 00 00 00 00 00   	ALIGNB	16
       0000004E 00 00 
   246 00000050                                 _devcalls:
   247 00000050 00 00 00 00 00 00 00 00 00 00   	RESB	40
       0000005A 00 00 00 00 00 00 00 00 00 00 
       00000064 00 00 00 00 00 00 00 00 00 00 
       0000006E 00 00 00 00 00 00 00 00 00 00 
