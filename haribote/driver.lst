     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_HDEntry
     7 00000000                                 	EXTERN	_FSEntry
     8 00000000                                 	EXTERN	_io_cli
     9 00000000                                 	EXTERN	_io_sti
    10 00000000                                 	EXTERN	_file_search
    11 00000000                                 	EXTERN	_memman_alloc_4k
    12 00000000                                 	EXTERN	_file_loadfile
    13 00000000                                 	EXTERN	_task_alloc
    14 00000000                                 	EXTERN	_set_segmdesc
    15 00000000                                 	EXTERN	_task_run
    16 00000000                                 	EXTERN	_strcmp
    17 00000000                                 [FILE "driver.c"]
    18 00000000                                 	GLOBAL	_dDevs
    19                                          [SECTION .data]
    20 00000000                                 LC0:
    21 00000000 49 64 65 20 48 44 00            	DB	"Ide HD",0x00
    22 00000007                                 LC1:
    23 00000007 46 53 00                        	DB	"FS",0x00
    24 0000000A 00 00                           	ALIGNB	4
    25 0000000C                                 _dDevs:
    26 0000000C [00000000]                      	DD	LC0
    27 00000010 [00000000]                      	DD	_HDEntry
    28 00000014 00 00 00 00                     	RESB	4
    29 00000018 [00000007]                      	DD	LC1
    30 0000001C [00000000]                      	DD	_FSEntry
    31 00000020 00 00 00 00                     	RESB	4
    32 00000024                                 	GLOBAL	_etable
    33 00000024                                 LC2:
    34 00000024 74 65 73 74 00                  	DB	"test",0x00
    35 00000029                                 LC3:
    36 00000029 73 79 73 74 65 73 74 2E 73 79   	DB	"systest.sys",0x00
       00000033 73 00 
    37 00000035 00 00 00                        	ALIGNB	4
    38 00000038                                 _etable:
    39 00000038 [00000024]                      	DD	LC2
    40 0000003C [00000029]                      	DD	LC3
    41 00000040 00 00 00 00                     	RESB	4
    42                                          [SECTION .text]
    43 00000000                                 	GLOBAL	_LDevs
    44 00000000                                 _LDevs:
    45 00000000 55                              	PUSH	EBP
    46 00000001 89 E5                           	MOV	EBP,ESP
    47 00000003 57                              	PUSH	EDI
    48 00000004 56                              	PUSH	ESI
    49 00000005 31 FF                           	XOR	EDI,EDI
    50 00000007 53                              	PUSH	EBX
    51 00000008 31 F6                           	XOR	ESI,ESI
    52 0000000A 83 EC 10                        	SUB	ESP,16
    53 0000000D E8 [00000000]                   	CALL	_io_cli
    54 00000012                                 L7:
    55 00000012 8B 86 [0000000C]                	MOV	EAX,DWORD [_dDevs+ESI]
    56 00000018 8D 5D E4                        	LEA	EBX,DWORD [-28+EBP]
    57 0000001B 89 45 E4                        	MOV	DWORD [-28+EBP],EAX
    58 0000001E 89 9E [00000014]                	MOV	DWORD [_dDevs+8+ESI],EBX
    59 00000024 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    60 00000027 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
    61 0000002A E8 [00000000]                   	CALL	_io_sti
    62 0000002F 53                              	PUSH	EBX
    63 00000030 FF 96 [00000010]                	CALL	DWORD [_dDevs+4+ESI]
    64 00000036 5A                              	POP	EDX
    65 00000037 31 D2                           	XOR	EDX,EDX
    66 00000039 85 C0                           	TEST	EAX,EAX
    67 0000003B 74 13                           	JE	L1
    68 0000003D 47                              	INC	EDI
    69 0000003E 83 C6 0C                        	ADD	ESI,12
    70 00000041 83 FF 01                        	CMP	EDI,1
    71 00000044 7E CC                           	JLE	L7
    72 00000046 E8 [00000000]                   	CALL	_io_sti
    73 0000004B BA 00000001                     	MOV	EDX,1
    74 00000050                                 L1:
    75 00000050 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
    76 00000053 89 D0                           	MOV	EAX,EDX
    77 00000055 5B                              	POP	EBX
    78 00000056 5E                              	POP	ESI
    79 00000057 5F                              	POP	EDI
    80 00000058 5D                              	POP	EBP
    81 00000059 C3                              	RET
    82 0000005A                                 	GLOBAL	_load_external_device
    83 0000005A                                 _load_external_device:
    84 0000005A 55                              	PUSH	EBP
    85 0000005B 89 E5                           	MOV	EBP,ESP
    86 0000005D 57                              	PUSH	EDI
    87 0000005E 56                              	PUSH	ESI
    88 0000005F 53                              	PUSH	EBX
    89 00000060 31 DB                           	XOR	EBX,EBX
    90 00000062 83 EC 24                        	SUB	ESP,36
    91 00000065                                 L20:
    92 00000065 6B CB 0C                        	IMUL	ECX,EBX,12
    93 00000068 8B 81 [00000038]                	MOV	EAX,DWORD [_etable+ECX]
    94 0000006E 8B 10                           	MOV	EDX,DWORD [EAX]
    95 00000070 8B 45 E4                        	MOV	EAX,DWORD [-28+EBP]
    96 00000073 89 10                           	MOV	DWORD [EAX],EDX
    97 00000075 68 000000E0                     	PUSH	224
    98 0000007A 68 00102600                     	PUSH	1058304
    99 0000007F 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   100 00000082 FF B1 [0000003C]                	PUSH	DWORD [_etable+4+ECX]
   101 00000088 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
   102 0000008B 8D 45 E4                        	LEA	EAX,DWORD [-28+EBP]
   103 0000008E 89 81 [00000040]                	MOV	DWORD [_etable+8+ECX],EAX
   104 00000094 E8 [00000000]                   	CALL	_file_search
   105 00000099 89 C3                           	MOV	EBX,EAX
   106 0000009B FF 70 1C                        	PUSH	DWORD [28+EAX]
   107 0000009E FF 75 0C                        	PUSH	DWORD [12+EBP]
   108 000000A1 E8 [00000000]                   	CALL	_memman_alloc_4k
   109 000000A6 68 00103E00                     	PUSH	1064448
   110 000000AB FF 75 08                        	PUSH	DWORD [8+EBP]
   111 000000AE 50                              	PUSH	EAX
   112 000000AF 89 C7                           	MOV	EDI,EAX
   113 000000B1 FF 73 1C                        	PUSH	DWORD [28+EBX]
   114 000000B4 0F B7 43 1A                     	MOVZX	EAX,WORD [26+EBX]
   115 000000B8 50                              	PUSH	EAX
   116 000000B9 E8 [00000000]                   	CALL	_file_loadfile
   117 000000BE 83 C4 28                        	ADD	ESP,40
   118 000000C1 E8 [00000000]                   	CALL	_task_alloc
   119 000000C6 8B 4F 30                        	MOV	ECX,DWORD [48+EDI]
   120 000000C9 8B 17                           	MOV	EDX,DWORD [EDI]
   121 000000CB 89 C6                           	MOV	ESI,EAX
   122 000000CD 89 55 E0                        	MOV	DWORD [-32+EBP],EDX
   123 000000D0 8B 47 40                        	MOV	EAX,DWORD [64+EDI]
   124 000000D3 8B 57 50                        	MOV	EDX,DWORD [80+EDI]
   125 000000D6 89 4D DC                        	MOV	DWORD [-36+EBP],ECX
   126 000000D9 FF 75 E0                        	PUSH	DWORD [-32+EBP]
   127 000000DC FF 75 0C                        	PUSH	DWORD [12+EBP]
   128 000000DF 89 55 D4                        	MOV	DWORD [-44+EBP],EDX
   129 000000E2 89 45 D8                        	MOV	DWORD [-40+EBP],EAX
   130 000000E5 E8 [00000000]                   	CALL	_memman_alloc_4k
   131 000000EA 89 86 00000114                  	MOV	DWORD [276+ESI],EAX
   132 000000F0 89 45 D0                        	MOV	DWORD [-48+EBP],EAX
   133 000000F3 68 0000409A                     	PUSH	16538
   134 000000F8 57                              	PUSH	EDI
   135 000000F9 8B 43 1C                        	MOV	EAX,DWORD [28+EBX]
   136 000000FC BB 00000008                     	MOV	EBX,8
   137 00000101 48                              	DEC	EAX
   138 00000102 50                              	PUSH	EAX
   139 00000103 8B 06                           	MOV	EAX,DWORD [ESI]
   140 00000105 99                              	CDQ
   141 00000106 F7 FB                           	IDIV	EBX
   142 00000108 8D 04 C5 00273E80               	LEA	EAX,DWORD [2571904+EAX*8]
   143 0000010F 50                              	PUSH	EAX
   144 00000110 E8 [00000000]                   	CALL	_set_segmdesc
   145 00000115 8B 45 E0                        	MOV	EAX,DWORD [-32+EBP]
   146 00000118 68 000040B2                     	PUSH	16562
   147 0000011D 48                              	DEC	EAX
   148 0000011E FF 75 D0                        	PUSH	DWORD [-48+EBP]
   149 00000121 50                              	PUSH	EAX
   150 00000122 8B 06                           	MOV	EAX,DWORD [ESI]
   151 00000124 99                              	CDQ
   152 00000125 F7 FB                           	IDIV	EBX
   153 00000127 31 DB                           	XOR	EBX,EBX
   154 00000129 8D 04 C5 00275DC0               	LEA	EAX,DWORD [2579904+EAX*8]
   155 00000130 50                              	PUSH	EAX
   156 00000131 E8 [00000000]                   	CALL	_set_segmdesc
   157 00000136 83 C4 28                        	ADD	ESP,40
   158 00000139 3B 5D D8                        	CMP	EBX,DWORD [-40+EBP]
   159 0000013C 7D 1D                           	JGE	L24
   160 0000013E 8B 4D DC                        	MOV	ECX,DWORD [-36+EBP]
   161 00000141 8B 45 D4                        	MOV	EAX,DWORD [-44+EBP]
   162 00000144 03 4D D0                        	ADD	ECX,DWORD [-48+EBP]
   163 00000147 8B 5D D8                        	MOV	EBX,DWORD [-40+EBP]
   164 0000014A 8D 14 87                        	LEA	EDX,DWORD [EDI+EAX*4]
   165 0000014D                                 L19:
   166 0000014D 8A 02                           	MOV	AL,BYTE [EDX]
   167 0000014F 83 C2 04                        	ADD	EDX,4
   168 00000152 88 01                           	MOV	BYTE [ECX],AL
   169 00000154 41                              	INC	ECX
   170 00000155 4B                              	DEC	EBX
   171 00000156 75 F5                           	JNE	L19
   172 00000158 8B 5D D8                        	MOV	EBX,DWORD [-40+EBP]
   173 0000015B                                 L24:
   174 0000015B 8B 55 D0                        	MOV	EDX,DWORD [-48+EBP]
   175 0000015E 8B 4D E0                        	MOV	ECX,DWORD [-32+EBP]
   176 00000161 C7 46 4C 0000001B               	MOV	DWORD [76+ESI],27
   177 00000168 8D 44 11 FF                     	LEA	EAX,DWORD [-1+ECX+EDX*1]
   178 0000016C 43                              	INC	EBX
   179 0000016D 89 46 64                        	MOV	DWORD [100+ESI],EAX
   180 00000170 8B 06                           	MOV	EAX,DWORD [ESI]
   181 00000172 05 00003E80                     	ADD	EAX,16000
   182 00000177 C7 46 74 00000008               	MOV	DWORD [116+ESI],8
   183 0000017E 89 46 78                        	MOV	DWORD [120+ESI],EAX
   184 00000181 C7 46 7C 00000008               	MOV	DWORD [124+ESI],8
   185 00000188 C7 86 00000080 00000008         	MOV	DWORD [128+ESI],8
   186 00000192 C7 86 00000084 00000008         	MOV	DWORD [132+ESI],8
   187 0000019C C7 86 00000088 00000008         	MOV	DWORD [136+ESI],8
   188 000001A6 C7 86 00000144 00000001         	MOV	DWORD [324+ESI],1
   189 000001B0 6A 02                           	PUSH	2
   190 000001B2 6A 02                           	PUSH	2
   191 000001B4 56                              	PUSH	ESI
   192 000001B5 E8 [00000000]                   	CALL	_task_run
   193 000001BA 83 C4 0C                        	ADD	ESP,12
   194 000001BD 85 DB                           	TEST	EBX,EBX
   195 000001BF 0F 8E FFFFFEA0                  	JLE	L20
   196 000001C5 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   197 000001C8 B8 00000001                     	MOV	EAX,1
   198 000001CD 5B                              	POP	EBX
   199 000001CE 5E                              	POP	ESI
   200 000001CF 5F                              	POP	EDI
   201 000001D0 5D                              	POP	EBP
   202 000001D1 C3                              	RET
   203 000001D2                                 	GLOBAL	_GetMyObj
   204 000001D2                                 _GetMyObj:
   205 000001D2 55                              	PUSH	EBP
   206 000001D3 89 E5                           	MOV	EBP,ESP
   207 000001D5 57                              	PUSH	EDI
   208 000001D6 56                              	PUSH	ESI
   209 000001D7 31 F6                           	XOR	ESI,ESI
   210 000001D9 53                              	PUSH	EBX
   211 000001DA 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   212 000001DD 31 DB                           	XOR	EBX,EBX
   213 000001DF                                 L31:
   214 000001DF 57                              	PUSH	EDI
   215 000001E0 FF B3 [0000000C]                	PUSH	DWORD [_dDevs+EBX]
   216 000001E6 E8 [00000000]                   	CALL	_strcmp
   217 000001EB 59                              	POP	ECX
   218 000001EC 5A                              	POP	EDX
   219 000001ED 85 C0                           	TEST	EAX,EAX
   220 000001EF 74 13                           	JE	L34
   221 000001F1 46                              	INC	ESI
   222 000001F2 83 C3 0C                        	ADD	EBX,12
   223 000001F5 83 FE 01                        	CMP	ESI,1
   224 000001F8 7E E5                           	JLE	L31
   225 000001FA 31 C0                           	XOR	EAX,EAX
   226 000001FC                                 L25:
   227 000001FC 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   228 000001FF 5B                              	POP	EBX
   229 00000200 5E                              	POP	ESI
   230 00000201 5F                              	POP	EDI
   231 00000202 5D                              	POP	EBP
   232 00000203 C3                              	RET
   233 00000204                                 L34:
   234 00000204 8B 83 [00000014]                	MOV	EAX,DWORD [_dDevs+8+EBX]
   235 0000020A EB F0                           	JMP	L25
