     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_memman_alloc
     7 00000000                                 	EXTERN	_message_receive
     8 00000000                                 	EXTERN	_FAT12_init
     9 00000000                                 	EXTERN	_io_cli
    10 00000000                                 	EXTERN	_io_hlt
    11 00000000                                 	EXTERN	_task_alloc
    12 00000000                                 	EXTERN	_memman_alloc_4k
    13 00000000                                 	EXTERN	_task_run
    14 00000000                                 	EXTERN	_devcalls
    15 00000000                                 	EXTERN	_message_send
    16 00000000                                 [FILE "fs.c"]
    17                                          [SECTION .text]
    18 00000000                                 	GLOBAL	_FS_task
    19 00000000                                 _FS_task:
    20 00000000 55                              	PUSH	EBP
    21 00000001 89 E5                           	MOV	EBP,ESP
    22 00000003 56                              	PUSH	ESI
    23 00000004 53                              	PUSH	EBX
    24 00000005 BE 00000001                     	MOV	ESI,1
    25 0000000A 83 EC 40                        	SUB	ESP,64
    26 0000000D 8D 5D D8                        	LEA	EBX,DWORD [-40+EBP]
    27 00000010 68 00000200                     	PUSH	512
    28 00000015 68 003C0000                     	PUSH	3932160
    29 0000001A E8 [00000000]                   	CALL	_memman_alloc
    30 0000001F 53                              	PUSH	EBX
    31 00000020 C7 45 D8 00000001               	MOV	DWORD [-40+EBP],1
    32 00000027 89 45 E0                        	MOV	DWORD [-32+EBP],EAX
    33 0000002A E8 0000010B                     	CALL	_fs_send2hd
    34 0000002F 53                              	PUSH	EBX
    35 00000030 68 00002710                     	PUSH	10000
    36 00000035 E8 [00000000]                   	CALL	_message_receive
    37 0000003A 31 D2                           	XOR	EDX,EDX
    38 0000003C 31 C9                           	XOR	ECX,ECX
    39 0000003E 83 C4 14                        	ADD	ESP,20
    40 00000041                                 L6:
    41 00000041 8D 41 41                        	LEA	EAX,DWORD [65+ECX]
    42 00000044 41                              	INC	ECX
    43 00000045 88 82 [00000020]                	MOV	BYTE [_partitions+EDX],AL
    44 0000004B C7 82 [00000024] 00000000       	MOV	DWORD [_partitions+4+EDX],0
    45 00000055 83 C2 20                        	ADD	EDX,32
    46 00000058 83 F9 19                        	CMP	ECX,25
    47 0000005B 7E E4                           	JLE	L6
    48 0000005D                                 L7:
    49 0000005D 8D 45 B8                        	LEA	EAX,DWORD [-72+EBP]
    50 00000060 50                              	PUSH	EAX
    51 00000061 68 00002710                     	PUSH	10000
    52 00000066 E8 [00000000]                   	CALL	_message_receive
    53 0000006B 58                              	POP	EAX
    54 0000006C 8B 45 B8                        	MOV	EAX,DWORD [-72+EBP]
    55 0000006F 5A                              	POP	EDX
    56 00000070 48                              	DEC	EAX
    57 00000071 83 F8 04                        	CMP	EAX,4
    58 00000074 77 E7                           	JA	L7
    59 00000076 FF 24 85 [00000000]             	JMP	DWORD [L22+EAX*4]
    60                                          [SECTION .data]
    61 00000000                                 	ALIGNB	4
    62 00000000                                 L22:
    63 00000000 [0000005D]                      	DD	L7
    64 00000004 [0000005D]                      	DD	L7
    65 00000008 [0000007D]                      	DD	L11
    66 0000000C [0000005D]                      	DD	L7
    67 00000010 [0000005D]                      	DD	L7
    68                                          [SECTION .text]
    69 0000007D                                 L11:
    70 0000007D 8B 5D C8                        	MOV	EBX,DWORD [-56+EBP]
    71 00000080 83 FE 01                        	CMP	ESI,1
    72 00000083 75 18                           	JNE	L25
    73 00000085 E8 [00000000]                   	CALL	_FAT12_init
    74 0000008A                                 L14:
    75 0000008A 0F BE 43 14                     	MOVSX	EAX,BYTE [20+EBX]
    76 0000008E C1 E0 05                        	SAL	EAX,5
    77 00000091 C7 80 [FFFFF804] 00000001       	MOV	DWORD [_partitions-2076+EAX],1
    78 0000009B EB C0                           	JMP	L7
    79 0000009D                                 L25:
    80 0000009D 83 FE 02                        	CMP	ESI,2
    81 000000A0 74 E8                           	JE	L14
    82 000000A2 E8 [00000000]                   	CALL	_io_cli
    83 000000A7 E8 [00000000]                   	CALL	_io_hlt
    84 000000AC EB AF                           	JMP	L7
    85 000000AE                                 	GLOBAL	_FSEntry
    86 000000AE                                 _FSEntry:
    87 000000AE 55                              	PUSH	EBP
    88 000000AF 89 E5                           	MOV	EBP,ESP
    89 000000B1 56                              	PUSH	ESI
    90 000000B2 53                              	PUSH	EBX
    91 000000B3 83 EC 10                        	SUB	ESP,16
    92 000000B6 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
    93 000000B9 E8 [00000000]                   	CALL	_task_alloc
    94 000000BE 68 00010000                     	PUSH	65536
    95 000000C3 89 C3                           	MOV	EBX,EAX
    96 000000C5 FF 76 04                        	PUSH	DWORD [4+ESI]
    97 000000C8 E8 [00000000]                   	CALL	_memman_alloc_4k
    98 000000CD 05 00010000                     	ADD	EAX,65536
    99 000000D2 89 43 64                        	MOV	DWORD [100+EBX],EAX
   100 000000D5 C7 43 4C [00000000]             	MOV	DWORD [76+EBX],_FS_task
   101 000000DC C7 43 74 00000008               	MOV	DWORD [116+EBX],8
   102 000000E3 C7 43 78 00000010               	MOV	DWORD [120+EBX],16
   103 000000EA C7 43 7C 00000008               	MOV	DWORD [124+EBX],8
   104 000000F1 C7 83 00000080 00000008         	MOV	DWORD [128+EBX],8
   105 000000FB C7 83 00000084 00000008         	MOV	DWORD [132+EBX],8
   106 00000105 C7 83 00000088 00000008         	MOV	DWORD [136+EBX],8
   107 0000010F C7 83 00000148 00000001         	MOV	DWORD [328+EBX],1
   108 00000119 6A 01                           	PUSH	1
   109 0000011B 6A 02                           	PUSH	2
   110 0000011D 53                              	PUSH	EBX
   111 0000011E E8 [00000000]                   	CALL	_task_run
   112 00000123 8D 45 E8                        	LEA	EAX,DWORD [-24+EBP]
   113 00000126 89 5E 08                        	MOV	DWORD [8+ESI],EBX
   114 00000129 A3 [00000004]                   	MOV	DWORD [_devcalls+4],EAX
   115 0000012E 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   116 00000131 B8 00000001                     	MOV	EAX,1
   117 00000136 5B                              	POP	EBX
   118 00000137 5E                              	POP	ESI
   119 00000138 5D                              	POP	EBP
   120 00000139 C3                              	RET
   121 0000013A                                 	GLOBAL	_fs_send2hd
   122 0000013A                                 _fs_send2hd:
   123 0000013A 55                              	PUSH	EBP
   124 0000013B 89 E5                           	MOV	EBP,ESP
   125 0000013D 83 EC 20                        	SUB	ESP,32
   126 00000140 8B 55 08                        	MOV	EDX,DWORD [8+EBP]
   127 00000143 8B 02                           	MOV	EAX,DWORD [EDX]
   128 00000145 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
   129 00000148 8D 45 E0                        	LEA	EAX,DWORD [-32+EBP]
   130 0000014B 80 4D F0 01                     	OR	BYTE [-16+EBP],1
   131 0000014F 89 42 10                        	MOV	DWORD [16+EDX],EAX
   132 00000152 A1 [00000000]                   	MOV	EAX,DWORD [_devcalls]
   133 00000157 52                              	PUSH	EDX
   134 00000158 FF 70 0C                        	PUSH	DWORD [12+EAX]
   135 0000015B E8 [00000000]                   	CALL	_message_send
   136 00000160 C9                              	LEAVE
   137 00000161 C3                              	RET
   138 00000162                                 	GLOBAL	_partitions
   139                                          [SECTION .data]
   140 00000014 00 00 00 00 00 00 00 00 00 00   	ALIGNB	16
       0000001E 00 00 
   141 00000020                                 _partitions:
   142 00000020 00 00 00 00 00 00 00 00 00 00   	RESB	832
       0000002A 00 00 00 00 00 00 00 00 00 00 
       00000034 00 00 00 00 00 00 00 00 00 00 
       0000003E 00 00 00 00 00 00 00 00 00 00 
       00000048 00 00 00 00 00 00 00 00 00 00 
       00000052 00 00 00 00 00 00 00 00 00 00 
       0000005C 00 00 00 00 00 00 00 00 00 00 
       00000066 00 00 00 00 00 00 00 00 00 00 
       00000070 00 00 00 00 00 00 00 00 00 00 
       0000007A 00 00 00 00 00 00 00 00 00 00 
       00000084 00 00 00 00 00 00 00 00 00 00 
       0000008E 00 00 00 00 00 00 00 00 00 00 
       00000098 00 00 00 00 00 00 00 00 00 00 
       000000A2 00 00 00 00 00 00 00 00 00 00 
       000000AC 00 00 00 00 00 00 00 00 00 00 
       000000B6 00 00 00 00 00 00 00 00 00 00 
       000000C0 00 00 00 00 00 00 00 00 00 00 
       000000CA 00 00 00 00 00 00 00 00 00 00 
       000000D4 00 00 00 00 00 00 00 00 00 00 
       000000DE 00 00 00 00 00 00 00 00 00 00 
       000000E8 00 00 00 00 00 00 00 00 00 00 
       000000F2 00 00 00 00 00 00 00 00 00 00 
       000000FC 00 00 00 00 00 00 00 00 00 00 
       00000106 00 00 00 00 00 00 00 00 00 00 
       00000110 00 00 00 00 00 00 00 00 00 00 
       0000011A 00 00 00 00 00 00 00 00 00 00 
       00000124 00 00 00 00 00 00 00 00 00 00 
       0000012E 00 00 00 00 00 00 00 00 00 00 
       00000138 00 00 00 00 00 00 00 00 00 00 
       00000142 00 00 00 00 00 00 00 00 00 00 
       0000014C 00 00 00 00 00 00 00 00 00 00 
       00000156 00 00 00 00 00 00 00 00 00 00 
       00000160 00 00 00 00 00 00 00 00 00 00 
       0000016A 00 00 00 00 00 00 00 00 00 00 
       00000174 00 00 00 00 00 00 00 00 00 00 
       0000017E 00 00 00 00 00 00 00 00 00 00 
       00000188 00 00 00 00 00 00 00 00 00 00 
       00000192 00 00 00 00 00 00 00 00 00 00 
       0000019C 00 00 00 00 00 00 00 00 00 00 
       000001A6 00 00 00 00 00 00 00 00 00 00 
       000001B0 00 00 00 00 00 00 00 00 00 00 
       000001BA 00 00 00 00 00 00 00 00 00 00 
       000001C4 00 00 00 00 00 00 00 00 00 00 
       000001CE 00 00 00 00 00 00 00 00 00 00 
       000001D8 00 00 00 00 00 00 00 00 00 00 
       000001E2 00 00 00 00 00 00 00 00 00 00 
       000001EC 00 00 00 00 00 00 00 00 00 00 
       000001F6 00 00 00 00 00 00 00 00 00 00 
       00000200 00 00 00 00 00 00 00 00 00 00 
       0000020A 00 00 00 00 00 00 00 00 00 00 
       00000214 00 00 00 00 00 00 00 00 00 00 
       0000021E 00 00 00 00 00 00 00 00 00 00 
       00000228 00 00 00 00 00 00 00 00 00 00 
       00000232 00 00 00 00 00 00 00 00 00 00 
       0000023C 00 00 00 00 00 00 00 00 00 00 
       00000246 00 00 00 00 00 00 00 00 00 00 
       00000250 00 00 00 00 00 00 00 00 00 00 
       0000025A 00 00 00 00 00 00 00 00 00 00 
       00000264 00 00 00 00 00 00 00 00 00 00 
       0000026E 00 00 00 00 00 00 00 00 00 00 
       00000278 00 00 00 00 00 00 00 00 00 00 
       00000282 00 00 00 00 00 00 00 00 00 00 
       0000028C 00 00 00 00 00 00 00 00 00 00 
       00000296 00 00 00 00 00 00 00 00 00 00 
       000002A0 00 00 00 00 00 00 00 00 00 00 
       000002AA 00 00 00 00 00 00 00 00 00 00 
       000002B4 00 00 00 00 00 00 00 00 00 00 
       000002BE 00 00 00 00 00 00 00 00 00 00 
       000002C8 00 00 00 00 00 00 00 00 00 00 
       000002D2 00 00 00 00 00 00 00 00 00 00 
       000002DC 00 00 00 00 00 00 00 00 00 00 
       000002E6 00 00 00 00 00 00 00 00 00 00 
       000002F0 00 00 00 00 00 00 00 00 00 00 
       000002FA 00 00 00 00 00 00 00 00 00 00 
       00000304 00 00 00 00 00 00 00 00 00 00 
       0000030E 00 00 00 00 00 00 00 00 00 00 
       00000318 00 00 00 00 00 00 00 00 00 00 
       00000322 00 00 00 00 00 00 00 00 00 00 
       0000032C 00 00 00 00 00 00 00 00 00 00 
       00000336 00 00 00 00 00 00 00 00 00 00 
       00000340 00 00 00 00 00 00 00 00 00 00 
       0000034A 00 00 00 00 00 00 00 00 00 00 
       00000354 00 00 00 00 00 00 00 00 00 00 
       0000035E 00 00 
